
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Explore Simplicity of Public Cloud Network Configuration with Cloud Network Controller (formerly cAPIC) and Nexus Dashboard Orchestrator (NDO)">
      
      
        <meta name="author" content="Marcin Duma & Karol Okraska">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.16">
    
    
      
        <title>Terraform modules - CiscoLive EMEA 2023 --- LTRCLD-2557</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1c3799f8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#terraform-modules" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CiscoLive EMEA 2023 --- LTRCLD-2557" class="md-header__button md-logo" aria-label="CiscoLive EMEA 2023 --- LTRCLD-2557" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CiscoLive EMEA 2023 --- LTRCLD-2557
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Terraform modules
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CiscoLive EMEA 2023 --- LTRCLD-2557" class="md-nav__button md-logo" aria-label="CiscoLive EMEA 2023 --- LTRCLD-2557" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CiscoLive EMEA 2023 --- LTRCLD-2557
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Lab Access
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Lab Access" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Lab Access
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LAB_access/" class="md-nav__link">
        Accessing the Lab Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../user-access.md" class="md-nav__link">
        NDO/cAPIC access
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          INFRA Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="INFRA Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          INFRA Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../postman/" class="md-nav__link">
        NDO and cAPIC review
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          User Tenant AWS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Tenant AWS" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          User Tenant AWS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-installation/" class="md-nav__link">
        Terraform setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          User Tenant Azure
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Tenant Azure" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          User Tenant Azure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-installation/" class="md-nav__link">
        Terraform setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Use-cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Use-cases" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Use-cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-installation/" class="md-nav__link">
        Terraform setup
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Appendixes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Appendixes" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Appendixes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guacamole/" class="md-nav__link">
        dCloudGuacamole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../URL-restAPI/" class="md-nav__link">
        Collection of RestAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../print_page/" class="md-nav__link">
        PRINT version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#lab" class="md-nav__link">
    Lab
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="terraform-modules">Terraform modules</h1>
<p>As you can see deploying objects like L3out require a lot of repeatable configuration. Such configs can be simplified by using Terraform modules. In such module we can write source configuration and re-use it multiple times, with standardized configuration.</p>
<p>In this lab we will use existing module for L3out configuration.
This module consists of three files:</p>
<ul>
<li>main.tf with the resource configuration</li>
<li>variables.tf with th variables definition</li>
<li>outputs.tf with the output ID value that this module would return</li>
</ul>
<p>Each three files should be placed under <em>modules/aci_l3out/</em> folder structure.</p>
<p>Apart from those files, we still require our own configuration, so again we will create <code>main.tf</code>, <code>variables.tf</code> and <code>terraform.tfvars</code> under main folder. The whole structure should look like this:</p>
<ul>
<li>
<p>ACI-4/</p>
<ul>
<li>main.tf</li>
<li>variables.tf</li>
<li>terraform.tfvars</li>
<li>
<p>modules/</p>
<ul>
<li>
<p>aci_l3out/</p>
<ul>
<li>main.tf</li>
<li>variables.tf</li>
<li>outputs.tf</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The complete folder can be downloaded: <strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/modules-demo.zip" target="_blank">here</a></strong></p>
<p>We will walk over the config files.</p>
<p><strong>Module files</strong></p>
<p>Inside the module folder we have three files.</p>
<p>In the <em>variables.tf</em> we define every variable that we will be using. In case of this module those variables don't have any default values assigned, they mostly specify the type of parameters to be used in maps.</p>
<p>In the <em>main.tf</em> file we create our complex l3out configuration and relations between multiple objects. This configuration looks similar to your manual L3out configuration, but this time it is reusable and you wouldn't have to write it multiple times for multiple L3outs.
We have set of resources like <code>aci_l3out</code>, <code>aci_logical_node_profile</code>, <code>aci_logical_interface_profile</code> etc. This module adds also BGP peer connectivity which is something we haven't done yet in the previous labs.</p>
<p>The new thing you can spot in this module is the initial part with the <code>locals</code> block. This block defined a local value. Local value is a temporary variable that is constructed with an expression on other variables. If you run expressions on variables, for example loops, you would always get some temporary variable that you can use. However, what a local value does, is that it assigns a name to that expression and you will be able to reuse it multiple times within your module, instead of repeating the expression. You can treat it similarly to a function in programming which returns some value.
In case of local value <code>external_epg_subnets</code> it is performing <code>flatten</code> function. (Flatten function)[https://developer.hashicorp.com/terraform/language/functions/flatten] is useful for us when we want to run loops inside a map of map. The result of this flatten function would be a list of all subnets that need to be configured under external EPG with their parameters.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>locals {
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  external_epg_subnets = flatten([
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    for l3epg_key, l3epg in var.external_epgs : [
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>      for subnet_key, subnet in l3epg.subnets : {
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>        external_epg_key = l3epg_key
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>        external_epg_name = l3epg.name
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>        subnet_key = subnet_key
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>        subnet_ip = subnet.ip
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>        subnet_scope = subnet.scope
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>      }
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>    ]
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>  ])
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>}
</code></pre></div>
<p>Later in the code we can see that this is used with <code>for</code> function in <code>aci_l3_ext_subnet</code> resource:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>resource &quot;aci_l3_ext_subnet&quot; &quot;l3instp_subnet&quot; {
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  for_each       = {
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    for subnet in local.external_epg_subnets : &quot;${subnet.external_epg_key}.${subnet.subnet_key}&quot; =&gt; subnet
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>  }
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>  external_network_instance_profile_dn  = aci_external_network_instance_profile.l3instp[each.value.external_epg_key].id
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>  ip                                    = each.value.subnet_ip
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>  scope                                 = each.value.subnet_scope
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>}
</code></pre></div>
<p>In the <em>value.tf</em> file we specify the output value for this module. Output values are similar to return values in programming languages. In this case they will return ID of L3out we created, and that ID in ACI will be the path of this object.
As you may remember, our standard resources from official ACI provider also return ID value of this resource in ACI, and it is always the path to the object.</p>
<p><strong>Main folder files</strong></p>
<p>In the main folder the files use same configuration as in previous labs, so you should be already familiar with the way we configure objects using variables and how we configure  bridge domains with conditionals and for_each loop. The new part is the way we configure L3Out using module.</p>
<p>As first part you can see that we are using data source to import existing configuration of Routed Domain. It would have to be used for configuration of L3out, so we need to have a way to reference it in our files.</p>
<p>Next we have our block for configuring the L3out itself. The highlithed lines show how we can write configuration and reference the module. Instead of a <code>resource</code> block, we are using <code>module</code> block and then in second line we have to reference the source path where this module is located <code>./modules/aci_l3out</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="hll"><span class="err">module</span><span class="w"> </span><span class="s2">&quot;l3out_core&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="hll"><span class="w">    </span><span class="err">source</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;./modules/aci_l3out&quot;</span><span class="w"></span>
</span><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="kc">tenant</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">aci_</span><span class="kc">tenant</span><span class="err">.</span><span class="kc">tenant</span><span class="err">.id</span><span class="w"></span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="kc">na</span><span class="err">me</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;core_l3out&quot;</span><span class="w"></span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">    </span><span class="err">vr</span><span class="kc">f</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">aci_vr</span><span class="kc">f</span><span class="err">.mai</span><span class="kc">n</span><span class="err">.id</span><span class="w"></span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="err">l</span><span class="mi">3</span><span class="err">_ex</span><span class="kc">t</span><span class="err">_domai</span><span class="kc">n</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">da</span><span class="kc">ta</span><span class="err">.aci_l</span><span class="mi">3</span><span class="err">_domai</span><span class="kc">n</span><span class="err">_pro</span><span class="kc">f</span><span class="err">ile.EXTRTDOM_</span><span class="mf">1.</span><span class="err">id</span><span class="w"></span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="kc">n</span><span class="err">odes</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="mi">101</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">            </span><span class="err">pod_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"></span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">            </span><span class="kc">n</span><span class="err">ode_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;101&quot;</span><span class="w"></span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">            </span><span class="err">r</span><span class="kc">tr</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;51.1.1.1&quot;</span><span class="w"></span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">            </span><span class="err">r</span><span class="kc">tr</span><span class="err">_id_loopback</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="w"></span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">    </span><span class="err">pa</span><span class="kc">t</span><span class="err">hs</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">        </span><span class="s2">&quot;101.1.10&quot;</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">            </span><span class="err">pod_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"></span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">            </span><span class="kc">n</span><span class="err">ode_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;101&quot;</span><span class="w"></span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="w">            </span><span class="err">por</span><span class="kc">t</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;eth1/10&quot;</span><span class="w"></span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a><span class="w">            </span><span class="err">ip_addr</span><span class="w">  </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;5.5.1.2/24&quot;</span><span class="w"></span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a><span class="w">            </span><span class="err">mode</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;regular&quot;</span><span class="w"></span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="w">            </span><span class="err">m</span><span class="kc">tu</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;inherit&quot;</span><span class="w"></span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a><span class="w">    </span><span class="err">bgp_peers</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="w">        </span><span class="err">asa</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a><span class="w">            </span><span class="err">peer_addr</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;5.5.1.1&quot;</span><span class="w"></span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a><span class="w">            </span><span class="err">peer_as</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;65099&quot;</span><span class="w"></span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#__codelineno-2-30"></a><span class="w">            </span><span class="err">local_as</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;65001&quot;</span><span class="w"></span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#__codelineno-2-31"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#__codelineno-2-32"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#__codelineno-2-33"></a><span class="w">    </span><span class="err">ex</span><span class="kc">ternal</span><span class="err">_epgs</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#__codelineno-2-34"></a><span class="w">        </span><span class="err">de</span><span class="kc">fault</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#__codelineno-2-35"></a><span class="w">            </span><span class="kc">na</span><span class="err">me</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;default_l3epg&quot;</span><span class="w"></span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#__codelineno-2-36"></a><span class="w">            </span><span class="err">pre</span><span class="kc">f</span><span class="err">Grp</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;exclude&quot;</span><span class="w"></span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#__codelineno-2-37"></a><span class="w">            </span><span class="err">provided_co</span><span class="kc">ntra</span><span class="err">c</span><span class="kc">ts</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#__codelineno-2-38"></a><span class="w">            </span><span class="err">co</span><span class="kc">nsu</span><span class="err">med_co</span><span class="kc">ntra</span><span class="err">c</span><span class="kc">ts</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#__codelineno-2-39"></a><span class="w">            </span><span class="err">sub</span><span class="kc">nets</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#__codelineno-2-40"></a><span class="w">              </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#__codelineno-2-41"></a><span class="w">                </span><span class="err">ip</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="w"></span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#__codelineno-2-42"></a><span class="w">                </span><span class="err">scope</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;import-security&quot;</span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#__codelineno-2-43"></a><span class="w">              </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#__codelineno-2-44"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#__codelineno-2-45"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#__codelineno-2-46"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#__codelineno-2-47"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The remaining part is the actual config parameters that we want to use for our L3out. Each of the parameters that we are assigning is defined in the module itself. In this file we simply assign values to them, either manually by typing it (i.e. name = "core_l3out") or by referencing other variables and objects (i.e tenant_id = aci_tenant.tenant.id).</p>
<h3 id="lab">Lab</h3>
<p>Customer creates Custom2 tenant with dedicated VRF, bridge domains, EPGs, domain associations and static-bindings for particular departaments. There are also two L3outs for MPLS and Internet connectivity. Use existing PHYSDOM_1 physcial domain and existing EXTRTDOM_1 routed domain. Use following static bindings:</p>
<p>WAN Router:</p>
<ul>
<li>node 101, interface eth1/10, routed interface</li>
</ul>
<p>INTERNET Router:</p>
<ul>
<li>node 102, interface eth1/11, routed interface</li>
</ul>
<p>UCS/vmware server:</p>
<ul>
<li>topology/pod-1/protpaths-101-102/pathep-[IntPolGrp_VPC_server1]</li>
<li>EPG_UC - vlan 160</li>
<li>EPG_DMZ - vlan 161</li>
</ul>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/terraform-usecase-module.png" width = 400></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.3a4b43e5.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
    
  </body>
</html>