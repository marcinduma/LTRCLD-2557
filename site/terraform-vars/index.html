
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Explore Simplicity of Public Cloud Network Configuration with Cloud Network Controller (formerly cAPIC) and Nexus Dashboard Orchestrator (NDO)">
      
      
        <meta name="author" content="Marcin Duma & Karol Okraska">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>Terraform Language - CiscoLive EMEA 2023 --- LTRCLD-2557</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#terraform-language" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CiscoLive EMEA 2023 --- LTRCLD-2557" class="md-header__button md-logo" aria-label="CiscoLive EMEA 2023 --- LTRCLD-2557" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CiscoLive EMEA 2023 --- LTRCLD-2557
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Terraform Language
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CiscoLive EMEA 2023 --- LTRCLD-2557" class="md-nav__button md-logo" aria-label="CiscoLive EMEA 2023 --- LTRCLD-2557" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CiscoLive EMEA 2023 --- LTRCLD-2557
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Lab Access
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Lab Access" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Lab Access
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LAB_access/" class="md-nav__link">
        Accessing the Lab Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lab-check/" class="md-nav__link">
        Infastructure veryfication
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../infra-config/" class="md-nav__link">
        INFRA Configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Tenant configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tenant configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tenant configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ndo-tenant/" class="md-nav__link">
        NDO Tenant configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../aws-trust/" class="md-nav__link">
        AWS Trust
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Use-cases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Use-cases" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Use-cases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-installation/" class="md-nav__link">
        Stretched VRF
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-installation/" class="md-nav__link">
        Internet Gateway
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-installation/" class="md-nav__link">
        Inter-Tenant routing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Appendixes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Appendixes" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Appendixes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../object-map/" class="md-nav__link">
        ACI to Public Cloud Object mapping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guacamole/" class="md-nav__link">
        dCloudGuacamole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../URL-restAPI/" class="md-nav__link">
        Collection of RestAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../print_page/" class="md-nav__link">
        PRINT version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-variable-file" class="md-nav__link">
    1. Variable file
  </a>
  
    <nav class="md-nav" aria-label="1. Variable file">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-variables-definition" class="md-nav__link">
    1.1 Variables definition
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-variable-usage-in-config" class="md-nav__link">
    1.2 Variable usage in config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-provide-variable-value" class="md-nav__link">
    1.3 Provide variable value
  </a>
  
    <nav class="md-nav" aria-label="1.3 Provide variable value">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#131-manual-variable-values" class="md-nav__link">
    1.3.1 Manual variable values
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#132-the-tfvars-file" class="md-nav__link">
    1.3.2. The .tfvars file
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-for_each-loop" class="md-nav__link">
    2. For_each loop
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-conditionals-and-for-expression" class="md-nav__link">
    3. Conditionals and for expression
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-data-sources" class="md-nav__link">
    4. Data sources
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="terraform-language">Terraform Language</h1>
<p>As you can see in the previous lab, manually specifying each resource and its values is very time consuming. In this lab you will learn how to use variables and functions to simplify the work</p>
<h2 id="1-variable-file">1. Variable file</h2>
<p>Variable declarations can appear anywhere in your configuration files. However, it is recommended putting them into a separate file called variables.tf to make it easier for users to understand how the configuration is meant to be customized.</p>
<p>To parameterize an argument with an input variable, you will first define the variable in <code>variables.tf</code>, then replace the hardcoded value with a reference to that variable in your configuration.</p>
<p>Variable blocks have three optional arguments.</p>
<ul>
<li><strong>Description</strong>: A short description to document the purpose of the variable.</li>
<li><strong>Type</strong>: The type of data contained in the variable.</li>
<li><strong>Default</strong>: The default value.</li>
</ul>
<p>If you do not set a default value for a variable, you must assign a value before Terraform can apply the configuration. Terraform does not support unassigned variables.</p>
<p>When variables are declared in the root folder of your configuration, they can be set in a number of ways:</p>
<ul>
<li>In a Terraform Cloud workspace.</li>
<li>Individually, with the -var command line option.</li>
<li>In variable definitions (.tfvars) files, either specified on the command line or automatically loaded.</li>
<li>As environment variables.</li>
</ul>
<h3 id="11-variables-definition">1.1 Variables definition</h3>
<p>Let's create in our folder new file called <code>variables.tf</code>. In this file let's define several variables that we will use to deploy new tenant.</p>
<p>Following variables will be used as a name for new tenant, VRF and bridge domain. Those variables have only a default value defined which will be used if no other value is specified for execution.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>variable &quot;tenant_name&quot; {
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  default = &quot;dcloud-tenant-2&quot;
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>}
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>variable &quot;vrf_name&quot; {
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>  default = &quot;vrf2-1&quot;
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>}
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>variable &quot;bd_name&quot; {
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>  default = &quot;bd2-1&quot;
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>}
</code></pre></div>
<p>The next variable is used for specifying the ARP flooding behaviour of a bridge domain. Here you can see that we are using all possible options:</p>
<ul>
<li>description of variable</li>
<li>default value to be used if no other is specfied</li>
<li>
<p>validation mechanism with:</p>
<ul>
<li>condition - variable can be set to either "yes" or "no" value</li>
<li>error message to be displayed if specified value doesn't pass the validation test</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>variable &quot;bd_arp_flood&quot; {
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  description = &quot;Specify whether ARP flooding is enabled. If flooding is disabled, unicast routing will be performed on the target IP address.&quot;
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>  default = &quot;yes&quot;
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>  validation {
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    condition = (var.bd_arp_flood == &quot;yes&quot;) || (var.bd_arp_flood == &quot;no&quot;)
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    error_message = &quot;Allowed values are \&quot;yes\&quot; and \&quot;no\&quot;.&quot;
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>  }
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>}
</code></pre></div>
<p>The last two variables will be specifying bridge domain behaviour for unicast routing and unknown unicast flooding:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>variable &quot;bd_unicast_routing&quot; {
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>  default = &quot;yes&quot;
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>}
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>variable &quot;bd_unk_ucast&quot; {
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>  default = &quot;proxy&quot;
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>}
</code></pre></div>
<h3 id="12-variable-usage-in-config">1.2 Variable usage in config</h3>
<p>Now let's use the variables we defined to create new tenant. For this task please create new config file called <code>dcloud-tenant-2.tf</code>. We will use it to deploy new tenant called <em>dcloud-tenant-2</em> with one VRF and bridge domain.</p>
<p>The way we make references to our variables is by using <em>var.<variable name></em> inside our config file. the <em>var.</em> part of this syntax indicates that we are using variables.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>resource &quot;aci_tenant&quot; &quot;dcloud-tenant-2&quot; {
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>  name        = var.tenant_name
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>  description = &quot;This is a new tenant created from Terraform&quot;
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>}
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>resource &quot;aci_vrf&quot; &quot;vrf2-1&quot; {
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>  tenant_dn              = aci_tenant.dcloud-tenant-2.id
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>  name                   = var.vrf_name
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>}
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_1_0&quot; {
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a>  tenant_dn                   = aci_tenant.dcloud-tenant-2.id
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>  name                        = var.bd_name
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>  arp_flood                   = var.bd_arp_flood
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>  unicast_route               = var.bd_unicast_routing
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a>  unk_mac_ucast_act           = var.bd_unk_ucast
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>  relation_fv_rs_ctx          = aci_vrf.vrf2-1.id
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a>}
</code></pre></div>
<p>In our <code>variables.tf</code> all our variables have default value assigned, which means we should be able to apply this configuration and deploy new tenant.
Let's run <code>terraform apply</code> and verify on APIC that all the objects have been deployed according to the specified variables.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform apply
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>&lt;omitted&gt;
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>  + create
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>Terraform will perform the following actions:
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>  # aci_bridge_domain.bd_192_168_1_0 will be created
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>  + resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_1_0&quot; {
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>      + annotation                  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>      + arp_flood                   = &quot;yes&quot;
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>      + bridge_domain_type          = (known after apply)
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>      + description                 = (known after apply)
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>      + ep_clear                    = (known after apply)
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>      + ep_move_detect_mode         = (known after apply)
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>      + host_based_routing          = (known after apply)
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>      + id                          = (known after apply)
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>      + intersite_bum_traffic_allow = (known after apply)
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>      + intersite_l2_stretch        = (known after apply)
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>      + ip_learning                 = (known after apply)
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>      + ipv6_mcast_allow            = (known after apply)
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>      + limit_ip_learn_to_subnets   = (known after apply)
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>      + ll_addr                     = (known after apply)
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>      + mac                         = (known after apply)
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>      + mcast_allow                 = (known after apply)
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a>      + multi_dst_pkt_act           = (known after apply)
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>      + name                        = &quot;bd2-1&quot;
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>      + name_alias                  = (known after apply)
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>      + optimize_wan_bandwidth      = (known after apply)
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a>      + relation_fv_rs_bd_to_ep_ret = (known after apply)
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>      + relation_fv_rs_bd_to_nd_p   = (known after apply)
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a>      + relation_fv_rs_ctx          = (known after apply)
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a>      + relation_fv_rs_igmpsn       = (known after apply)
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a>      + relation_fv_rs_mldsn        = (known after apply)
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a>      + tenant_dn                   = (known after apply)
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>      + unicast_route               = &quot;yes&quot;
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>      + unk_mac_ucast_act           = &quot;proxy&quot;
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a>      + unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>      + v6unk_mcast_act             = (known after apply)
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a>      + vmac                        = (known after apply)
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a>    }
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a>  # aci_tenant.dcloud-tenant-2 will be created
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a>  + resource &quot;aci_tenant&quot; &quot;dcloud-tenant-2&quot; {
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a>      + annotation                    = &quot;orchestrator:terraform&quot;
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>      + description                   = &quot;This is a new tenant created from Terraform&quot;
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a>      + id                            = (known after apply)
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a>      + name                          = &quot;dcloud-tenant-2&quot;
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>      + name_alias                    = (known after apply)
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a>      + relation_fv_rs_tenant_mon_pol = (known after apply)
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>    }
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>  # aci_vrf.vrf2-1 will be created
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>  + resource &quot;aci_vrf&quot; &quot;vrf2-1&quot; {
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a>      + annotation                              = &quot;orchestrator:terraform&quot;
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a>      + bd_enforced_enable                      = (known after apply)
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>      + description                             = (known after apply)
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>      + id                                      = (known after apply)
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>      + ip_data_plane_learning                  = (known after apply)
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a>      + knw_mcast_act                           = (known after apply)
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>      + name                                    = &quot;vrf2-1&quot;
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>      + name_alias                              = (known after apply)
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>      + pc_enf_dir                              = (known after apply)
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a>      + pc_enf_pref                             = (known after apply)
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a>      + relation_fv_rs_bgp_ctx_pol              = (known after apply)
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>      + relation_fv_rs_ctx_to_ep_ret            = (known after apply)
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a>      + relation_fv_rs_ctx_to_ext_route_tag_pol = (known after apply)
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a>      + relation_fv_rs_ospf_ctx_pol             = (known after apply)
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>      + relation_fv_rs_vrf_validation_pol       = (known after apply)
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>      + tenant_dn                               = (known after apply)
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a>    }
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a>Plan: 3 to add, 0 to change, 0 to destroy.
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a>Do you want to perform these actions?
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a>  Terraform will perform the actions described above.
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a>  Only &#39;yes&#39; will be accepted to approve.
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a>  Enter a value: yes
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a>aci_tenant.dcloud-tenant-2: Creating...
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a>aci_tenant.dcloud-tenant-2: Creation complete after 1s [id=uni/tn-dcloud-tenant-2]
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a>aci_vrf.vrf2-1: Creating...
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a>aci_vrf.vrf2-1: Creation complete after 1s [id=uni/tn-dcloud-tenant-2/ctx-vrf2-1]
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a>aci_bridge_domain.bd_192_168_1_0: Creating...
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>aci_bridge_domain.bd_192_168_1_0: Creation complete after 2s [id=uni/tn-dcloud-tenant-2/BD-bd2-1]
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a>Apply complete! Resources: 3 added, 0 changed, 0 destroyed.
</code></pre></div>
<h3 id="13-provide-variable-value">1.3 Provide variable value</h3>
<h4 id="131-manual-variable-values">1.3.1 Manual variable values</h4>
<p>Now let's see how else we can provide variable values. In this case first let's modify our <code>variables.tf</code> file and add new variable called <code>bd_name_2</code> which will have no default value and new variable <code>bd_arp_flood_2</code> which will also have no default value.
This way with no default value, Terraform will be forced to ask user to specify it manually during execution:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are not removing default value from existing <code>bd_name</code> or <code>bd_arp_flood</code> variables, as it would force terraform to change it on the existing bridge domain. We are adding new variables to show the difference between them</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>variable &quot;bd_arp_flood_2&quot; {
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>  description = &quot;Specify whether ARP flooding is enabled. If flooding is disabled, unicast routing will be performed on the target IP address.&quot;
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>  validation {
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    condition = (var.bd_arp_flood_2 == &quot;yes&quot;) || (var.bd_arp_flood_2 == &quot;no&quot;)
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>    error_message = &quot;Allowed values are \&quot;yes\&quot; and \&quot;no\&quot;.&quot;
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>  }
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>}
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>variable &quot;bd_name_2&quot; {
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>}
</code></pre></div>
<p>Let's also add another bridge domain resource where we will verify our manual values. Add following block to the <em>dcloud-tenant-2.tf</em> file. Here we are only giving new name to the resource so that Terraform is aware that this is a new resource to be deployed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_2_0&quot; {
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  tenant_dn                   = aci_tenant.dcloud-tenant-2.id
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  name                        = var.bd_name_2
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>  arp_flood                   = var.bd_arp_flood_2
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>  unicast_route               = var.bd_unicast_routing
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  unk_mac_ucast_act           = var.bd_unk_ucast
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>  relation_fv_rs_ctx          = aci_vrf.vrf2-1.id
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>}
</code></pre></div>
<p>Now if we run <code>terraform plan</code> we will be asked to specify both values that don't have a default value in the variables file. Let's specify them, but at the same time test if our validation rule works. Please specify <em>bd2</em> as <code>bd_name_2</code> and <em>enable</em> as <code>bd_arp_flood_2</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform plan
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>var.bd_arp_flood_2
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  Specify whether ARP flooding is enabled. If flooding is disabled, unicast routing will be performed on the target IP address.
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>  Enter a value: enable
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>var.bd_name_2
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>  Enter a value: bd2
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>&lt;omitted&gt;
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#__codelineno-7-13"></a>│ Error: Invalid value for variable
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#__codelineno-7-14"></a>│
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#__codelineno-7-15"></a>│   on variables.tf line 31:
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#__codelineno-7-16"></a>│   31: variable &quot;bd_arp_flood_2&quot; {
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#__codelineno-7-17"></a>│     ├────────────────
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#__codelineno-7-18"></a>│     │ var.bd_arp_flood_2 is &quot;enable&quot;
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#__codelineno-7-19"></a>│
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#__codelineno-7-20"></a>│ Allowed values are &quot;yes&quot; and &quot;no&quot;.
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#__codelineno-7-21"></a>│
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#__codelineno-7-22"></a>│ This was checked by the validation rule at variables.tf:33,3-13.
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#__codelineno-7-23"></a>╵
</code></pre></div>
<p>In this case Terraform will stop the plan and report incorrect value provided for <em>bd_arp_flood_2</em></p>
<p>If we then specify <code>yes</code> to <em>bd_arp_flood</em> and <code>bd2</code> for <em>bd_name</em> we will see that the plan generated output showing us what would be deployed in the APIC:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform plan
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>var.bd_arp_flood_2
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>  Specify whether ARP flooding is enabled. If flooding is disabled, unicast routing will be performed on the target IP address.
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  Enter a value: yes
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>var.bd_name_2
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>  Enter a value: bd2
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>  + create
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>Terraform will perform the following actions:
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>  # aci_bridge_domain.bd_192_168_2_0 will be created
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>  + resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_2_0&quot; {
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>      + annotation                  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>      + arp_flood                   = &quot;yes&quot;
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>      + bridge_domain_type          = (known after apply)
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>      + description                 = (known after apply)
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>      + ep_clear                    = (known after apply)
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>      + ep_move_detect_mode         = (known after apply)
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>      + host_based_routing          = (known after apply)
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>      + id                          = (known after apply)
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>      + intersite_bum_traffic_allow = (known after apply)
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>      + intersite_l2_stretch        = (known after apply)
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>      + ip_learning                 = (known after apply)
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>      + ipv6_mcast_allow            = (known after apply)
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#__codelineno-9-20"></a>      + limit_ip_learn_to_subnets   = (known after apply)
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#__codelineno-9-21"></a>      + ll_addr                     = (known after apply)
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#__codelineno-9-22"></a>      + mac                         = (known after apply)
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#__codelineno-9-23"></a>      + mcast_allow                 = (known after apply)
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#__codelineno-9-24"></a>      + multi_dst_pkt_act           = (known after apply)
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#__codelineno-9-25"></a>      + name                        = &quot;bd2&quot;
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#__codelineno-9-26"></a>      + name_alias                  = (known after apply)
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#__codelineno-9-27"></a>      + optimize_wan_bandwidth      = (known after apply)
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#__codelineno-9-28"></a>      + relation_fv_rs_bd_to_ep_ret = (known after apply)
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#__codelineno-9-29"></a>      + relation_fv_rs_bd_to_nd_p   = (known after apply)
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#__codelineno-9-30"></a>      + relation_fv_rs_ctx          = &quot;uni/tn-dcloud-tenant-2/ctx-vrf2-1&quot;
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#__codelineno-9-31"></a>      + relation_fv_rs_igmpsn       = (known after apply)
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#__codelineno-9-32"></a>      + relation_fv_rs_mldsn        = (known after apply)
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#__codelineno-9-33"></a>      + tenant_dn                   = &quot;uni/tn-dcloud-tenant-2&quot;
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#__codelineno-9-34"></a>      + unicast_route               = &quot;yes&quot;
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#__codelineno-9-35"></a>      + unk_mac_ucast_act           = &quot;proxy&quot;
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#__codelineno-9-36"></a>      + unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#__codelineno-9-37"></a>      + v6unk_mcast_act             = (known after apply)
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#__codelineno-9-38"></a>      + vmac                        = (known after apply)
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#__codelineno-9-39"></a>    }
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#__codelineno-9-40"></a>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#__codelineno-9-41"></a>Plan: 1 to add, 0 to change, 0 to destroy.
</code></pre></div>
<p>Let's run <code>terraform apply</code> to see that this bridge domain would be deployed.</p>
<h4 id="132-the-tfvars-file">1.3.2. The .tfvars file</h4>
<p>Manual method of providing values for our variables can be quite absorbing and prone to humar errors. Another, preferred way would be to include all our variable values into separate file called *.tfvars. Please create new file calle <code>terraform.tfvars</code>. Variable values in such file can be defined in a simple way:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>tenant_name = &quot;dcloud-tenant-2&quot;
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>vrf_name = &quot;vrf2-1&quot;
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>bd_name_2 = &quot;bd2&quot;
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>bd_arp_flood_2 = &quot;no&quot;
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>bd_unicast_routing = &quot;no&quot;
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>bd_unk_ucast = &quot;proxy&quot;
</code></pre></div>
<p>To each variable name we assign our preferred value. If you take a look closely you will see that for <code>bd_arp_flood_2</code> and <code>bd_unicast_routing</code> we specify different values that we did for our <code>bd2</code> bridge domain. If we run our <code>terraform apply</code> command now, we will see that terraform wants to do changes on our resource:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>&lt;omitted&gt;
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>  ~ update in-place
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>Terraform will perform the following actions:
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>  # aci_bridge_domain.bd_192_168_1_0 will be updated in-place
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>  ~ resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_1_0&quot; {
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a>        id                          = &quot;uni/tn-dcloud-tenant-2/BD-bd2-1&quot;
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>        name                        = &quot;bd2-1&quot;
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>      ~ unicast_route               = &quot;yes&quot; -&gt; &quot;no&quot;
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a>        # (22 unchanged attributes hidden)
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>    }
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a>  # aci_bridge_domain.bd_192_168_2_0 will be updated in-place
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a>  ~ resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_2_0&quot; {
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a>      ~ arp_flood                   = &quot;yes&quot; -&gt; &quot;no&quot;
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>        id                          = &quot;uni/tn-dcloud-tenant-2/BD-bd2&quot;
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>        name                        = &quot;bd2&quot;
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a>      ~ unicast_route               = &quot;yes&quot; -&gt; &quot;no&quot;
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a>        # (21 unchanged attributes hidden)
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>    }
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a>Plan: 0 to add, 2 to change, 0 to destroy.
</code></pre></div>
<p>If we execute our command, Terraform will change the configuration on the APIC. Please verify in the GUI that these changes really reflect the configuration.</p>
<h2 id="2-for_each-loop">2. For_each loop</h2>
<p>This way of specifying variables and creating configuration is good if we want to deploy single object, however in case we have multiple bridge domains to deploy it may not be the most efficient way.
By default a resource block configures one real infrastructure object. However, sometimes you want to manage several similar obejcts (like several bridge domains) without writing separate block for each one. Terraform has two ways to do this:</p>
<ul>
<li>count</li>
<li>for_each</li>
</ul>
<p>The <code>count</code> argument takes a value of a whole number and Terraform will simply create that many instances of an object. This will not help us much with ACI, as every of these objects would have the same configuration. We want to have option to create multiple bridge domains, which may have different config options.</p>
<p>The <code>for_each</code> argument can be included in a resource block, and its value is a map or set of strings. Terraform will create one instance for each member of that map or set. For this exercise we will work with maps that will include our bridge domains configuration.</p>
<p>The map has an index value for each object instance. This index is used by terraform to reference resources and to get values we need from it to create objects.</p>
<p>In our example let's create new folder for our workspace and call it <code>ACI-2</code>. Inside this folder create three files that we will use:</p>
<ul>
<li>main.tf - which will hold our provider configuration and resource that will be deployed (tenant, vrf, bridge domains and subents)</li>
<li>variables.tf - which will have definition of variables we will use, including their types and default values</li>
<li>terraform.tfvars - which we will use to specify our desired values and confiuration of bridge domains</li>
</ul>
<p>Inside <code>variables.tf</code> file paste the following content:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>variable &quot;tenant_name&quot; {
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>  default = &quot;demo_tn&quot;
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>}
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>variable &quot;vrf_name&quot; {
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>  default = &quot;vrf1&quot;
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>}
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>variable &quot;bridge_domains&quot; {
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>  type = map(object({
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a>    name = string
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    arp_flood = string
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    unicast_routing = string
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>    unk_ucast = string
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>    subnet = string
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a>    subnet_scope = list(string)
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>  }))
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a>  default = {
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a>    default_bd = {
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a>      name = &quot;default&quot;
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a>      arp_flood = &quot;yes&quot;
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a>      unicast_routing = &quot;yes&quot;
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a>      unk_ucast = &quot;proxy&quot;
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a>      subnet = &quot;10.10.10.1/24&quot;
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a>      subnet_scope = [&quot;private&quot;]
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a>    }
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a>  }
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a>}
</code></pre></div>
<p>In this file we can see that we are defining three variables: tenant_name, vrf_name and bridge_domains. The bridge_domains variable is the interesting one, and it has type map of objects. One object will represent single bridge domain and its configuration. As part of this object we have our standard values to configure a BD like name, ARP flooding, unicast routing and unknown unicast flooding behaviour, but also subnet and subnet scope. Inside this variable first we define for those arguments what type they should take (string value for most of them and list of strings for subnet_scope). Then we specify default value that our map would take, in case we don't provide any values ourselves (inside <code>terraform.tfvars</code> file).</p>
<p>Now we want to provide the values we want to use in the <code>terraform.tffvars</code> file, please paste following content:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>tenant_name = &quot;dcloud-tenant-3&quot;
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>vrf_name = &quot;vrf1&quot;
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>bridge_domains = {
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    bd01 = {
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>        name = &quot;192.168.1.0_24_bd&quot;
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>        arp_flood = &quot;no&quot;
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>        unicast_routing = &quot;yes&quot;
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>        unk_ucast = &quot;proxy&quot;
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        subnet = &quot;192.168.1.1/24&quot;
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        subnet_scope = [&quot;private&quot;]
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>    },
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>    bd02 = {
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>        name = &quot;192.168.2.0_24_bd&quot;
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        unicast_routing = &quot;yes&quot;
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        unk_ucast = &quot;proxy&quot;
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>        subnet = &quot;192.168.2.1/24&quot;
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>        subnet_scope = [&quot;private&quot;,&quot;shared&quot;]
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>    }
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>}
</code></pre></div>
<p>Inside this file we specify our tenant and vrf name we want to use, and then we specify bridge domains map, which includes two bridge domains:</p>
<ul>
<li>bd01 of name 192.168.1.0_24_bd</li>
<li>bd02 of name 192.168.2.0_24_bd</li>
</ul>
<p>That means our map has two objects. Each object is a key and value pair, where:</p>
<ul>
<li>first object key is <code>bd01</code> and value is all the arguments we specify for it, including name, arp_flood, subnet etc</li>
<li>second object key is <code>bd02</code> and value is all the arguments we specify for it, including name, arp_flood, subnet etc</li>
</ul>
<p>You can see that our bridge domains differ in configuration of parameters. We have different names, arp flooding and subnet with scope.</p>
<p>Now, since we are doing this demo in separate folder <code>ACI-2</code>, we will have to initialize Terraform again and treat it as a separate deployment. For this reason inside the <code>main.tf</code> file we have to paste first our ACI provider configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a>terraform {
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>  required_providers {
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>    aci = {
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>      source = &quot;CiscoDevNet/aci&quot;
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>      version = &quot;2.5.2&quot;
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    }
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>  }
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>}
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>provider &quot;aci&quot; {
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>  # Cisco ACI user name
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>  username    = &quot;admin&quot;
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>  password    = &quot;C1sco12345&quot;
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>  url         = &quot;https://198.18.133.200&quot;
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>  insecure    = true
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>}
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please remmeber in the terminal to change path to the right folder with <code>cd</code> command.</p>
</div>
<p>Below that we will start describing our resources. We want to create four resources: tenant, vrf, bridge domain and subnet.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>resource &quot;aci_tenant&quot; &quot;dcloud-tenant-3&quot; {
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>  name        = &quot;${var.tenant_name}&quot;
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>  description = &quot;This is a demo tenant created from Terraform&quot;
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>}
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>resource &quot;aci_vrf&quot; &quot;main&quot; {
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>  tenant_dn              = aci_tenant.dcloud-tenant-3.id
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>  name                   = var.vrf_name
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>}
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>resource &quot;aci_bridge_domain&quot; &quot;bd&quot; {
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>  for_each = var.bridge_domains
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>  tenant_dn                   = aci_tenant.dcloud-tenant-3.id
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>  name                        = each.value.name
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>  arp_flood                   = each.value.arp_flood
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>  unicast_route               = each.value.unicast_routing
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>  unk_mac_ucast_act           = each.value.unk_ucast
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>  relation_fv_rs_ctx          = aci_vrf.main.id
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>}
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a>resource &quot;aci_subnet&quot; &quot;subnets&quot; {
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a>    for_each             = var.bridge_domains
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>    parent_dn            = aci_bridge_domain.bd[each.key].id
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>    ip                   = each.value.subnet
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a>    scope                = each.value.subnet_scope
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>}
</code></pre></div>
<p>The tenant and VRF resources are configured in a similar way as in previous demo, so they don't need description. They use standard references to variables we provided in the file.
The interesting part is with the bridge_domain and subnet. In here we can see that each of these resources start with a special line</p>
<div class="highlight"><pre><span></span><code>for_each = var.bridge_domains
</code></pre></div>
<p>This indicates that we want to create this resource once for every object in our variable called <code>bridge_domains</code>. In our <code>terraform.tfvars</code> we declared this variable to include two different bridge_domains, so we expect that this resource will be created twice. Each resource will be unique by the map key.
In resource blocks where <code>for_each</code> is set, an additional <code>each</code> object is available in expressions, so you can modify the configuration of each instance. This object has two attributes:</p>
<ul>
<li><code>each.key</code> - the map key corresponding to this instance</li>
<li><code>each.value</code> - the map value corresponding to this instance.</li>
</ul>
<p>In our resource block for bridge domain and subnet we can see that we are referring to arguments with <code>each.value.&lt;argumnet&gt;</code> or <code>each.key</code>, as an example:</p>
<div class="highlight"><pre><span></span><code>name = each.value.name
</code></pre></div>
<p>We can also see that for the relation that needs to happen between bd and subnet we specify parent_dn with following expression using <code>each.key</code>:</p>
<div class="highlight"><pre><span></span><code>parent_dn = aci_bridge_domain.bd[each.key].id
</code></pre></div>
<p>If we now run <code>terraform plan</code> and <code>apply</code> we will see that two bridge domains have been created according to our settings.</p>
<p>Let's expand our tenant configuration by adding several EPGs, which we will create in the same way using <code>for_each</code> expression.
First we need to define new variable corresponding to an EPG, it will take values of <em>name</em> and <em>bridge domain</em>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>variable &quot;end_point_groups&quot; {
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>  type = map(object({
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>    name = string
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    bd = string
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>  }))
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>}
</code></pre></div>
<p>Next we specify desired configuration of our EPGs in <code>terraform.tfvars</code> file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>end_point_groups = {
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    epg1 = {
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>        name = &quot;epg1&quot;,
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>        bd   = &quot;bd01&quot;
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>    },
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    epg2 = {
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>        name = &quot;epg2&quot;,
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>        bd   = &quot;bd02&quot;
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>    }
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>}
</code></pre></div>
<p>Finally we add resource configuration in <code>main.tf</code> file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>resource &quot;aci_application_profile&quot; &quot;ap1&quot; {
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>  tenant_dn  = aci_tenant.dcloud-tenant-3.id
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>  name       = &quot;ap1&quot;
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>}
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>resource &quot;aci_application_epg&quot; &quot;epg&quot; {
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    for_each                = var.end_point_groups
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    application_profile_dn  = aci_application_profile.ap1.id
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>    name                    = each.value.name
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>    relation_fv_rs_bd       = aci_bridge_domain.bd[each.value.bd].id
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>}
</code></pre></div>
<p>You can see that endpoint groups also use the <code>for_each</code> function and create relation to a bridge domain that we specified.
If you run <code>apply</code> now you will see additional AP and 2xEPG created. You can try adding new EPGs to the <code>terraform.tfvars</code> map of endpoint groups, to see that now it is easier to add new EPGs.</p>
<h2 id="3-conditionals-and-for-expression">3. Conditionals and for expression</h2>
<p>A conditional expression uses the value of a boolean expression to select one of two values.
The condition can be any expression that resolves to a boolean value. This will usually be an expression that uses the equality, comparison, or logical operators.</p>
<p>In our case we will use it to configure several parameters only <em>under condition</em> that other parameters are configured to a sprecific value. As an example let's take bridge domain configuration. On a high level there are two types of bridge domains we configure in ACI: L2 and L3. For L3 bridge domain we need to set unicast routing option to true, flooding arguments need to be adjusted, and subnet IP should be configured. For L2 bridge domains those parameters are not needed and BD should work in a flooding mode with no IP address.
To specify that kind of configuration we can use conditionals in Terraform resource block.</p>
<p>Please create new folder <code>ACI-3</code> that we will use for this test, and under this folder three files:</p>
<ul>
<li><code>main.tf</code> and paste the ACI provider configuration</li>
<li><code>variables.tf</code> which we will use to define variables type</li>
<li><code>terraform.tfvars</code> which we will use to specify our desired configuration</li>
</ul>
<p>Our <code>variables.tf</code> file will include following variabels:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>variable &quot;tenant_name&quot; {
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>  default = &quot;dcloud-tenant-4&quot;
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>}
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>variable &quot;vrf_name&quot; {
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>  default = &quot;vrf1&quot;
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>}
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>variable &quot;bridge_domains&quot; {
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>  type = map(object({
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>    name = string
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>    arp_flood = string
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>    type = string
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>    gateway = string
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>    scope = list(string)
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>  }))
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>  default = {
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>    default_bd = {
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>      name = &quot;default&quot;
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>      arp_flood = &quot;yes&quot;
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>      type = &quot;L3&quot;
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>      gateway = &quot;192.168.1.1/24&quot;
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>      scope = [&quot;private&quot;]
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>    }
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>  }
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>}
</code></pre></div>
<p>In this example our bridge domains are configured with type (L2 or L3), name, ARP flooding mechanism, gateway (IP address) and its scope. We no longer define unicast routing and unknown unicast flooding mechanism. We want to set them based on the type of bridge domain we specify.</p>
<p>Our <code>terraform.tfvar</code> file will have our desired config of bridge domains:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>bridge_domains = {
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    bd01 = {
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>        name = &quot;192.168.1.0_24_bd&quot;
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>        type = &quot;L3&quot;
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>        gateway = &quot;192.168.1.1/24&quot;
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>        scope = [&quot;private&quot;]
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    },
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    bd02 = {
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>        name = &quot;192.168.2.0_24_bd&quot;
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>        type = &quot;L2&quot;
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>        gateway = null
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>        scope = null
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#__codelineno-20-15"></a>    }
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#__codelineno-20-16"></a>}
</code></pre></div>
<p>One of the bridge domains is L3 and has IP address, while the second one is L2 and has no IP address.
Inside <code>main.tf</code> we specify our resources configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>resource &quot;aci_tenant&quot; &quot;tenant&quot; {
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>  name        = &quot;${var.tenant_name}&quot;
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>}
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>resource &quot;aci_vrf&quot; &quot;vrf&quot; {
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>  tenant_dn              = aci_tenant.tenant.id
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>  name                   = var.vrf_name
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>}
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>resource &quot;aci_bridge_domain&quot; &quot;bd&quot; {
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>  for_each = var.bridge_domains
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>  tenant_dn                   = aci_tenant.tenant.id
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>  name                        = each.value.name
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>  arp_flood                   = each.value.arp_flood
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>  unicast_route               = each.value.type == &quot;L3&quot; ? &quot;yes&quot; : &quot;no&quot;
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>  unk_mac_ucast_act           = each.value.type == &quot;L3&quot; ? &quot;proxy&quot; : &quot;flood&quot;
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>  relation_fv_rs_ctx          = aci_vrf.vrf.id
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>}
</code></pre></div>
<p>We are again using <code>for_each</code> loop to create multiple resources for our bridge domains and we assign values like tenant_dn, name, VRF and ARP_flooding in the same way as before, by refering the <code>each.value.&lt;argument name&gt;</code>.
The difference is with assigning values for unicast routing and unknown unicast flooding mechanism. For these values we use conditional expression:</p>
<div class="highlight"><pre><span></span><code>unicast_route               = each.value.type == &quot;L3&quot; ? &quot;yes&quot; : &quot;no&quot;
</code></pre></div>
<p>This expression takes <code>each.value.type</code> of our object and verifies if the content of this type is <code>"L3"</code>. "?" symbol specified that we are checking this condition:</p>
<ul>
<li>if condition is <code>true</code> the result is that <code>unicast_route</code> argument will be assigned <code>"yes"</code> value</li>
<li>if condition is <code>false</code> the result is that <code>unicast_route</code> argument will be assigned <code>"no"</code> value</li>
</ul>
<p>In the same way we can read the second line for unknown unicast flooding verifying condition that <code>each.value.type</code> is <code>"L3"</code>:</p>
<ul>
<li>if condition is <code>true</code> the result is that <code>unk_mac_ucast_act</code> argument will be assigned <code>"proxy"</code> value</li>
<li>if condition is <code>false</code> the result is that <code>unk_mac_ucast_act</code> argument will be assigned <code>"flood"</code> value</li>
</ul>
<p>If we run our <code>terraform init</code>, <code>plan</code> and <code>apply</code> commands now, you will get two bridge domains configured with different settings based on the conditional expression. You can verify configuration in the APIC GUI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to change to the correct folder in the Terminal</p>
</div>
<p>Second thing we want to do is to create subnet resource, that will reflect our bridge domain IP address, but we want to do it only for L3 bridge domains. L2 BD doesn't require subnet to be configured and shouldn't have it at all. There would be no reason to deploy subnet resource for L2 bridge domain.
If we simply use the <code>for_each</code> expression, we would deploy subnet for all bridge domains we specify in our map, but we want to verify a condition expression here too. This can be done with a <code>for</code> expression.</p>
<p>A <code>for</code> expression creates a complex type value by transforming another complex type value. Each element in the input value can correspond to either one or zero values in the result, and an arbitrary expression can be used to transform each input element into an output element.
We want to use the <code>for</code> expression to modify our <code>for_each</code> block:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>resource &quot;aci_subnet&quot; &quot;net&quot; {
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>  for_each = { for k, v in var.bridge_domains: k =&gt; v if v.type == &quot;L3&quot; }
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>  parent_dn        = aci_bridge_domain.bd[each.key].id
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>  ip               = each.value.gateway
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>  scope            = each.value.scope
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>}
</code></pre></div>
<p>In this example we added the expression to the <code>for_each</code> block. This <code>for</code> loop is supposed to go iterate over every <code>k</code> (key) and <code>v</code> (value) pair in our map called <code>var.bridge_domains</code> and return those key and value pair only if the condition that "type" is set to "L3" is true. In reality <code>for</code> expression is returning (creating) new map variable that will consist only of key and value pairs of elements that pass our condition.
If we wanted to take a look at those values, we would have our bridge_domains map that we declared:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a>bridge_domains = {
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>    bd01 = {
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a>        name = &quot;192.168.1.0_24_bd&quot;
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a>        type = &quot;L3&quot;
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>        gateway = &quot;192.168.1.1/24&quot;
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>        scope = [&quot;private&quot;]
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a>    },
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>    bd02 = {
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a>        name = &quot;192.168.2.0_24_bd&quot;
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>        type = &quot;L2&quot;
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>        gateway = null
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a>        scope = null
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a>    }
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a>}
</code></pre></div>
<p>The new map variable created by <code>for</code> expression inside resource block would look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a>{
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>  bd01 = {
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>      name = &quot;192.168.1.0_24_bd&quot;
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>      arp_flood = &quot;yes&quot;
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>      type = &quot;L3&quot;
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>      gateway = &quot;192.168.1.1/24&quot;
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>      scope = [&quot;private&quot;]
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>  }
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>}
</code></pre></div>
<p>The second bd02 is not included in this temporary variable as it does not meet the condition.</p>
<p>The <code>for_each</code> loop can now loop over this map, which only contains one object (one key, value pair) and inside the resource we refer to this object in the same way as we would normally use, with <code>eack.key</code> and <code>each.value</code> arguments:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>parent_dn        = aci_bridge_domain.bd[each.key].id
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a>ip               = each.value.gateway
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>scope            = each.value.scope
</code></pre></div>
<p>If you run <code>terraform plan</code> and <code>apply</code> now, you will see that only one <code>aci_subnet</code> resource is being created for "bd01".</p>
<h2 id="4-data-sources">4. Data sources</h2>
<p>Terraform data sources let you dynamically fetch data from APIs or other Terraform state backends. This allows to fetch data from APIC that was already created, and this data source is always read-only. We can use it to read objects in ACI that were already created before either manually or by default like a common tenant in ACI. Those data sources can then be used to create relations with different resources that we want to deploy.
Data sources have separate documentation in the Terraform Registry
As an example we will try to deploy new bridge domain with VRF that will be placed in the common tenant. In ACI from day-0 there is <em>common</em> tenant deployed with <em>default</em> VRF. We will reference it for our new bridge domain. First we have to create two data sources that will reflect our tenant and VRF:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a>data &quot;aci_tenant&quot; &quot;common-tenant&quot; {
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    name = &quot;common&quot;
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>}
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>data &quot;aci_vrf&quot; &quot;common-vrf&quot; {
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>    tenant_dn   = data.aci_tenant.common-tenant.id
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    name        = &quot;default&quot;
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>}
</code></pre></div>
<p>Then we can start using references inside our new bridge domain:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>resource &quot;aci_bridge_domain&quot; &quot;bd-common&quot; {
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>  tenant_dn                   = aci_tenant.tenant.id
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>  name                        = &quot;bd-common&quot;
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>  arp_flood                   = &quot;yes&quot;
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>  unicast_route               = &quot;no&quot;
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>  unk_mac_ucast_act           = &quot;flood&quot;
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>  relation_fv_rs_ctx          = data.aci_vrf.common-vrf.id
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>}
</code></pre></div>
<p>The difference in a way we make references to data sources, instead of normal resource, is by adding <code>data.</code> before the data source name.
If we run <code>terraform plan</code> and <code>apply</code> now, we will see that Terraform tries to create new bridge domain:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>  + create
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>Terraform will perform the following actions:
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>  # aci_bridge_domain.bd-common will be created
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a>  + resource &quot;aci_bridge_domain&quot; &quot;bd-common&quot; {
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>      + annotation                  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a>      + arp_flood                   = &quot;yes&quot;
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>      + bridge_domain_type          = (known after apply)
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a>      + description                 = (known after apply)
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a>      + ep_clear                    = (known after apply)
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a>      + ep_move_detect_mode         = (known after apply)
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a>      + host_based_routing          = (known after apply)
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a>      + id                          = (known after apply)
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a>      + intersite_bum_traffic_allow = (known after apply)
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a>      + intersite_l2_stretch        = (known after apply)
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#__codelineno-28-18"></a>      + ip_learning                 = (known after apply)
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#__codelineno-28-19"></a>      + ipv6_mcast_allow            = (known after apply)
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#__codelineno-28-20"></a>      + limit_ip_learn_to_subnets   = (known after apply)
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#__codelineno-28-21"></a>      + ll_addr                     = (known after apply)
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#__codelineno-28-22"></a>      + mac                         = (known after apply)
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#__codelineno-28-23"></a>      + mcast_allow                 = (known after apply)
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#__codelineno-28-24"></a>      + multi_dst_pkt_act           = (known after apply)
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#__codelineno-28-25"></a>      + name                        = &quot;bd-common&quot;
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#__codelineno-28-26"></a>      + name_alias                  = (known after apply)
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#__codelineno-28-27"></a>      + optimize_wan_bandwidth      = (known after apply)
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#__codelineno-28-28"></a>      + relation_fv_rs_bd_to_ep_ret = (known after apply)
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#__codelineno-28-29"></a>      + relation_fv_rs_bd_to_nd_p   = (known after apply)
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#__codelineno-28-30"></a>      + relation_fv_rs_ctx          = &quot;uni/tn-common/ctx-default&quot;
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#__codelineno-28-31"></a>      + relation_fv_rs_igmpsn       = (known after apply)
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#__codelineno-28-32"></a>      + relation_fv_rs_mldsn        = (known after apply)
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#__codelineno-28-33"></a>      + tenant_dn                   = &quot;uni/tn-dcloud-tenant-4&quot;
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#__codelineno-28-34"></a>      + unicast_route               = &quot;no&quot;
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#__codelineno-28-35"></a>      + unk_mac_ucast_act           = &quot;flood&quot;
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#__codelineno-28-36"></a>      + unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#__codelineno-28-37"></a>      + v6unk_mcast_act             = (known after apply)
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#__codelineno-28-38"></a>      + vmac                        = (known after apply)
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#__codelineno-28-39"></a>    }
<a id="__codelineno-28-40" name="__codelineno-28-40" href="#__codelineno-28-40"></a>
<a id="__codelineno-28-41" name="__codelineno-28-41" href="#__codelineno-28-41"></a>Plan: 1 to add, 0 to change, 0 to destroy.
</code></pre></div>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/data-sources/tenant" target="_blank">aci_tenant data source</a>
<a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/data-sources/vrf" target="_blank">aci_vrf data source</a></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
    
    
  </body>
</html>