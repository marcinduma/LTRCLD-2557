
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Explore Simplicity of Public Cloud Network Configuration with Cloud Network Controller (formerly cAPIC) and Nexus Dashboard Orchestrator (NDO)">
      
      
        <meta name="author" content="Marcin Duma & Karol Okraska">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.16">
    
    
      
        <title>Print Site - CiscoLive EMEA 2023 --- LTRCLD-2557</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.1c3799f8.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site-enum-headings1.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings2.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings3.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings4.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings5.css">
    
      <link rel="stylesheet" href="../css/print-site-enum-headings6.css">
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
    <script>__md_scope=new URL("/",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CiscoLive EMEA 2023 --- LTRCLD-2557" class="md-header__button md-logo" aria-label="CiscoLive EMEA 2023 --- LTRCLD-2557" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CiscoLive EMEA 2023 --- LTRCLD-2557
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Print Site
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CiscoLive EMEA 2023 --- LTRCLD-2557" class="md-nav__button md-logo" aria-label="CiscoLive EMEA 2023 --- LTRCLD-2557" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CiscoLive EMEA 2023 --- LTRCLD-2557
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Lab Access
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Lab Access" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Lab Access
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../LAB_access/" class="md-nav__link">
        Accessing the Lab Environment
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          First LAB sections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="First LAB sections" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          First LAB sections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../postman/" class="md-nav__link">
        Install and operate Postman
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../restAPI/" class="md-nav__link">
        Automation basis with restAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../use-cases-postman/" class="md-nav__link">
        Create customer use-cases with Postman
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../monitor-aci/" class="md-nav__link">
        How to pull informations using restAPI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Second LAB sections
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Second LAB sections" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Second LAB sections
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-installation/" class="md-nav__link">
        Terraform setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-basis/" class="md-nav__link">
        Terraform basic deployment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-vars/" class="md-nav__link">
        Terraform variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-state/" class="md-nav__link">
        Terraform state
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-custom/" class="md-nav__link">
        Terraform use-cases
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../terraform-modules/" class="md-nav__link">
        Terraform modules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Appendixes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Appendixes" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Appendixes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../guacamole/" class="md-nav__link">
        dCloudGuacamole
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../resources/" class="md-nav__link">
        Resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../URL-restAPI/" class="md-nav__link">
        Collection of RestAPI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="./" class="md-nav__link">
        PRINT version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#" class="md-nav__link">
    1. Home
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-lab-access" class="md-nav__link">
    I. Lab Access
  </a>
  
    <nav class="md-nav" aria-label="I. Lab Access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#lab_access" class="md-nav__link">
    2. Accessing the Lab Environment
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-first-lab-sections" class="md-nav__link">
    II. First LAB sections
  </a>
  
    <nav class="md-nav" aria-label="II. First LAB sections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#postman" class="md-nav__link">
    3. Install and operate Postman
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#restapi" class="md-nav__link">
    4. Automation basis with restAPI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#use-cases-postman" class="md-nav__link">
    5. Create customer use-cases with Postman
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monitor-aci" class="md-nav__link">
    6. How to pull informations using restAPI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-second-lab-sections" class="md-nav__link">
    III. Second LAB sections
  </a>
  
    <nav class="md-nav" aria-label="III. Second LAB sections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terraform-installation" class="md-nav__link">
    7. Terraform setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-basis" class="md-nav__link">
    8. Terraform basic deployment
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-vars" class="md-nav__link">
    9. Terraform variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-state" class="md-nav__link">
    10. Terraform state
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-custom" class="md-nav__link">
    11. Terraform use-cases
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-modules" class="md-nav__link">
    12. Terraform modules
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-appendixes" class="md-nav__link">
    IV. Appendixes
  </a>
  
    <nav class="md-nav" aria-label="IV. Appendixes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#guacamole" class="md-nav__link">
    13. dCloudGuacamole
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resources" class="md-nav__link">
    14. Resources
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#url-restapi" class="md-nav__link">
    15. Collection of RestAPI
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section id="print-site-cover-page">
            <div>

    
        <h1>CiscoLive EMEA 2023 --- LTRCLD-2557</h1>
    

</div>


<table>

    
    <tr>
        <td>Description</td>
        <td>Explore Simplicity of Public Cloud Network Configuration with Cloud Network Controller (formerly cAPIC) and Nexus Dashboard Orchestrator (NDO)</td>
    </tr>
    

    
    <tr>
        <td>Author(s)</td>
        <td>Marcin Duma & Karol Okraska</td>
    </tr>
    

    

    

</table>
        </section>
        
        <div id="print-site-banner">
            <p>
<center><em>This box will disappear when printing</em></center>
</p>
<p>
<center> This page has combined all site pages into one. You can export to PDF using <b>File > Print > Save as PDF</b>.</center>
</p>
        </div>
        
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index"><h1 id="index-welcome-to-ciscolive-instructor-lab-about-aci-multicloud">Welcome to CiscoLive Instructor Lab about ACI Multicloud</h1>
<p>Speakers:</p>
<p><em>Karol Okraska</em>, CX Delivery Architect, Cisco Systems, Inc.</p>
<p><em>Marcin Duma</em>, CX Delivery Architect, Cisco Systems, Inc.</p>
<h2 id="index-cisco-support-of-public-cloud-infrastructure">Cisco support of Public Cloud infrastructure</h2>
<p>Cisco Application Centric Infrastructure (ACI) is a software-defined networking (SDN) solution designed for data centers. Cisco ACI allows network infrastructure to be defined based upon network policies – simplifying, optimizing, and accelerating the application deployment lifecycle. Network Controllers provide more than just a centralized management for networks today. They can also provide a place in the network to deploy network applications to add new capabilities.</p>
<p>The Cisco ACI programmability model provides complete programmatic access. You can integrate network deployment with management and monitoring tools and programmatically deploy new workloads.</p>
<p>Networks have traditionally been built with devices that are designed to be configured and maintained on a per device basis. To make changes or troubleshoot, a network engineer must connect to multiple devices individually and enter commands on the CLI. This solution works fine for mostly static environments, but does not scale and is prone to human error as changes are made more frequently and repetitively. Since the CLI was built for humans, it is less than ideal interface for programmability and automation.
This is the core problem ACI solves for data center operations. ACI's programmability options are made possible through the ACI Object Model.</p>
<p>ACI was built with programmability in mind and designed to be configured and maintained through a central controller via a REST API. This API is how admins interact with the object-model allowing them to create, make changes, gather stats, and troubleshoot the ACI fabric.</p>
<p>During this ACI Automation practice training you will have a chance to explore ACI Object Model and learn how to leverage it for automation in daily operations.</p>
<h2 id="index-high-level-design-of-lab-scenario">High Level Design of Lab scenario.</h2>
<p>ACI Automation Lab is based on dCloud session publicly available. Session name <em>Started with Cisco ACI 5.2 v1</em> can be found in Session catalog at <em>https://dcloud2-lon.cisco.com/</em>.</p>
<p>Below is the physical setup of our Virtual lab.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/Overal-ACI-Automation.PNG"></p>
<p><strong><p style="text-align: center;">Enjoy!</p></strong></p></section>
                        <h1 class='nav-section-title' id='section-lab-access'>
                            Lab Access <a class='headerlink' href='#section-lab-access' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="lab_access"><h1 id="lab_access-connectivity-check">Connectivity Check</h1>
<h2 id="lab_access-1-lab-access-general-description">1. Lab access general description</h2>
<p>The lab is based on dCloud session <em>Started with Cisco ACI 5.2 v1</em>:</p>
<p>You will have access to Cisco dCloud User Interface, where you will be able to login to necessary resources. Each dCloud session contain Windows Workstation, Centos server tool and ACI Simulator. You will work on your dedicated session - details will be provided by instructor.
During the training you will use only dCloud resources, no need to install additional applications at your PC.</p>
<h2 id="lab_access-2-cisco-dcloud-dashboard">2. Cisco dCloud dashboard</h2>
<p>The entire lab for the session is built using Cisco dCloud environment.
Access to the Session will be provided by the proctor assigned to you.</p>
<p>You will get credentials for your individual session provided by teacher.</p>
<h3 id="lab_access-access-session-with-webrdp">Access session with webRDP</h3>
<p>Once logged to the dCloud session, you will see dashboard like on the following picture:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/dCloud-dashboard.PNG" width = 800></p>
<p>To open *<em>webRDP</em> follow the procedure from the figures:</p>
<p>1) Click on the blue triangle highlighted on figure below</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/dCloud-rdp-1.PNG" width = 800></p>
<p>2) Follow to "Remote Desktop" by using link in red frame on the figure:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/dCloud-rdp-2.PNG" width = 800></p>
<p>When you click on "Remote Desktop" link, your web browser will open new TAB with access to Windows desktop. The webRDP has installed basic tools to operate with the LAB. Rest of them you will install yourself for better undestanding of prerequisites for Automation.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Please do not use "Remote Desktop" for other devices from the list at <strong>Network</strong> tab. ONLY win-workstation can be accessed that way.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>When you use webRDP you are still able to copy/paste between your 'main PC' and webRDP interface. You can use <em>Guacamole interface</em> - explained in Appendix: Guacamole.</p>
</div>
<h2 id="lab_access-3-accessing-linux-machine">3. Accessing Linux Machine</h2>
<p>Open PuTTY client on webRDP taskbar.</p>
<p>PuTTY has predefined session called <strong>tool1</strong> for centos-terminal. Open SSH session by selecting it and click Open button.</p>
<p>Username:</p>
<div class="highlight"><pre><span></span><code>root
</code></pre></div>
<p>User password:</p>
<div class="highlight"><pre><span></span><code>C1sco12345
</code></pre></div>
<h2 id="lab_access-4-accessing-aci-simulator">4. Accessing ACI simulator</h2>
<p>The LAB is based on ACI simulator installed for you. To login, please use CHROME at webRDP workstation. Once you click at Chrome icon in taskbar, you get APIC gui open. Login using credentials below</p>
<p>URL:</p>
<div class="highlight"><pre><span></span><code>https://apic1.dcloud.cisco.com/
</code></pre></div>
<p>Username:</p>
<div class="highlight"><pre><span></span><code>admin
</code></pre></div>
<p>User password:</p>
<div class="highlight"><pre><span></span><code>C1sco12345
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not delete any configuration already present at ANY device within the LAB topology.</p>
</div></section><h1 class='nav-section-title-end'>Ended: Lab Access</h1>
                        <h1 class='nav-section-title' id='section-first-lab-sections'>
                            First LAB sections <a class='headerlink' href='#section-first-lab-sections' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="postman"><h1 id="postman-install-and-operate-postman">Install and Operate Postman</h1>
<p>Postman is an API platform for building and using APIs. Postman simplifies each step of the API lifecycle and streamlines collaboration so you can create better APIs—faster.</p>
<h2 id="postman-1-install-postman-in-your-workstation">1. Install Postman in your workstation</h2>
<p>First step to do in our dCloud lab is download and install of Postman. Login to your dCloud workstation and from the Chrome connect to:</p>
<div class="highlight"><pre><span></span><code>https://www.postman.com/downloads/
</code></pre></div>
<p>Select Windows 64-bit to download the installation file.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-download.PNG" width = 800></p>
<p>Download the file to local folder of your choice.
Start installation - it will automatically install and open application.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You installed and run Postman in <em>Scratch Pad</em> version. If you would like to use workspace version, it is required to setup Free account. It will keep your Postman Collections in cloud, helps to collaborate and backup work you do.</p>
</div>
<h2 id="postman-2-initial-setup-of-postman">2 Initial setup of Postman</h2>
<p>Once the Postman is up and running you should create few things. First, setup your <strong>Environment</strong> data. Environment definition can be reused later, it is also good way to keep secured sensitive data like credentials. Second, create your <strong>Request Collection</strong> or import one from .json file.</p>
<h4 id="postman-21-create-environment-for-our-dcloud-lab">2.1 Create Environment for our dCloud lab</h4>
<p>Environment definition is a place where you can store information about IP address of APIC and credentials. Once you run your restAPI queries, Postman will automatically use variables defined here.
Lets do it then for our scenario.</p>
<p>Navigate to Environment section in Postman Dashboard as marked on figure below.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-env-1.png" width = 800></p>
<p>In this place you can select existing Environment, edit/delete it or create new one. To review existing Environment use icon most on right in red marked section on Figure above. It will open section shown at next figure. Click <strong>Add</strong> to create new entry.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-env-2.png" width = 800></p>
<p><em>Add</em> button will move you to new Postman Tab</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-env-3.png" width = 800></p>
<ol>
<li>
<p>Change name of your Environment to:</p>
<div class="highlight"><pre><span></span><code>ACI-dcloud
</code></pre></div>
</li>
<li>
<p>Configure VARIABLES:</p>
<div class="highlight"><pre><span></span><code>apic, user, password
</code></pre></div>
</li>
<li>
<p>INITIAL VALUES:</p>
<div class="highlight"><pre><span></span><code>198.18.133.200, admin, C1sco12345
</code></pre></div>
</li>
<li>
<p>Change Type of data for password to <strong>secret</strong></p>
</li>
<li>
<p>Save it.</p>
</li>
</ol>
<p>Now you have ready Environment you can choice from drop-down menu.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-env-4.png" width = 800></p>
<p>You will use it for rest of <strong>Day1</strong> exercises.</p>
<h3 id="postman-22-create-new-collection">2.2 Create New Collection</h3>
<p>Click on Link <strong>Create Collection</strong> indicated in the figure below:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-1.png" width = 800></p>
<p>Name your New Collection </p>
<div class="highlight"><pre><span></span><code>    ACI dCloud
</code></pre></div>
<p>Set Authorization type to <em>Basic Auth</em>. Once done, use <strong>Ctrl+S</strong> or Save button on dashboard - Floppy Disk icon.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-2.png" width = 800></p>
<p>Do not type anything to "Username" and "Password". Those data will be pulled from your Environment - created in previous task.</p>
<p>Now you have Environment and Collection ready. We can start working with our restAPI requests.</p></section><section class="print-page" id="restapi"><h1 id="restapi-cisco-aci-rest-api">Cisco ACI rest API</h1>
<p>In this lab section you will create and execute list of API calls to configure ACI managed objects as well as read data from existing polices and devices. After this section you should feel comfortable with running simple automation tasks and build your own tasks for further customizations. You will be familiar with Postman dashboard and general idea of running request individually or as a collection defined.</p>
<h2 id="restapi-1-define-restapi-calls-under-collection">1 Define restAPI calls under Collection</h2>
<p>Now is a time to work with our requests to GET or POST restAPI. You will define couple of them during the LAB. Figure below shows where to navigate to create new request in your collection.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-request-1.png" width = 800></p>
<p>Every API command have predefined structure. Administrator needs to specify URI for correct object are you going to work with. Everything is described in details under the following link:
<a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/2-x/rest_cfg/2_1_x/b_Cisco_APIC_REST_API_Configuration_Guide/b_Cisco_APIC_REST_API_Configuration_Guide_chapter_01.html" target="_blank">Cisco ACI API Configuration guide</a>.</p>
<p>The figure below shows structure of every API call:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/349945.png" width = 800></p>
<h3 id="restapi-11-create-aci-login-request">1.1 Create ACI login request</h3>
<p>First request when working with ACI must be authentication. Without having your session authenticated, no API calls can be successfully executed. Information about Authentication request structure can be found here:</p>
<p><a href="https://www.cisco.com/c/en/us/td/docs/switches/datacenter/aci/apic/sw/2-x/rest_cfg/2_1_x/b_Cisco_APIC_REST_API_Configuration_Guide/b_Cisco_APIC_REST_API_Configuration_Guide_chapter_01.html#concept_D16AC6DC9CCD4351A4A40287487F061A" target="_blank">Cisco ACI Authentication API</a>.</p>
<p>Define it in Postman:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-aaalogin-1.png" width = 800></p>
<p>In New Request section specify:</p>
<p>1) Name of Request</p>
<div class="highlight"><pre><span></span><code>    ACI Login
</code></pre></div>
<p>2) Select Method to be <strong>POST</strong></p>
<p>3) Enter request URL</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/aaaLogin.json
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please notice that it's first place you use your Environment Variable = apic. In JSON definition every variable is closed by <strong>{{ }}</strong>.</p>
</div>
<p>4) Move to <strong>Body</strong> section for further work with your request</p>
<p>Once you open Body section, you need to select type of data to be <strong>raw</strong> and coding to <strong>JSON</strong>.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-aaalogin-2.png" width = 800></p>
<p>Now you can copy code defined below to body section of your request.</p>
<div class="highlight"><span class="filename">aaaLogin</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#restapi-__codelineno-0-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#restapi-__codelineno-0-2"></a><span class="w">  </span><span class="nt">&quot;aaaUser&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#restapi-__codelineno-0-3"></a><span class="w">    </span><span class="nt">&quot;attributes&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#restapi-__codelineno-0-4"></a><span class="hll"><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{user}}&quot;</span><span class="p">,</span><span class="w"></span>
</span><a id="__codelineno-0-5" name="__codelineno-0-5" href="#restapi-__codelineno-0-5"></a><span class="hll"><span class="w">      </span><span class="nt">&quot;pwd&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{password}}&quot;</span><span class="w"></span>
</span><a id="__codelineno-0-6" name="__codelineno-0-6" href="#restapi-__codelineno-0-6"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#restapi-__codelineno-0-7"></a><span class="w">  </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#restapi-__codelineno-0-8"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p><strong><mark>Yellow</mark></strong> highlighted text in the json code above will use variables you defined in <strong>Environment</strong> at the beginning of the Lab.</p>
<p>Now your Request should looks like on the figure below.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-aaalogin-3.png" width = 800></p>
<p><span style="color:blue"><strong>It's time to TEST it!</strong></span>.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-aaalogin-4.png" width = 800></p>
<p>Click on <strong>Send</strong> button. Make sure your environment <strong>ACI-dcloud</strong> is selected - above the Send button.</p>
<p>When works as expected you will be authenticated to APIC. Responce from the APIC is visible in the section at your screen.
Let's go together across results you see on the screen. First is a Status <strong> 200 OK </strong> - means APIC server accepted your request, execute it and responce with data. In the REPLY Body you see JSON structure data. You can see <strong>token</strong> which is your authentication token. <strong>RefreshTimeoutSeconds</strong> set to 600 seconds = 10 minutes. Token is valid for 10 minutes and after that period will expire.</p>
<p>Please scroll down across the response body yourself.  Look for such information:</p>
<ul>
<li>userName</li>
<li>sessionId</li>
<li>aaaWriteRoles</li>
</ul>
<p>Write them down to notepad.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-aaalogin-5.png" width = 800></p>
<h3 id="restapi-register-your-aci-fabric-switches-in-apic">Register your ACI Fabric Switches in APIC</h3>
<p>Lab is clear and leaf/spines requires registration. You can automate it using Postman.</p>
<p>Configure new Postman POST Request with code <strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/fabricinfra.json" target="_blank">downloaded from here</a></strong></p>
<p>use URI:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/class/fabricNode.json
</code></pre></div>
<p>Contact Instructor in case of issues.</p>
<h3 id="restapi-12-get-information-about-a-node">1.2 Get Information About a Node</h3>
<p>POST is not only one request type. You can configure your ACI fabric, but you can use restAPI to pull data you are interest to analyse. This excercise is about writing a <strong>GET</strong> Request under already created ACI collection. As an example you will pull information about Leaf node-101 system in <em>json</em>.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-get-node101-1.PNG" width = 800></p>
<p>Name your new Request</p>
<div class="highlight"><pre><span></span><code>    Node-101-topsystem check
</code></pre></div>
<p>Copy the URI to GET request:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/mo/topology/pod-1/node-101/sys.json
</code></pre></div>
<p>Save new Request and Click <strong>Send</strong> .</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It may happen that your API Token expired - remember its valid only 10 minutes. If you experience it, go to <em>ACI Login</em> Request and Send it again to re-authenticate.</p>
</div>
<p>In the Body responce you can verify topsystem information about Leaf in your Fabric.
You can pull data about AccessPolices, Interfaces as well as Logical construct - Tenant, EPGs, VRFs etc. The idea is always same - specify correct URL. Another test will be quering information about APIC node and current firmware version running on it.</p>
<p>Please Create another Request under your Collection with following setup:</p>
<p>Name of Request:</p>
<div class="highlight"><pre><span></span><code>    Get Running Firmware
</code></pre></div>
<p>GET request URI:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/mo/topology/pod-1/node-1/sys/ctrlrfwstatuscont.json?query-target=subtree&amp;target-subtree-class=firmwareCtrlrRunning
</code></pre></div>
<p>Please observe that current query is composed with parameters. Before we pulled data directly from top-system of our ACI Leaf. Now you are narrowing the output to only sub-class you are intrested about.
Try to delete part of URI <mark><strong>?query-target=subtree&amp;target-subtree-class=firmwareCtrlrRunning</strong></mark> and do Send again.</p>
<h2 id="restapi-2-aci-access-polices">2  ACI Access Polices</h2>
<p>Every ACI Fabric configuration starts with Access Polices. You need to define ACI objects which represent single physical port configurations. To remind relationships between objects, please check following figure.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/access-polices.png" width = 800></p>
<p>Usually Interface Polices are configured once and re-used like LLDP, LACP, CDP, etc. However our LAB is empty and you need to start from zero. Following sections will help you to prepare your API requests.</p>
<h3 id="restapi-21-interface-policies">2.1 Interface Policies</h3>
<p>You will configure LACP Policy, LLDP_ON, LINK-10G. Copy each of the Policy json definition to individual POST requests under your ACI Collection in Postman.</p>
<p>Use URI to POST:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni.json
</code></pre></div>
<div class="highlight"><span class="filename">LACP_ACTIVE</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#restapi-__codelineno-1-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#restapi-__codelineno-1-2"></a><span class="w">  </span><span class="nt">&quot;lacpLagPol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#restapi-__codelineno-1-3"></a><span class="w">    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#restapi-__codelineno-1-4"></a><span class="w">      </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/lacplagp-LACP_ACTIVE&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#restapi-__codelineno-1-5"></a><span class="w">      </span><span class="nt">&quot;ctrl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fast-sel-hot-stdby,graceful-conv,susp-individual&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#restapi-__codelineno-1-6"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LACP_ACTIVE&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#restapi-__codelineno-1-7"></a><span class="w">      </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#restapi-__codelineno-1-8"></a><span class="w">      </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lacplagp-LACP_ACTIVE&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#restapi-__codelineno-1-9"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#restapi-__codelineno-1-10"></a><span class="w">    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#restapi-__codelineno-1-11"></a><span class="w">    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#restapi-__codelineno-1-12"></a><span class="w">  </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#restapi-__codelineno-1-13"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><span class="filename">LLDP_ON</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#restapi-__codelineno-2-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#restapi-__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;lldpIfPol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#restapi-__codelineno-2-3"></a><span class="w">    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#restapi-__codelineno-2-4"></a><span class="w">      </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/lldpIfP-LLDP_ON&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#restapi-__codelineno-2-5"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLDP_ON&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#restapi-__codelineno-2-6"></a><span class="w">      </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lldpIfP-LLDP_ON&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#restapi-__codelineno-2-7"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#restapi-__codelineno-2-8"></a><span class="w">    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#restapi-__codelineno-2-9"></a><span class="w">    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#restapi-__codelineno-2-10"></a><span class="w">  </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#restapi-__codelineno-2-11"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><span class="filename">LINK-10G</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#restapi-__codelineno-3-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#restapi-__codelineno-3-2"></a><span class="w">    </span><span class="nt">&quot;fabricHIfPol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#restapi-__codelineno-3-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#restapi-__codelineno-3-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/hintfpol-LINK-10G&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#restapi-__codelineno-3-5"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LINK-10G&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#restapi-__codelineno-3-6"></a><span class="w">            </span><span class="nt">&quot;speed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10G&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#restapi-__codelineno-3-7"></a><span class="w">            </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;hintfpol-LINK-10G&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#restapi-__codelineno-3-8"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#restapi-__codelineno-3-9"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#restapi-__codelineno-3-10"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#restapi-__codelineno-3-11"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#restapi-__codelineno-3-12"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="restapi-22-vlans-domains-and-aaeps">2.2 VLANs, Domains and AAEPs</h3>
<p>Create VLAN pool with vlan-range, associate it with Physical Domain and AAEP.
Now you will change an approach. Your task is to create VLAN Pool with APIC GUI and capture json code from <strong>API Inspector</strong>.</p>
<p>Connect to your APIC using bookmark in dCloud workstation Chrome. Navigate to Access Polices -&gt; Pools -&gt; VLAN. When you are there, Click on <em>Help and Tools</em> menu in APIC Dashboard</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/apic-api-inspector.png" width = 800></p>
<p>and Click on <strong>Show API Inspector</strong>. In new window you will open API Inspector, where you can capture every API call send to the APIC server.</p>
<p>Now you can start ADD VLAN-pool in APIC GUI.</p>
<p>VLAN POOL NAME:</p>
<div class="highlight"><pre><span></span><code>    vlan-pool
</code></pre></div>
<p><strong>Allocation Mode:</strong> Static</p>
<p><strong>Encap Blocks</strong>: 100-200, Inherit Allocation mode from parent, <strong>Role:</strong> External or On the wire encapsulations</p>
<p>SUBMIT and open API Inspector in the another Chrome Window.</p>
<p>Search for <mark><strong>POST</strong></mark> method.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/api-inspector-vlanpool.png" width = 800></p>
<p>COPY now ALL POST URI from API Inspector to Postman request Body.</p>
<p>You should capture data as shown in code below.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#restapi-__codelineno-4-1"></a><span class="err">h</span><span class="kc">tt</span><span class="err">ps</span><span class="p">:</span><span class="c1">//apic1.dcloud.cisco.com/api/node/mo/uni/infra/vlanns-[vlan-pool]-static.json</span><span class="w"></span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#restapi-__codelineno-4-2"></a><span class="err">payload</span><span class="w"></span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#restapi-__codelineno-4-3"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#restapi-__codelineno-4-4"></a><span class="w">    </span><span class="nt">&quot;fvnsVlanInstP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#restapi-__codelineno-4-5"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#restapi-__codelineno-4-6"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/vlanns-[vlan-pool]-static&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#restapi-__codelineno-4-7"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlan-pool&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#restapi-__codelineno-4-8"></a><span class="w">            </span><span class="nt">&quot;allocMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;static&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#restapi-__codelineno-4-9"></a><span class="w">            </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlanns-[vlan-pool]-static&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#restapi-__codelineno-4-10"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#restapi-__codelineno-4-11"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#restapi-__codelineno-4-12"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#restapi-__codelineno-4-13"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#restapi-__codelineno-4-14"></a><span class="w">                </span><span class="nt">&quot;fvnsEncapBlk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#restapi-__codelineno-4-15"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#restapi-__codelineno-4-16"></a><span class="w">                        </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/vlanns-[vlan-pool]-static/from-[vlan-100]-to-[vlan-200]&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#restapi-__codelineno-4-17"></a><span class="w">                        </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlan-100&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#restapi-__codelineno-4-18"></a><span class="w">                        </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlan-200&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#restapi-__codelineno-4-19"></a><span class="w">                        </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;from-[vlan-100]-to-[vlan-200]&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#restapi-__codelineno-4-20"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#restapi-__codelineno-4-21"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#restapi-__codelineno-4-22"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#restapi-__codelineno-4-23"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#restapi-__codelineno-4-24"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#restapi-__codelineno-4-25"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#restapi-__codelineno-4-26"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#restapi-__codelineno-4-27"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Now it's time to build a request from data captured. You will use that request in the future for adding more vlan pools.</p>
<p>First, copy URL and place it in Postman URL. Replace apic1.dcloud.cisco.com with our variable {{apic}}. Next replace vlanpool name in [ ] brakets.
New URI looks like that:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni/infra/vlanns-[{{vlanpoolname}}]-static.json
</code></pre></div>
<p><div class="highlight"><span class="filename">VLAN POOL</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#restapi-__codelineno-5-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#restapi-__codelineno-5-2"></a><span class="w">    </span><span class="nt">&quot;fvnsVlanInstP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#restapi-__codelineno-5-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#restapi-__codelineno-5-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/vlanns-[{{vlanpoolname}}]-static&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#restapi-__codelineno-5-5"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{vlanpoolname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#restapi-__codelineno-5-6"></a><span class="w">            </span><span class="nt">&quot;allocMode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;static&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#restapi-__codelineno-5-7"></a><span class="w">            </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlanns-[{{vlanpoolname}}]-static&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#restapi-__codelineno-5-8"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#restapi-__codelineno-5-9"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#restapi-__codelineno-5-10"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#restapi-__codelineno-5-11"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#restapi-__codelineno-5-12"></a><span class="w">                </span><span class="nt">&quot;fvnsEncapBlk&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#restapi-__codelineno-5-13"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#restapi-__codelineno-5-14"></a><span class="w">                        </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/vlanns-[{{vlanpoolname}}]-static/from-[vlan-{{vlanstart}}]-to-[vlan-{{vlanend}}]&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#restapi-__codelineno-5-15"></a><span class="w">                        </span><span class="nt">&quot;from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlan-{{vlanstart}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#restapi-__codelineno-5-16"></a><span class="w">                        </span><span class="nt">&quot;to&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlan-{{vlanend}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#restapi-__codelineno-5-17"></a><span class="w">                        </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;from-[vlan-{{vlanstart}}]-to-[vlan-{{vlanend}]&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#restapi-__codelineno-5-18"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#restapi-__codelineno-5-19"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#restapi-__codelineno-5-20"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#restapi-__codelineno-5-21"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#restapi-__codelineno-5-22"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#restapi-__codelineno-5-23"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#restapi-__codelineno-5-24"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#restapi-__codelineno-5-25"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
Variables <em>{{vlanpoolname}}, {{vlanstart}}, {{vlanend}}</em> you can replace by hardcoded values in your code, or define values in Environment. Later today you will see the powerfull of variables using csv file for input data.</p>
<p>Same approach please use in Domain and AAEP creation - Go to GUI, do Domain - PHY-DOM, associate with <strong>vlan-pool</strong> and AAEP - dcloud-AAEP. Observe API Inspector, capture the code and build those two requests in Postman.</p>
<p>URI for AAEP Function:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni/infra.json
</code></pre></div>
<div class="highlight"><span class="filename">AAEP</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#restapi-__codelineno-6-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#restapi-__codelineno-6-2"></a><span class="w">    </span><span class="nt">&quot;infraInfra&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#restapi-__codelineno-6-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#restapi-__codelineno-6-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#restapi-__codelineno-6-5"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;modified&quot;</span><span class="w"></span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#restapi-__codelineno-6-6"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#restapi-__codelineno-6-7"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#restapi-__codelineno-6-8"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#restapi-__codelineno-6-9"></a><span class="w">                </span><span class="nt">&quot;infraAttEntityP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#restapi-__codelineno-6-10"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#restapi-__codelineno-6-11"></a><span class="w">                        </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/attentp-{{aaep}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#restapi-__codelineno-6-12"></a><span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{aaep}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#restapi-__codelineno-6-13"></a><span class="w">                        </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;attentp-{{aaep}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#restapi-__codelineno-6-14"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#restapi-__codelineno-6-15"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#restapi-__codelineno-6-16"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#restapi-__codelineno-6-17"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#restapi-__codelineno-6-18"></a><span class="w">            </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#restapi-__codelineno-6-19"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#restapi-__codelineno-6-20"></a><span class="w">                </span><span class="nt">&quot;infraFuncP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#restapi-__codelineno-6-21"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#restapi-__codelineno-6-22"></a><span class="w">                        </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/funcprof&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#restapi-__codelineno-6-23"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;modified&quot;</span><span class="w"></span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#restapi-__codelineno-6-24"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#restapi-__codelineno-6-25"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#restapi-__codelineno-6-26"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#restapi-__codelineno-6-27"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#restapi-__codelineno-6-28"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#restapi-__codelineno-6-29"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#restapi-__codelineno-6-30"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Last one is Domain. Create Physical domain PHY-DOM with vlan pool associated <em>vlan-pool</em> and AAEP <em>dcloud-AAEP</em>.</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni/phys-{{domain}}.json
</code></pre></div>
<p><div class="highlight"><span class="filename">Domain</span><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#restapi-__codelineno-7-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#restapi-__codelineno-7-2"></a><span class="w">    </span><span class="nt">&quot;physDomP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#restapi-__codelineno-7-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#restapi-__codelineno-7-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/phys-{{domain}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#restapi-__codelineno-7-5"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{domain}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#restapi-__codelineno-7-6"></a><span class="w">            </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;phys-{{domain}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#restapi-__codelineno-7-7"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#restapi-__codelineno-7-8"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#restapi-__codelineno-7-9"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#restapi-__codelineno-7-10"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#restapi-__codelineno-7-11"></a><span class="w">                </span><span class="nt">&quot;infraRsVlanNs&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#restapi-__codelineno-7-12"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#restapi-__codelineno-7-13"></a><span class="w">                        </span><span class="nt">&quot;tDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/vlanns-[{{vlanpoolname}}]-static&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#restapi-__codelineno-7-14"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#restapi-__codelineno-7-15"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#restapi-__codelineno-7-16"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#restapi-__codelineno-7-17"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#restapi-__codelineno-7-18"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#restapi-__codelineno-7-19"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#restapi-__codelineno-7-20"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#restapi-__codelineno-7-21"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
Interesting fact about domain to AAEP association. Domain is sub-object to AAEP, you will not see AAEP under Domain definition, even you specify it in APIC GUI. In API you need to add it under AAEP.</p>
<div class="highlight"><pre><span></span><code>https://{{apic}}/api/node/mo/uni/infra.json
</code></pre></div>
<div class="highlight"><span class="filename">Domain to AAEP association</span><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#restapi-__codelineno-8-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#restapi-__codelineno-8-2"></a><span class="w">    </span><span class="nt">&quot;infraAttEntityP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#restapi-__codelineno-8-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#restapi-__codelineno-8-4"></a><span class="w">            </span><span class="nt">&quot;annotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#restapi-__codelineno-8-5"></a><span class="w">            </span><span class="nt">&quot;descr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#restapi-__codelineno-8-6"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/attentp-{{aaep}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#restapi-__codelineno-8-7"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{aaep}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#restapi-__codelineno-8-8"></a><span class="w">            </span><span class="nt">&quot;nameAlias&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#restapi-__codelineno-8-9"></a><span class="w">            </span><span class="nt">&quot;ownerKey&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#restapi-__codelineno-8-10"></a><span class="w">            </span><span class="nt">&quot;ownerTag&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#restapi-__codelineno-8-11"></a><span class="w">            </span><span class="nt">&quot;userdom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;:all:&quot;</span><span class="w"></span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#restapi-__codelineno-8-12"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#restapi-__codelineno-8-13"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#restapi-__codelineno-8-14"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#restapi-__codelineno-8-15"></a><span class="w">                </span><span class="nt">&quot;infraRsDomP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#restapi-__codelineno-8-16"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#restapi-__codelineno-8-17"></a><span class="w">                        </span><span class="nt">&quot;annotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#restapi-__codelineno-8-18"></a><span class="w">                        </span><span class="nt">&quot;tDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/phys-{{domain}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#restapi-__codelineno-8-19"></a><span class="w">                        </span><span class="nt">&quot;userdom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;:all:&quot;</span><span class="w"></span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#restapi-__codelineno-8-20"></a><span class="w">                    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#restapi-__codelineno-8-21"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#restapi-__codelineno-8-22"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#restapi-__codelineno-8-23"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#restapi-__codelineno-8-24"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#restapi-__codelineno-8-25"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="restapi-23-interface-policy-group">2.3 Interface Policy Group</h3>
<p>Lets now create one of the Interface policy group and use all created policy.</p>
<div class="highlight"><span class="filename">Interface Policy Group VPC</span><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#restapi-__codelineno-9-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#restapi-__codelineno-9-2"></a><span class="w">    </span><span class="nt">&quot;infraAccBndlGrp&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#restapi-__codelineno-9-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#restapi-__codelineno-9-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/funcprof/accbundle-intpolgrp-vpc-server1&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#restapi-__codelineno-9-5"></a><span class="w">            </span><span class="nt">&quot;lagT&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#restapi-__codelineno-9-6"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;intpolgrp-vpc-server1&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#restapi-__codelineno-9-7"></a><span class="w">            </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;accbundle-intpolgrp-vpc-server1&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#restapi-__codelineno-9-8"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#restapi-__codelineno-9-9"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#restapi-__codelineno-9-10"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#restapi-__codelineno-9-11"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#restapi-__codelineno-9-12"></a><span class="w">                </span><span class="nt">&quot;infraRsAttEntP&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#restapi-__codelineno-9-13"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#restapi-__codelineno-9-14"></a><span class="w">                        </span><span class="nt">&quot;tDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/infra/attentp-dcloud-AAEP&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#restapi-__codelineno-9-15"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created,modified&quot;</span><span class="w"></span>
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#restapi-__codelineno-9-16"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#restapi-__codelineno-9-17"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#restapi-__codelineno-9-18"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#restapi-__codelineno-9-19"></a><span class="w">            </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#restapi-__codelineno-9-20"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#restapi-__codelineno-9-21"></a><span class="w">                </span><span class="nt">&quot;infraRsHIfPol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#restapi-__codelineno-9-22"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#restapi-__codelineno-9-23"></a><span class="w">                        </span><span class="nt">&quot;tnFabricHIfPolName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LINK-10G&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#restapi-__codelineno-9-24"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created,modified&quot;</span><span class="w"></span>
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#restapi-__codelineno-9-25"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#restapi-__codelineno-9-26"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#restapi-__codelineno-9-27"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#restapi-__codelineno-9-28"></a><span class="w">            </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#restapi-__codelineno-9-29"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#restapi-__codelineno-9-30"></a><span class="w">                </span><span class="nt">&quot;infraRsLldpIfPol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#restapi-__codelineno-9-31"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#restapi-__codelineno-9-32"></a><span class="w">                        </span><span class="nt">&quot;tnLldpIfPolName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LLDP_ON&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#restapi-__codelineno-9-33"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created,modified&quot;</span><span class="w"></span>
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#restapi-__codelineno-9-34"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#restapi-__codelineno-9-35"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#restapi-__codelineno-9-36"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#restapi-__codelineno-9-37"></a><span class="w">            </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#restapi-__codelineno-9-38"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#restapi-__codelineno-9-39"></a><span class="w">                </span><span class="nt">&quot;infraRsLacpPol&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#restapi-__codelineno-9-40"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#restapi-__codelineno-9-41"></a><span class="w">                        </span><span class="nt">&quot;tnLacpLagPolName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;LACP_ACTIVE&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-9-42" name="__codelineno-9-42" href="#restapi-__codelineno-9-42"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created,modified&quot;</span><span class="w"></span>
<a id="__codelineno-9-43" name="__codelineno-9-43" href="#restapi-__codelineno-9-43"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-9-44" name="__codelineno-9-44" href="#restapi-__codelineno-9-44"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-9-45" name="__codelineno-9-45" href="#restapi-__codelineno-9-45"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-46" name="__codelineno-9-46" href="#restapi-__codelineno-9-46"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-47" name="__codelineno-9-47" href="#restapi-__codelineno-9-47"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-9-48" name="__codelineno-9-48" href="#restapi-__codelineno-9-48"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-9-49" name="__codelineno-9-49" href="#restapi-__codelineno-9-49"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Replace <strong>intpolgrp-vpc-server1</strong> with <strong>intpolgrp-vpc-server2</strong> to observe how simple you can add new VPC policy group using Postman.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Download three files to your dcloud workstation and using <strong>post</strong> in Postman or in APIC GUI upload it to access-polices. Without them, your VPC won't instanciate and cannot be used in later stage of the lab.</p>
<p><mark><strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/vpc-policy.json" target="_blank">JSON VPC Policy</a>.</strong></mark></p>
<p><mark><strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/interface-leafprofile.json" target="_blank">JSON interface leaf profile</a>.</strong></mark></p>
<p><mark><strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/switch-leafprofile.json" target="_blank">JSON switch leaf profile</a>.</strong></mark></p>
<p>Ask instructor for assistance if not clear.</p>
</div>
<h2 id="restapi-3-aci-tenant">3  ACI Tenant</h2>
<p>Upon now you created ACI AccessPolicies for your Tenant. Having JSON code for every object you will be able to unified variables across Postman Collection and then run all together using Variables from <em>Environment</em> or much better from CSV file.</p>
<p>Now is time to create your tenant using JSON. It will be simple Tenant definition with one VRF and two bridge domains associated with two EPGs. Every EPG will be associated with created domain and statically binded to both VPC created, with VLAN from VLAN pool done by you perviously.</p>
<p>Figure below shows our Logical Tenant.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/dcloud-tenant-1.PNG" width = 800></p>
<p>You need to define Tenant, VRF, Bridge-Domains, Application-Profile, EPGs with Domain association and static binding under EPG. Quite many of Requests to do in Postman. You can define all of them under one Request.
Please, download a JSON file from <mark><strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/tn-dcloud-tenant-1.json" target="_blank">JSON Tenant Ready</a>.</strong></mark></p>
<p>Once you have it on dcloud workstation, please create new Request under ACI Collection:
NAME:</p>
<div class="highlight"><pre><span></span><code>    CREATE TENANT-1
</code></pre></div>
<p>Method: POST</p>
<p>URL:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni.json
</code></pre></div>
<p>COPY now content from downloaded file to Body of the new request, Save and Send it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please check your authentication token if still valid.</p>
</div>
<p>Tenant-1 will be created with all structure shown in figure above.</p>
<h3 id="restapi-31-tenant-components">3.1 Tenant components</h3>
<p>This section contain JSON codes necessary to create Tenant objects.</p>
<h4 id="restapi-311-tenant-and-vrf">3.1.1 Tenant and VRF</h4>
<p>Code below can be used to create new Tenant and VRF.</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni.json
</code></pre></div>
<div class="highlight"><span class="filename">Tenant and VRF from CSV</span><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#restapi-__codelineno-10-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#restapi-__codelineno-10-2"></a><span class="w">    </span><span class="nt">&quot;fvTenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#restapi-__codelineno-10-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#restapi-__codelineno-10-4"></a><span class="w">            </span><span class="nt">&quot;annotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#restapi-__codelineno-10-5"></a><span class="w">            </span><span class="nt">&quot;descr&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#restapi-__codelineno-10-6"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-{{tenantname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#restapi-__codelineno-10-7"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{tenantname}}&quot;</span><span class="w"></span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#restapi-__codelineno-10-8"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#restapi-__codelineno-10-9"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#restapi-__codelineno-10-10"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#restapi-__codelineno-10-11"></a><span class="w">                </span><span class="nt">&quot;fvCtx&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#restapi-__codelineno-10-12"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#restapi-__codelineno-10-13"></a><span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{vrfname}}&quot;</span><span class="w"></span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#restapi-__codelineno-10-14"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#restapi-__codelineno-10-15"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#restapi-__codelineno-10-16"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#restapi-__codelineno-10-17"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#restapi-__codelineno-10-18"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#restapi-__codelineno-10-19"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#restapi-__codelineno-10-20"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h4 id="restapi-312-bd-in-existing-tenant">3.1.2 BD in existing tenant</h4>
<p>Code below can be used to create new Bridge-Domain in existing Tenant.</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni.json
</code></pre></div>
<div class="highlight"><span class="filename">Bridge-domain L3 from CSV</span><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#restapi-__codelineno-11-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#restapi-__codelineno-11-2"></a><span class="w">    </span><span class="nt">&quot;fvBD&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#restapi-__codelineno-11-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#restapi-__codelineno-11-4"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{bdname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#restapi-__codelineno-11-5"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-{{tenantname}}/BD-{{bdname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#restapi-__codelineno-11-6"></a><span class="w">            </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BD-{{bdname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#restapi-__codelineno-11-7"></a><span class="w">            </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;regular&quot;</span><span class="w"></span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#restapi-__codelineno-11-8"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#restapi-__codelineno-11-9"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#restapi-__codelineno-11-10"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#restapi-__codelineno-11-11"></a><span class="w">                </span><span class="nt">&quot;fvSubnet&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#restapi-__codelineno-11-12"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#restapi-__codelineno-11-13"></a><span class="w">                        </span><span class="nt">&quot;ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ipaddress}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#restapi-__codelineno-11-14"></a><span class="w">                        </span><span class="nt">&quot;ipDPLearning&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#restapi-__codelineno-11-15"></a><span class="w">                        </span><span class="nt">&quot;scope&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;private&quot;</span><span class="w"></span>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#restapi-__codelineno-11-16"></a><span class="w">                    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#restapi-__codelineno-11-17"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#restapi-__codelineno-11-18"></a><span class="w">            </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#restapi-__codelineno-11-19"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#restapi-__codelineno-11-20"></a><span class="w">                </span><span class="nt">&quot;fvRsCtx&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#restapi-__codelineno-11-21"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#restapi-__codelineno-11-22"></a><span class="w">                        </span><span class="nt">&quot;tnFvCtxName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{vrfname}}&quot;</span><span class="w"></span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#restapi-__codelineno-11-23"></a><span class="w">                    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#restapi-__codelineno-11-24"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#restapi-__codelineno-11-25"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#restapi-__codelineno-11-26"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#restapi-__codelineno-11-27"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#restapi-__codelineno-11-28"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>In case you need to add BD without IP address and unicast routing disabled, use code below.</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni.json
</code></pre></div>
<p><div class="highlight"><span class="filename">Bridge-domain L2 from CSV</span><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#restapi-__codelineno-12-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#restapi-__codelineno-12-2"></a><span class="w">    </span><span class="nt">&quot;fvTenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#restapi-__codelineno-12-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#restapi-__codelineno-12-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-{{tenantname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#restapi-__codelineno-12-5"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;modified&quot;</span><span class="w"></span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#restapi-__codelineno-12-6"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#restapi-__codelineno-12-7"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#restapi-__codelineno-12-8"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#restapi-__codelineno-12-9"></a><span class="w">                </span><span class="nt">&quot;fvBD&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#restapi-__codelineno-12-10"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#restapi-__codelineno-12-11"></a><span class="w">                        </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-{{tenantname}}/BD-{{bdname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#restapi-__codelineno-12-12"></a><span class="w">                        </span><span class="nt">&quot;mac&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;00:22:BD:F8:19:FF&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#restapi-__codelineno-12-13"></a><span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{bdname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#restapi-__codelineno-12-14"></a><span class="w">                        </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BD-{{bdname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#restapi-__codelineno-12-15"></a><span class="hll"><span class="w">                        </span><span class="nt">&quot;arpFlood&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;yes&quot;</span><span class="p">,</span><span class="w"></span>
</span><a id="__codelineno-12-16" name="__codelineno-12-16" href="#restapi-__codelineno-12-16"></a><span class="hll"><span class="w">                        </span><span class="nt">&quot;ipLearning&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="p">,</span><span class="w"></span>
</span><a id="__codelineno-12-17" name="__codelineno-12-17" href="#restapi-__codelineno-12-17"></a><span class="hll"><span class="w">                        </span><span class="nt">&quot;unicastRoute&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="p">,</span><span class="w"></span>
</span><a id="__codelineno-12-18" name="__codelineno-12-18" href="#restapi-__codelineno-12-18"></a><span class="hll"><span class="w">                        </span><span class="nt">&quot;unkMacUcastAct&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;flood&quot;</span><span class="p">,</span><span class="w"></span>
</span><a id="__codelineno-12-19" name="__codelineno-12-19" href="#restapi-__codelineno-12-19"></a><span class="w">                        </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;regular&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#restapi-__codelineno-12-20"></a><span class="w">                        </span><span class="nt">&quot;unkMcastAct&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;flood&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#restapi-__codelineno-12-21"></a><span class="w">                        </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#restapi-__codelineno-12-22"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#restapi-__codelineno-12-23"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#restapi-__codelineno-12-24"></a><span class="w">                        </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#restapi-__codelineno-12-25"></a><span class="w">                            </span><span class="nt">&quot;fvRsCtx&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#restapi-__codelineno-12-26"></a><span class="w">                                </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#restapi-__codelineno-12-27"></a><span class="w">                                    </span><span class="nt">&quot;tnFvCtxName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{vrfname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#restapi-__codelineno-12-28"></a><span class="w">                                    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created,modified&quot;</span><span class="w"></span>
<a id="__codelineno-12-29" name="__codelineno-12-29" href="#restapi-__codelineno-12-29"></a><span class="w">                                </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-12-30" name="__codelineno-12-30" href="#restapi-__codelineno-12-30"></a><span class="w">                                </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-12-31" name="__codelineno-12-31" href="#restapi-__codelineno-12-31"></a><span class="w">                            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-12-32" name="__codelineno-12-32" href="#restapi-__codelineno-12-32"></a><span class="w">                        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-12-33" name="__codelineno-12-33" href="#restapi-__codelineno-12-33"></a><span class="w">                    </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-12-34" name="__codelineno-12-34" href="#restapi-__codelineno-12-34"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-12-35" name="__codelineno-12-35" href="#restapi-__codelineno-12-35"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-12-36" name="__codelineno-12-36" href="#restapi-__codelineno-12-36"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-12-37" name="__codelineno-12-37" href="#restapi-__codelineno-12-37"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-12-38" name="__codelineno-12-38" href="#restapi-__codelineno-12-38"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<mark><strong>Highlighted</strong></mark> rows are specific for L2 Bridge-Domain.</p>
<h4 id="restapi-313-application-profile">3.1.3 Application Profile</h4>
<p>Component which contain all EPGs in the Tenant.</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni.json
</code></pre></div>
<div class="highlight"><span class="filename">Application Profile from CSV</span><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#restapi-__codelineno-13-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#restapi-__codelineno-13-2"></a><span class="w">    </span><span class="nt">&quot;fvAp&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#restapi-__codelineno-13-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#restapi-__codelineno-13-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-{{tenantname}}/ap-{{ap}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#restapi-__codelineno-13-5"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ap}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#restapi-__codelineno-13-6"></a><span class="w">            </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ap-{{ap}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#restapi-__codelineno-13-7"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#restapi-__codelineno-13-8"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#restapi-__codelineno-13-9"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#restapi-__codelineno-13-10"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h4 id="restapi-314-epgs-in-existing-tenantappprofiles-and-associated-with-domain">3.1.4 EPGs in existing tenant/appprofiles and associated with domain</h4>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni.json
</code></pre></div>
<div class="highlight"><span class="filename">Create EPG under existing application profile from CSV</span><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#restapi-__codelineno-14-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#restapi-__codelineno-14-2"></a><span class="w">  </span><span class="nt">&quot;fvAEPg&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#restapi-__codelineno-14-3"></a><span class="w">    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#restapi-__codelineno-14-4"></a><span class="w">      </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-{{tenantname}}/ap-{{ap}}/epg-{{epgname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#restapi-__codelineno-14-5"></a><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{epgname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#restapi-__codelineno-14-6"></a><span class="w">      </span><span class="nt">&quot;rn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;epg-{{epgname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#restapi-__codelineno-14-7"></a><span class="w">      </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#restapi-__codelineno-14-8"></a><span class="w">    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#restapi-__codelineno-14-9"></a><span class="w">    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#restapi-__codelineno-14-10"></a><span class="w">      </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#restapi-__codelineno-14-11"></a><span class="w">        </span><span class="nt">&quot;fvRsBd&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#restapi-__codelineno-14-12"></a><span class="w">          </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#restapi-__codelineno-14-13"></a><span class="w">            </span><span class="nt">&quot;tnFvBDname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{bdname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#restapi-__codelineno-14-14"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created,modified&quot;</span><span class="w"></span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#restapi-__codelineno-14-15"></a><span class="w">          </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#restapi-__codelineno-14-16"></a><span class="w">          </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#restapi-__codelineno-14-17"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#restapi-__codelineno-14-18"></a><span class="w">      </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#restapi-__codelineno-14-19"></a><span class="w">      </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#restapi-__codelineno-14-20"></a><span class="w">        </span><span class="nt">&quot;fvRsDomAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#restapi-__codelineno-14-21"></a><span class="w">          </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#restapi-__codelineno-14-22"></a><span class="w">            </span><span class="nt">&quot;tDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/phys-{{domain}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#restapi-__codelineno-14-23"></a><span class="w">            </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;created&quot;</span><span class="w"></span>
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#restapi-__codelineno-14-24"></a><span class="w">          </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#restapi-__codelineno-14-25"></a><span class="w">          </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#restapi-__codelineno-14-26"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#restapi-__codelineno-14-27"></a><span class="w">      </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#restapi-__codelineno-14-28"></a><span class="w">    </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#restapi-__codelineno-14-29"></a><span class="w">  </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#restapi-__codelineno-14-30"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h2 id="restapi-4-use-csv-file-for-input-data">4 Use CSV file for input data</h2>
<p>You are about to re-use work you did during all excercises. Untill now you run every request for static data, only once. Adding 100 Bridge-Domains, by changing "Variables" within the code would be problematic. Postman is giving an option to use external variable file to execute created requests in the collection.</p>
<p>By running five requests from your Collection and using CSV file from location <mark><strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/tenant-create.csv" target="_blank">FILE CSV TO DOWNLOAD</a></strong></mark> you will add new Tenant with one VRF, Applicatioin Profile, 22 Bridge-Domains and 22 EPGs associated to Physical Domain created before. All of this will be done in one Postman collection Run.</p>
<h2 id="restapi-41-run-collection-requests">4.1 Run Collection requests</h2>
<p>Follow the instruction from the figure below:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-run-1.png" width = 800></p>
<p>1)  Click on dots icon at your ACI dCloud collection folder</p>
<p>2)  Select <strong>Run Collection</strong></p>
<p>You will be moved to new dashboard, where you will select Requests and input file.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-run-2.png" width = 800></p>
<p>Deselect All, and then Select only needed requests:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-run-3.png" width = 800></p>
<p>When you select Requests, go to Data <strong>"Select File"</strong> and choice downloaded CSV file - <em>tenant-create.csv</em>.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-run-4.png" width = 800></p>
<p>Confirm that your file is selected as on the figure above. You can confirm amount of iterations in the top field <em>Iterations</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not forget to authenticate your Postman session using ACI Login request. I recommend to do it out of collection Run -- beforehand.</p>
</div>
<p>Click <strong> Run ACI dCloud </strong> Blue button.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-run-5.png" width = 800></p>
<h2 id="restapi-42-verification-after-runing-the-collection">4.2 Verification after runing the collection</h2>
<p>When you successfully execute your collection, in Summary at the screen you will see results of every Iteration.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-run-6.png" width = 800></p>
<p>When Request was accepted by APIC, result will be <strong>200 OK</strong>. Every Iteration contain all five seleceted requests. You probably noticed that one of them is getting <strong>400 Bad Request</strong> - "Bridge Domain L3 from CSV". Reason for that, is missing children attribute <strong>fvSubnet</strong> for all L2 bridge-domain in our CSV file.</p>
<p>Now connect to APIC GUI and verify if tenant exists, check dashboard status.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/postman-coll-run-7.png" width = 800></p>
<p>You successfully Created New Tenant with 22 EPGs and 22 BDs.</p>
<p>Please, edit CSV file in notepad++ editor at your dCloud workstation, replace Tenantname with new and run your Postman Collection once again.</p>
<p><strong><p align=center>Do you understand now power of simple automation?</p></strong></p></section><section class="print-page" id="use-cases-postman"><h1 id="use-cases-postman-create-sample-use-cases-with-postman">Create sample use-cases with Postman</h1>
<p>When you think about automation, you should start with standardization. Definition of Use-Cases, Naming Convention, and AccessPolicies strategy is a minimum to start with. Once those three points are confirmed, you easily define your automation scripts. For use of our training we will work at three use-cases which very often appears in Customer's designs. </p>
<h3 id="use-cases-postman-prerequisites-tenant-common">Prerequisites - Tenant Common</h3>
<p>Configuration in <em>Common</em> Tenant is done once at initial config and then reused across EPGs. For that reason, your use-case should contain only Custom Tenant configuration. Configuration of <em>Common</em> Tenant can be deployed using already done Postman Requests. Prerequisite, you need to deploy, two VRFs, two Bridge-Domains and EPG_Shared.</p>
<p>Use prepared CSV file for you - <a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/tenant-common.csv" target="_blank">download from here</a>.</p>
<p>Run same collection which in previous excercise:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/tenant-common-coll-1.png" width = 800></p>
<p>Run ACI dCloud - results should be <strong>200 OK </strong>.</p>
<h2 id="use-cases-postman-use-case-no1">Use-Case no.1</h2>
<p>Customer place network components in ACI shared tenant <em>common</em>. Custom tenants contain only EPGs, Domain associations and static-bindings for particular department.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/use-case-1.png" width = 800></p>
<p>Below you can find code for Tenant Custom in use case 1.</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/node/mo/uni.json
</code></pre></div>
<p><div class="highlight"><span class="filename">Tenant Custom Use-Case 1</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#use-cases-postman-__codelineno-0-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#use-cases-postman-__codelineno-0-2"></a><span class="w">    </span><span class="nt">&quot;fvTenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#use-cases-postman-__codelineno-0-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#use-cases-postman-__codelineno-0-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-{{tenantname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#use-cases-postman-__codelineno-0-5"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{tenantname}}&quot;</span><span class="w"></span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#use-cases-postman-__codelineno-0-6"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#use-cases-postman-__codelineno-0-7"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#use-cases-postman-__codelineno-0-8"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#use-cases-postman-__codelineno-0-9"></a><span class="w">                </span><span class="nt">&quot;fvAp&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#use-cases-postman-__codelineno-0-10"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#use-cases-postman-__codelineno-0-11"></a><span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ap}}&quot;</span><span class="w"></span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#use-cases-postman-__codelineno-0-12"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#use-cases-postman-__codelineno-0-13"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#use-cases-postman-__codelineno-0-14"></a><span class="w">                        </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#use-cases-postman-__codelineno-0-15"></a><span class="w">                            </span><span class="nt">&quot;fvAEPg&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#use-cases-postman-__codelineno-0-16"></a><span class="w">                                </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#use-cases-postman-__codelineno-0-17"></a><span class="w">                                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{epgname}}&quot;</span><span class="w"></span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#use-cases-postman-__codelineno-0-18"></a><span class="w">                                </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#use-cases-postman-__codelineno-0-19"></a><span class="w">                                </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#use-cases-postman-__codelineno-0-20"></a><span class="w">                                    </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#use-cases-postman-__codelineno-0-21"></a><span class="w">                                        </span><span class="nt">&quot;fvRsDomAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#use-cases-postman-__codelineno-0-22"></a><span class="w">                                            </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#use-cases-postman-__codelineno-0-23"></a><span class="w">                                                </span><span class="nt">&quot;tDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/phys-{{domain}}&quot;</span><span class="w"></span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#use-cases-postman-__codelineno-0-24"></a><span class="w">                                            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#use-cases-postman-__codelineno-0-25"></a><span class="w">                                        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#use-cases-postman-__codelineno-0-26"></a><span class="w">                                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#use-cases-postman-__codelineno-0-27"></a><span class="w">                                    </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#use-cases-postman-__codelineno-0-28"></a><span class="w">                                        </span><span class="nt">&quot;fvRsBd&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#use-cases-postman-__codelineno-0-29"></a><span class="w">                                            </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#use-cases-postman-__codelineno-0-30"></a><span class="w">                                                </span><span class="nt">&quot;annotation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#use-cases-postman-__codelineno-0-31"></a><span class="w">                                                </span><span class="nt">&quot;tnFvBDName&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{bdname}}&quot;</span><span class="w"></span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#use-cases-postman-__codelineno-0-32"></a><span class="w">                                            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#use-cases-postman-__codelineno-0-33"></a><span class="w">                                        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#use-cases-postman-__codelineno-0-34"></a><span class="w">                                    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#use-cases-postman-__codelineno-0-35"></a><span class="w">                                </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#use-cases-postman-__codelineno-0-36"></a><span class="w">                            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#use-cases-postman-__codelineno-0-37"></a><span class="w">                        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#use-cases-postman-__codelineno-0-38"></a><span class="w">                    </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#use-cases-postman-__codelineno-0-39"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#use-cases-postman-__codelineno-0-40"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#use-cases-postman-__codelineno-0-41"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#use-cases-postman-__codelineno-0-42"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#use-cases-postman-__codelineno-0-43"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
Run the code with new CSV file which you will use for custom-tenant definition, together with static biding associated to EPGs <strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/var-data-uc1.csv" target="_blank">download from here</a>.</strong></p>
<div class="highlight"><span class="filename">Tenant Custom Use-Case 1 static biding</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#use-cases-postman-__codelineno-1-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#use-cases-postman-__codelineno-1-2"></a><span class="w">    </span><span class="nt">&quot;fvTenant&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#use-cases-postman-__codelineno-1-3"></a><span class="w">        </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#use-cases-postman-__codelineno-1-4"></a><span class="w">            </span><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-{{tenantname}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#use-cases-postman-__codelineno-1-5"></a><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{tenantname}}&quot;</span><span class="w"></span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#use-cases-postman-__codelineno-1-6"></a><span class="w">        </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#use-cases-postman-__codelineno-1-7"></a><span class="w">        </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#use-cases-postman-__codelineno-1-8"></a><span class="w">            </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#use-cases-postman-__codelineno-1-9"></a><span class="w">                </span><span class="nt">&quot;fvAp&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#use-cases-postman-__codelineno-1-10"></a><span class="w">                    </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#use-cases-postman-__codelineno-1-11"></a><span class="w">                        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ap}}&quot;</span><span class="w"></span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#use-cases-postman-__codelineno-1-12"></a><span class="w">                    </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#use-cases-postman-__codelineno-1-13"></a><span class="w">                    </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#use-cases-postman-__codelineno-1-14"></a><span class="w">                        </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#use-cases-postman-__codelineno-1-15"></a><span class="w">                            </span><span class="nt">&quot;fvAEPg&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#use-cases-postman-__codelineno-1-16"></a><span class="w">                                </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#use-cases-postman-__codelineno-1-17"></a><span class="w">                                    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{epgname}}&quot;</span><span class="w"></span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#use-cases-postman-__codelineno-1-18"></a><span class="w">                                </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#use-cases-postman-__codelineno-1-19"></a><span class="w">                                </span><span class="nt">&quot;children&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#use-cases-postman-__codelineno-1-20"></a><span class="w">                                    </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#use-cases-postman-__codelineno-1-21"></a><span class="w">                                        </span><span class="nt">&quot;fvRsPathAtt&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#use-cases-postman-__codelineno-1-22"></a><span class="w">                                            </span><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#use-cases-postman-__codelineno-1-23"></a><span class="w">                                                </span><span class="nt">&quot;encap&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;vlan-{{vlan}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#use-cases-postman-__codelineno-1-24"></a><span class="w">                                                </span><span class="nt">&quot;instrImedcy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;lazy&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#use-cases-postman-__codelineno-1-25"></a><span class="w">                                                </span><span class="nt">&quot;mode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{mode}}&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#use-cases-postman-__codelineno-1-26"></a><span class="w">                                                </span><span class="nt">&quot;primaryEncap&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#use-cases-postman-__codelineno-1-27"></a><span class="w">                                                </span><span class="nt">&quot;tDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;topology/pod-{{pod}}/paths-{{leaf}}/pathep-[eth{{interface}}]&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#use-cases-postman-__codelineno-1-28"></a><span class="w">                                                </span><span class="nt">&quot;userdom&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;:all:&quot;</span><span class="w"></span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#use-cases-postman-__codelineno-1-29"></a><span class="w">                                            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#use-cases-postman-__codelineno-1-30"></a><span class="w">                                        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#use-cases-postman-__codelineno-1-31"></a><span class="w">                                    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#use-cases-postman-__codelineno-1-32"></a><span class="w">                                </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#use-cases-postman-__codelineno-1-33"></a><span class="w">                            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#use-cases-postman-__codelineno-1-34"></a><span class="w">                        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#use-cases-postman-__codelineno-1-35"></a><span class="w">                    </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#use-cases-postman-__codelineno-1-36"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#use-cases-postman-__codelineno-1-37"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#use-cases-postman-__codelineno-1-38"></a><span class="w">        </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#use-cases-postman-__codelineno-1-39"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#use-cases-postman-__codelineno-1-40"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Assumption that Access-Policies, meaning VLAN pool and Domain Association is done beforehand. Otherwise use other Postman Requests to create proper vlan mapping</p>
</div>
<h2 id="use-cases-postman-use-case-no2">Use-Case no.2</h2>
<p>Customer place network components in ACI shared tenant <em>common</em> as well as Custom Tenant. Moreover custom tenants contain EPGs, Domain associations and static-bindings for particular department.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/use-case-2.png" width = 800></p>
<p>How would you start preparation of such JSON Use-case definition?</p>
<p>Try to build the JSON code yourself, prepare CSV file for input data. You can reuse existing JSON files you did so far.</p>
<p>How to start the process:</p>
<ol>
<li>Identify components you want to include in your use-case</li>
<li>Understand dependencies to not forget some objects (cross-tenant object model or security-policy, etc)</li>
<li>Define where and how to connect external components (servers, routers, etc)</li>
</ol>
<p>Reuse done so far API calls, which from them suite most?</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If it's difficult or you would like to compare it, Solution for the Use-Case2 can be found under the link </p>
<p>-- <a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/use-case-2-tenant-epg.json" target="_blank">DoWnLoAd JSON</a></p>
<p>-- <a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/var-data-uc2.csv" target="_blank">DoWnLoAd CSV</a></p>
</div>
<h2 id="use-cases-postman-use-case-no3">Use-Case no.3</h2>
<p>Customer place SHARED network component in ACI shared tenant <em>common</em>. Custom tenants contain dedicated VRF, BDs and EPGs, Domain associations and static-bindings for particular department. L3out configuration for routing with external networks.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/use-case-3.png" width = 800></p>
<p>Based on experience  gained, build yourself another use-case in JSON.</p>
<p>New thing in the Use-case, comparing to previous is L3out located in Custom Tenant. Please use API Inspector or Save manually created L3out object to understand MIT of it.</p></section><section class="print-page" id="monitor-aci"><h1 id="monitor-aci-how-to-pull-informations-using-rest-api">How to pull informations using REST API</h1>
<p>The REST API is the interface into the management information tree (MIT) and allows manipulation of the object model state. The same REST interface is used by the APIC CLI, GUI, and SDK, so that whenever information is displayed, it is read through the REST API, and when configuration changes are made, they are written through the REST API. The REST API also provides an interface through which other information can be retrieved, including statistics, faults, and audit events. It even provides a means of subscribing to push-based event notification, so that when a change occurs in the MIT, an event can be sent through a web socket.</p>
<p>Standard REST methods are supported on the API, which includes POST, GET, and DELETE operations through HTTP. The GET method is nullipotent, meaning that it can be called zero or more times without making any changes (or that it is a read-only operation).</p>
<h2 id="monitor-aci-1-creating-the-api-command">1. Creating the API Command</h2>
<p>You can invoke an API command or query by sending an HTTP or HTTPS message to the APIC with a URI of this form for an operation on a managed object (MO):</p>
<p>{http | https}://host [:port] /api/mo/dn. {json | xml} [?options]</p>
<p>Use this form for an operation on an object class:</p>
<p>{http | https}://host [:port] /api/class/className. {json | xml} [?options]</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While the preceding examples use <strong>/api/mo</strong> and <strong>/api/class</strong> in the URI string, the APIC UI and Visore also use the <strong>/api/node/mo</strong> and <strong>/api/node/class</strong> syntax in the URI string. Both formats are valid and are used interchangeably in this document.</p>
</div>
<p>This example shows a URI for an API operation that involves an MO of class fv:Tenant:</p>
<p>https://apic-ip-address/api/mo/uni/tn-ExampleCorp.xml</p>
<h3 id="monitor-aci-11-the-uri-for-an-api-operation-on-an-mo">1.1 The URI for an API Operation on an MO</h3>
<p>https://apic-ip-address/api/mo/uni/tn-ExampleCorp.xml</p>
<h3 id="monitor-aci-12-the-uri-for-an-api-operation-on-an-node-mo">1.2 The URI for an API Operation on an Node MO</h3>
<p>In an API operation to access an MO on a specific node device in the fabric, the resource path consists of <mark><strong>/mo/topology/pod-number/node-number/sys/</strong></mark> followed by the node component. For example, to access a board sensor in chassis slot b of node-1 in pod-1, use this URI:</p>
<p>GET https://apic-ip-address/api/mo/topology/pod-1/node-1/sys/ch/bslot/board/sensor-3.json</p>
<h3 id="monitor-aci-13-the-uri-for-an-api-operation-on-a-class">1.3. The URI for an API Operation on a Class</h3>
<p>In an API operation to get information about a class, the resource path consists of <strong>/class/</strong> followed by the name of the class as described in the Cisco APIC Management Information Model Reference. In the URI, the colon in the class name is removed. For example, this URI specifies a query on the class aaa:User:</p>
<p>GET https://apic-ip-address/api/class/aaaUser.json</p>
<h2 id="monitor-aci-2-pulling-data-from-created-tenant">2. Pulling data from created Tenant</h2>
<p>In the restAPI section you created tenant called <strong>"Postman-collection-1"</strong>. That tenant have 22 EPGs and BDs and now you would like to pull data about one of them.</p>
<p><strong>POTENTIAL EXCERCISE:</strong></p>
<p>Server Team asked you to add new static binding for server addressed in subnet 172.16.59.0/24. You don't know what is name of EPG and now you have to do reverse engineering to find correct EPG.</p>
<p>You know that GW IP address of BD is 172.16.59.1/24. Your task is to find BD name using GET API query and by having BD, find name of EPG associated to it.</p>
<p><em>Where to start?</em></p>
<p>Think about how to find class-name of Bridge Domain. During the day you used few methods - "Save As" object, "Show Debug Info" in APIC, "API Inspector", "Open in Object Store Browser".
Choice method you prefer and find class-name for BD.</p>
<p>Once you have it, compose URL, Answer below:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/class/fvBD.json
</code></pre></div>
<p>Create Postman Request to GET information from class-name you specify above.</p>
<p>Result should shows you "totalCount": "28" meaning you found 28 bridge domains and you listed their attributes. Still you are not able to find out the correct one.</p>
<p>Now list all sub-tree of object fvBD. Do it with adding KEY parameter to your GET query:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/class/fvBD.json?query-target=subtree
</code></pre></div>
<p>You listed all Bridge Domains with all MIT for them, now results with more than 200 items in APIC response.</p>
<p>Having information about IP address of GW, you can narrow it to one, having that specific IP. Let's try:</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/class/fvBD.json?query-target=subtree&amp;query-target-filter=and(wcard(fvSubnet.ip,&quot;172.16.59.1/24&quot;))
</code></pre></div>
<p>Function which contain IP addresses under BD is fvSubnet. The attribute of the function is <mark><strong>ip</strong></mark>. By using filter <strong>query-target-filter=and(wcard(fvSubnet.ip,"172.16.59.1/24"))</strong> you get information about DN of function. The DN contains Bridge-Domain name.</p>
<p>Results on the figure below:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/get-bd-ipaddress.png" width = 800></p>
<p>Please list informations about Bridge Domain you found: <strong>BD-59</strong>.</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/class/fvBD.json?query-target=subtree&amp;query-target-filter=and(eq(fvBD.name,&quot;BD-59&quot;))
</code></pre></div>
<p>Still you don't have EPG name. Why you don't see sub-tree of the fvBD in your GET response??</p>
<p>You need to specify RSP-SUBTREE in your GET. </p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/class/fvBD.json?query-target=subtree&amp;rsp-subtree=full&amp;query-target-filter=and(eq(fvBD.name,&quot;BD-59&quot;))
</code></pre></div>
<p>In the output you should look for <strong>fvRtBd</strong> class-name. It contains information about EPG to BD relation. Now try yourself to narrow down the output.</p>
<div class="highlight"><pre><span></span><code>    https://{{apic}}/api/class/fvRtBd.json?query-target=subtree&amp;query-target-filter=and(wcard(fvRtBd.dn,&quot;BD-59&quot;))
</code></pre></div>
<p>Using URL above you are able to filter response from APIC for class-name fvRtBd and DN path which contain BD-59 in.</p>
<div class="highlight"><span class="filename">fvRtBd.dn</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#monitor-aci-__codelineno-0-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#monitor-aci-__codelineno-0-2"></a><span class="nt">&quot;fvRtBd&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#monitor-aci-__codelineno-0-3"></a><span class="nt">&quot;attributes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#monitor-aci-__codelineno-0-4"></a><span class="nt">&quot;childAction&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#monitor-aci-__codelineno-0-5"></a><span class="hll"><span class="nt">&quot;dn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-Postman-collection-1/BD-BD-59/rtbd-[uni/tn-Postman-collection-1/ap-APPLICATION-PROFILE-1/epg-EPG-59]&quot;</span><span class="p">,</span><span class="w"></span>
</span><a id="__codelineno-0-6" name="__codelineno-0-6" href="#monitor-aci-__codelineno-0-6"></a><span class="nt">&quot;lcOwn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;local&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#monitor-aci-__codelineno-0-7"></a><span class="nt">&quot;modTs&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2022-11-04T18:22:39.217+00:00&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#monitor-aci-__codelineno-0-8"></a><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#monitor-aci-__codelineno-0-9"></a><span class="nt">&quot;tCl&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;fvAEPg&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#monitor-aci-__codelineno-0-10"></a><span class="nt">&quot;tDn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uni/tn-Postman-collection-1/ap-APPLICATION-PROFILE-1/epg-EPG-59&quot;</span><span class="w"></span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#monitor-aci-__codelineno-0-11"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#monitor-aci-__codelineno-0-12"></a><span class="p">}</span><span class="w"></span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#monitor-aci-__codelineno-0-13"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="monitor-aci-congratulations-you-found-correct-epg-epg-59"><p style="text-align: center;"> <ins>CONGRATULATIONS</ins>, you found correct EPG:  <strong>EPG-59</strong> </p></h3>
<h2 id="monitor-aci-please-see-the-collection-of-rest-api-urls-for-further-details"><p style="text-align: center;"> Please see the <mark><a href="#url-restapi">Collection of REST API URLs</a></mark> for further details. </p></h2></section><h1 class='nav-section-title-end'>Ended: First LAB sections</h1>
                        <h1 class='nav-section-title' id='section-second-lab-sections'>
                            Second LAB sections <a class='headerlink' href='#section-second-lab-sections' title='Permanent link'>↵</a>
                        </h1>
                        <section class="print-page" id="terraform-installation"><h1 id="terraform-installation-terraform-setup">Terraform setup</h1>
<p>HashiCorp Terraform is an infrastructure as code tool that lets you define both cloud and on-prem resources in human-readable configuration files that you can version, reuse, and share. You can then use a consistent workflow to provision and manage all of your infrastructure throughout its lifecycle. Terraform can manage low-level components like compute, storage, and networking resources, as well as high-level components like DNS entries and SaaS features.</p>
<h2 id="terraform-installation-1-install-teraform-in-your-workstation">1. Install Teraform in your workstation</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Participants can use virtual machine with Windows or work on personal laptop. Please follow installation instructions for the OS on your laptops.</p>
</div>
<p>To use Terraform you will need to install it. HashiCorp distributes Terraform as a binary package. You can also install Terraform using popular package managers.</p>
<h3 id="terraform-installation-11-for-centosrhel-distribution">1.1 For CentOS/RHEL distribution:</h3>
<p>Install <code>yum-config-manager</code> to manage your repositories.</p>
<div class="highlight"><pre><span></span><code>sudo yum install -y yum-utils
</code></pre></div>
<p>Use <code>yum-config-manager</code> to add the official HashiCorp Linux repository.</p>
<div class="highlight"><pre><span></span><code>sudo yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo
</code></pre></div>
<p>Install Terraform from the new repository.</p>
<div class="highlight"><pre><span></span><code>sudo yum -y install terraform
</code></pre></div>
<h3 id="terraform-installation-12-for-windows-os">1.2. For Windows OS:</h3>
<p>To install Terraform, find the appropriate package for your system and download it as a zip archive:</p>
<div class="highlight"><pre><span></span><code>https://releases.hashicorp.com/terraform/1.3.3/terraform_1.3.3_windows_amd64.zip
</code></pre></div>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/terraform-download.png" width = 800></p>
<p>After downloading Terraform, unzip the package. Terraform runs as a single binary named terraform. Any other files in the package can be safely removed and Terraform will still function.</p>
<p>Copy the terraform.bin to C:\Windows folder.</p>
<p>Finally, make sure that the terraform binary is available on your PATH. The path can be edited through:
1) Find <code>Advanced system settings</code> -&gt; <code>Advanced</code> -&gt; <code>Environment Variables</code>
2) Find PATH variable and click edit to change
3) Verify if C:\Windows exists in the path and if not add it to the list</p>
<h3 id="terraform-installation-13-for-macbook-with-os-x">1.3 For Macbook with OS X:</h3>
<p>Homebrew is a free and open-source package management system for Mac OS X. Install the official Terraform formula from the terminal.
First, install the HashiCorp tap, a repository of all our Homebrew packages.</p>
<div class="highlight"><pre><span></span><code>brew tap hashicorp/tap
</code></pre></div>
<p>Now, install Terraform with hashicorp/tap/terraform.</p>
<div class="highlight"><pre><span></span><code>brew install hashicorp/tap/terraform
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This installs a signed binary and is automatically updated with every new official release.</p>
</div>
<p>To update to the latest version of Terraform, first update Homebrew.</p>
<div class="highlight"><pre><span></span><code>brew update
</code></pre></div>
<p>Then, run the upgrade command to download and use the latest Terraform version.
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#terraform-installation-__codelineno-0-1"></a>  brew upgrade hashicorp/tap/terraform
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#terraform-installation-__codelineno-0-2"></a>  ==&gt; Upgrading 1 outdated package:
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#terraform-installation-__codelineno-0-3"></a>  hashicorp/tap/terraform 0.15.3 -&gt; 1.0.0
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#terraform-installation-__codelineno-0-4"></a>  ==&gt; Upgrading hashicorp/tap/terraform 0.15.3 -&gt; 1.0.0
</code></pre></div></p>
<h3 id="terraform-installation-13-verify-the-installation">1.3 Verify the installation</h3>
<p>Verify that the installation worked by opening a new terminal session and listing Terraform's available subcommands.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#terraform-installation-__codelineno-1-1"></a>terraform -help
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#terraform-installation-__codelineno-1-2"></a>Usage: terraform [-version] [-help] &lt;command&gt; [args]
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#terraform-installation-__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#terraform-installation-__codelineno-1-4"></a>The available commands for execution are listed below.
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#terraform-installation-__codelineno-1-5"></a>The most common, useful commands are shown first, followed by
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#terraform-installation-__codelineno-1-6"></a>less common or more advanced commands. If you&#39;re just getting
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#terraform-installation-__codelineno-1-7"></a>started with Terraform, stick with the common commands. For the
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#terraform-installation-__codelineno-1-8"></a>other commands, please read the help and docs before usage.
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#terraform-installation-__codelineno-1-9"></a>#...
</code></pre></div>
<p>Add any subcommand to terraform -help to learn more about what it does and available options.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#terraform-installation-__codelineno-2-1"></a> terraform -help plan
</code></pre></div></section><section class="print-page" id="terraform-basis"><h1 id="terraform-basis-basic-use-cases-with-terraform">Basic use-cases with Terraform</h1>
<p>In this lab the focus will be on using Terraform as a way to provide operational rigor to your network device configurations. You will learn how to install and use Terraform on Cisco network solutions like ACI.</p>
<h2 id="terraform-basis-1-install-visual-studio-code">1. Install Visual Studio Code</h2>
<p>Terraform uses structured files that require editing. To assist you in this process the best tool is some editor that understands the Terraform semantics. For this lab you will be using a web based integrated development environment that uses the code that is inside Microsofts Visual Studio Code. When Microsoft wrote Visual Studio Code it built the IDE on top of a platform called electron. This allowed for cross platform development and is based on javascript.</p>
<p>Visual Studio Code can be installed on variety of operating systems, please download the package suitable for your environment and follow the installation process in the wizard:</p>
<div class="highlight"><pre><span></span><code>https://code.visualstudio.com/
</code></pre></div>
<p>Visual Studio Code has three panes that you will be using:</p>
<ul>
<li>The left pane with the files</li>
<li>The right pane with the file contents</li>
<li>The bottom pane will be leveraging the Terminal to issue commands</li>
</ul>
<h3 id="terraform-basis-11-open-a-new-terminal-in-the-ide">1.1 Open a new terminal in the IDE</h3>
<p>To get started, first you have to open a terminal windows in the IDE to access the underlying operating system and work the lab. On the menu bar click the <em>Terminal</em> tab to open <em>New Terminal</em></p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/visual-terminal.png" width = 800></p>
<p>Terminal will open at the bottom of the screen. This will be the area that you will execute all the terraform commands after making changes to terraform files.</p>
<h2 id="terraform-basis-2-create-the-working-directory">2 Create the working directory</h2>
<p>Terraform uses directory structures as a way to organize its automation structure. This is due to the fact that Terraform treats everything in a directory as a unit and reads all the <code>.tf</code> files before execution.
The first step is to create a directory called <em>ACI</em> for the terraform files. Using the IDE you can create folders. This directory will live under the ACI folder. There are various ways to create these in visual studio code: using the contextual menu (1a and 1b) or using the icons (2):</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/visual-new-folder.png" width = 800>
<img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/visual-new-folder2.png" width = 800></p>
<p>In that directory create the first terraform file called <code>main.tf</code> using the icon:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/visual-new-file.png" width = 800></p>
<h2 id="terraform-basis-3-configure-aci-provider">3. Configure ACI Provider</h2>
<p>One of the first things we should do before writing configuration for ACI is to add the Terraform Provider for ACI. The definition will be placed in the <code>main.tf</code> file and we will use the username/password construct. It is also possible and recommended to use certificates based authentication, but for this lab we are using the simpler method.</p>
<p>ACI Provider documentation can be found on the official Terraform Registry website: https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs
In also includes instruction on how to use this provider. After clicking on "Use provider" small section with code will appear.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/terraform-aci-provider.png" width = 800></p>
<p>The code that we will use in this lab contains IP address of APIC in the lab and default admin user/password. It should be copied to the <code>main.tf</code> file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#terraform-basis-__codelineno-0-1"></a>terraform {
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#terraform-basis-__codelineno-0-2"></a>  required_providers {
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#terraform-basis-__codelineno-0-3"></a>    aci = {
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#terraform-basis-__codelineno-0-4"></a>      source = &quot;CiscoDevNet/aci&quot;
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#terraform-basis-__codelineno-0-5"></a>      version = &quot;2.5.2&quot;
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#terraform-basis-__codelineno-0-6"></a>    }
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#terraform-basis-__codelineno-0-7"></a>  }
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#terraform-basis-__codelineno-0-8"></a>}
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#terraform-basis-__codelineno-0-9"></a>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#terraform-basis-__codelineno-0-10"></a>provider &quot;aci&quot; {
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#terraform-basis-__codelineno-0-11"></a>  # Cisco ACI user name
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#terraform-basis-__codelineno-0-12"></a>  username    = &quot;admin&quot;
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#terraform-basis-__codelineno-0-13"></a>  password    = &quot;C1sco12345&quot;
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#terraform-basis-__codelineno-0-14"></a>  url         = &quot;https://198.18.133.200&quot;
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#terraform-basis-__codelineno-0-15"></a>  insecure    = true
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#terraform-basis-__codelineno-0-16"></a>}
</code></pre></div>
<h3 id="terraform-basis-31-run-terraform-init">3.1 Run Terraform Init</h3>
<p>Once the provider is configured and our APIC IP and credentials are present in the file, we can proceed with the first step of Terraform workflow and initialize the directory to include proper terraform provider modules needed for execution. In the terminal window on the bottom pane of Visual Studio make sure you are in the correct directory (your ACI folder) and then execute <code>terraform init</code>. The output should show that the provider plugin hsa been downlaoded:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#terraform-basis-__codelineno-1-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform init
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#terraform-basis-__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#terraform-basis-__codelineno-1-3"></a>Initializing the backend...
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#terraform-basis-__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#terraform-basis-__codelineno-1-5"></a>Initializing provider plugins...
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#terraform-basis-__codelineno-1-6"></a>- Finding ciscodevnet/aci versions matching &quot;2.5.2&quot;...
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#terraform-basis-__codelineno-1-7"></a>- Installing ciscodevnet/aci v2.5.2...
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#terraform-basis-__codelineno-1-8"></a>- Installed ciscodevnet/aci v2.5.2 (signed by a HashiCorp partner, key ID 433649E2C56309DE)
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#terraform-basis-__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#terraform-basis-__codelineno-1-10"></a>Partner and community providers are signed by their developers.
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#terraform-basis-__codelineno-1-11"></a>If you&#39;d like to know more about provider signing, you can read about it here:
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#terraform-basis-__codelineno-1-12"></a>https://www.terraform.io/docs/cli/plugins/signing.html
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#terraform-basis-__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#terraform-basis-__codelineno-1-14"></a>Terraform has created a lock file .terraform.lock.hcl to record the provider
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#terraform-basis-__codelineno-1-15"></a>selections it made above. Include this file in your version control repository
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#terraform-basis-__codelineno-1-16"></a>so that Terraform can guarantee to make the same selections by default when
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#terraform-basis-__codelineno-1-17"></a>you run &quot;terraform init&quot; in the future.
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#terraform-basis-__codelineno-1-18"></a>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#terraform-basis-__codelineno-1-19"></a>Terraform has been successfully initialized!
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#terraform-basis-__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#terraform-basis-__codelineno-1-21"></a>You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#terraform-basis-__codelineno-1-22"></a>any changes that are required for your infrastructure. All Terraform commands
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#terraform-basis-__codelineno-1-23"></a>should now work.
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#terraform-basis-__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#terraform-basis-__codelineno-1-25"></a>If you ever set or change modules or backend configuration for Terraform,
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#terraform-basis-__codelineno-1-26"></a>rerun this command to reinitialize your working directory. If you forget, other
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#terraform-basis-__codelineno-1-27"></a>commands will detect it and remind you to do so if necessary.
</code></pre></div>
<p>Next you can try running <code>terraform plan</code>, but since our <code>main.tf</code> file has no resource confguration, you will see that there is no change needed:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#terraform-basis-__codelineno-2-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform plan
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#terraform-basis-__codelineno-2-2"></a>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#terraform-basis-__codelineno-2-3"></a>No changes. Your infrastructure matches the configuration.
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#terraform-basis-__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#terraform-basis-__codelineno-2-5"></a>Terraform has compared your real infrastructure against your configuration and found no differences, so no changes are needed.
</code></pre></div>
<h3 id="terraform-basis-32-optional-switch-registration">3.2 (Optional) Switch registration</h3>
<p>At this point leaf and spine switches should be registered in the lab using Postman the day before.
Registration of switch is possible to be done using resource <em>aci_fabric_node_member</em>. Documentation of this resource is present in the official <a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/fabric_node_member" target="_blank">Terraform Registry documentation</a>.</p>
<ul>
<li>In the Example Usage section you can find example code to register new node</li>
<li>In the Argument Reference you will see possible arguments/parameters that can be used for switch registration with indication if argument is required or optional and additional information about it</li>
<li>In the Attribute Reference you will see what is the attribute that this resource exports, and in case of ACI resources it will be always <code>id</code> set to the DN of the VLAN Pool.</li>
<li>Importing describes how to import existing object to the terraform resource</li>
</ul>
<p>For reference the following resource configuration in Terraform would register new switch.
If the switches are already registered, this task can be skipped</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#terraform-basis-__codelineno-3-1"></a>resource &quot;aci_fabric_node_member&quot; &quot;Leaf-101&quot; {
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#terraform-basis-__codelineno-3-2"></a>  name        = &quot;Leaf-101&quot;
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#terraform-basis-__codelineno-3-3"></a>  serial      = &quot;TEP-1-101&quot;
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#terraform-basis-__codelineno-3-4"></a>  node_id     = &quot;101&quot;
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#terraform-basis-__codelineno-3-5"></a>  pod_id      = &quot;1&quot;
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#terraform-basis-__codelineno-3-6"></a>  role        = &quot;leaf&quot;
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#terraform-basis-__codelineno-3-7"></a>}
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#terraform-basis-__codelineno-3-8"></a>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#terraform-basis-__codelineno-3-9"></a>resource &quot;aci_fabric_node_member&quot; &quot;Leaf-102&quot; {
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#terraform-basis-__codelineno-3-10"></a>  name        = &quot;Leaf-102&quot;
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#terraform-basis-__codelineno-3-11"></a>  serial      = &quot;TEP-1-102&quot;
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#terraform-basis-__codelineno-3-12"></a>  node_id     = &quot;102&quot;
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#terraform-basis-__codelineno-3-13"></a>  pod_id      = &quot;1&quot;
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#terraform-basis-__codelineno-3-14"></a>  role        = &quot;leaf&quot;
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#terraform-basis-__codelineno-3-15"></a>}
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#terraform-basis-__codelineno-3-16"></a>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#terraform-basis-__codelineno-3-17"></a>resource &quot;aci_fabric_node_member&quot; &quot;Spine-103&quot; {
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#terraform-basis-__codelineno-3-18"></a>  name        = &quot;Spine-103&quot;
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#terraform-basis-__codelineno-3-19"></a>  serial      = &quot;TEP-1-103&quot;
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#terraform-basis-__codelineno-3-20"></a>  node_id     = &quot;103&quot;
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#terraform-basis-__codelineno-3-21"></a>  pod_id      = &quot;1&quot;
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#terraform-basis-__codelineno-3-22"></a>  role        = &quot;spine&quot;
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#terraform-basis-__codelineno-3-23"></a>}
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#terraform-basis-__codelineno-3-24"></a>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#terraform-basis-__codelineno-3-25"></a>resource &quot;aci_fabric_node_member&quot; &quot;Spine-104&quot; {
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#terraform-basis-__codelineno-3-26"></a>  name        = &quot;Spine-104&quot;
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#terraform-basis-__codelineno-3-27"></a>  serial      = &quot;TEP-1-104&quot;
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#terraform-basis-__codelineno-3-28"></a>  node_id     = &quot;104&quot;
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#terraform-basis-__codelineno-3-29"></a>  pod_id      = &quot;1&quot;
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#terraform-basis-__codelineno-3-30"></a>  role        = &quot;spine&quot;
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#terraform-basis-__codelineno-3-31"></a>}
</code></pre></div>
<h2 id="terraform-basis-4-aci-access-policies">4 ACI Access Policies</h2>
<p>Every ACI Fabric configuration starts with Access Polices. You need to define ACI objects which represent single physical port configurations. To remind relationships between objects, please check following figure.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/access-polices.png" width = 800></p>
<p>Usually Interface Polices are configured once and re-used like LLDP, LACP, CDP, etc.
In our LAB some of the policies already exist from the day before and Postman configuration, so different names should be used for Terraform lab to create new objects. Following sections will help you to prepare your API requests.</p>
<p>For reference full configuration of access-policies can be found here: <mark><strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/access-policies.tf" target="_blank">Terraform Tenant Ready</a>.</strong></mark></p>
<h3 id="terraform-basis-41-interface-policies">4.1 Interface Policies</h3>
<p>You will configure LACP Policy, LLDP and speed policies. Let's separate our terraform files and create separate config file for out interface policies. Under your folder in Visual Studio create new file calles <code>interface-policies.tf</code>:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/visual-new-file.png" width = 800></p>
<p>Copy each of the Policy resource definition to the new interface-policies.tf file</p>
<div class="highlight"><span class="filename">LACP_ACTIVE</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#terraform-basis-__codelineno-4-1"></a><span class="err">resource</span><span class="w"> </span><span class="s2">&quot;aci_lacp_policy&quot;</span><span class="w"> </span><span class="s2">&quot;LACP_ACTIVE&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#terraform-basis-__codelineno-4-2"></a><span class="w">  </span><span class="kc">na</span><span class="err">me</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;LACP_ACTIVE&quot;</span><span class="w"></span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#terraform-basis-__codelineno-4-3"></a><span class="w">  </span><span class="err">c</span><span class="kc">trl</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;susp-individual&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;fast-sel-hot-stdby&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;graceful-conv&quot;</span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#terraform-basis-__codelineno-4-4"></a><span class="w">  </span><span class="err">mode</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;active&quot;</span><span class="w"></span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#terraform-basis-__codelineno-4-5"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><span class="filename">LLDP_ON</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#terraform-basis-__codelineno-5-1"></a><span class="err">resource</span><span class="w"> </span><span class="s2">&quot;aci_lldp_interface_policy&quot;</span><span class="w"> </span><span class="s2">&quot;LLDP_ON&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#terraform-basis-__codelineno-5-2"></a><span class="w">  </span><span class="kc">na</span><span class="err">me</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;LLDP_ON&quot;</span><span class="w"></span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#terraform-basis-__codelineno-5-3"></a><span class="w">  </span><span class="err">admi</span><span class="kc">n</span><span class="err">_rx_s</span><span class="kc">t</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="w"></span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#terraform-basis-__codelineno-5-4"></a><span class="w">  </span><span class="err">admi</span><span class="kc">n</span><span class="err">_</span><span class="kc">t</span><span class="err">x_s</span><span class="kc">t</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;enabled&quot;</span><span class="w"></span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#terraform-basis-__codelineno-5-5"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><span class="filename">LINK-10G</span><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#terraform-basis-__codelineno-6-1"></a><span class="err">resource</span><span class="w"> </span><span class="s2">&quot;aci_fabric_if_pol&quot;</span><span class="w"> </span><span class="s2">&quot;LINK-10G&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#terraform-basis-__codelineno-6-2"></a><span class="w">  </span><span class="kc">na</span><span class="err">me</span><span class="w">        </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;LINK-10G&quot;</span><span class="w"></span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#terraform-basis-__codelineno-6-3"></a><span class="w">  </span><span class="err">au</span><span class="kc">t</span><span class="err">o_</span><span class="kc">ne</span><span class="err">g</span><span class="w">    </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;on&quot;</span><span class="w"></span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#terraform-basis-__codelineno-6-4"></a><span class="w">  </span><span class="err">speed</span><span class="w">       </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;10G&quot;</span><span class="w"></span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#terraform-basis-__codelineno-6-5"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The documentation for each of the resources can be found in Terraform Registry:</p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/lacp_policy" target="_blank">aci_lacp_policy resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/lldp_interface_policy" target="_blank">aci_lldp_interface_policy resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/fabric_if_pol" target="_blank">aci_fabric_if_pol resource</a></p>
<h3 id="terraform-basis-42-run-terraform-plan-apply">4.2 Run Terraform Plan &amp; Apply</h3>
<p>At this point we have our first three resources in the configuration so it's time to deploy them on our APIC. To do so we will follow the Terraform workload init -&gt; plan -&gt; apply. In previous step, after configuring ACI provider you should have already done <code>terraform init</code>, so it is <strong>not</strong> needed to run it again now, as it would not bring any change.</p>
<p>Our first step to deploy config is to run <code>terraform plan</code> command in the terminal window. The output will show us what changes Terraform needs to do on the fabric, to bring it to the required configuration. The output should look similar to the following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#terraform-basis-__codelineno-7-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform plan
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#terraform-basis-__codelineno-7-2"></a>aci_fabric_node_member.Leaf-102: Refreshing state... [id=uni/controller/nodeidentpol/nodep-TEP-1-102]
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#terraform-basis-__codelineno-7-3"></a>aci_fabric_node_member.Leaf-101: Refreshing state... [id=uni/controller/nodeidentpol/nodep-TEP-1-101]
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#terraform-basis-__codelineno-7-4"></a>aci_fabric_node_member.Spine-103: Refreshing state... [id=uni/controller/nodeidentpol/nodep-TEP-1-103]
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#terraform-basis-__codelineno-7-5"></a>aci_fabric_node_member.Spine-104: Refreshing state... [id=uni/controller/nodeidentpol/nodep-TEP-1-104]
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#terraform-basis-__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#terraform-basis-__codelineno-7-7"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#terraform-basis-__codelineno-7-8"></a>  + create
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#terraform-basis-__codelineno-7-9"></a>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#terraform-basis-__codelineno-7-10"></a>Terraform will perform the following actions:
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#terraform-basis-__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#terraform-basis-__codelineno-7-12"></a>  # aci_fabric_if_pol.auto-10G will be created
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#terraform-basis-__codelineno-7-13"></a>  + resource &quot;aci_fabric_if_pol&quot; &quot;auto-10G&quot; {
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#terraform-basis-__codelineno-7-14"></a>      + annotation    = &quot;orchestrator:terraform&quot;
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#terraform-basis-__codelineno-7-15"></a>      + auto_neg      = &quot;on&quot;
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#terraform-basis-__codelineno-7-16"></a>      + description   = (known after apply)
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#terraform-basis-__codelineno-7-17"></a>      + fec_mode      = (known after apply)
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#terraform-basis-__codelineno-7-18"></a>      + id            = (known after apply)
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#terraform-basis-__codelineno-7-19"></a>      + link_debounce = (known after apply)
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#terraform-basis-__codelineno-7-20"></a>      + name          = &quot;LINK-10G&quot;
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#terraform-basis-__codelineno-7-21"></a>      + name_alias    = (known after apply)
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#terraform-basis-__codelineno-7-22"></a>      + speed         = &quot;10G&quot;
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#terraform-basis-__codelineno-7-23"></a>    }
<a id="__codelineno-7-24" name="__codelineno-7-24" href="#terraform-basis-__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25" href="#terraform-basis-__codelineno-7-25"></a>  # aci_lldp_interface_policy.LLDP_ON will be created
<a id="__codelineno-7-26" name="__codelineno-7-26" href="#terraform-basis-__codelineno-7-26"></a>  + resource &quot;aci_lldp_interface_policy&quot; &quot;LLDP_ON&quot; {
<a id="__codelineno-7-27" name="__codelineno-7-27" href="#terraform-basis-__codelineno-7-27"></a>      + admin_rx_st = &quot;enabled&quot;
<a id="__codelineno-7-28" name="__codelineno-7-28" href="#terraform-basis-__codelineno-7-28"></a>      + admin_tx_st = &quot;enabled&quot;
<a id="__codelineno-7-29" name="__codelineno-7-29" href="#terraform-basis-__codelineno-7-29"></a>      + annotation  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-7-30" name="__codelineno-7-30" href="#terraform-basis-__codelineno-7-30"></a>      + description = (known after apply)
<a id="__codelineno-7-31" name="__codelineno-7-31" href="#terraform-basis-__codelineno-7-31"></a>      + id          = (known after apply)
<a id="__codelineno-7-32" name="__codelineno-7-32" href="#terraform-basis-__codelineno-7-32"></a>      + name        = &quot;LLDP_ON&quot;
<a id="__codelineno-7-33" name="__codelineno-7-33" href="#terraform-basis-__codelineno-7-33"></a>      + name_alias  = (known after apply)
<a id="__codelineno-7-34" name="__codelineno-7-34" href="#terraform-basis-__codelineno-7-34"></a>    }
<a id="__codelineno-7-35" name="__codelineno-7-35" href="#terraform-basis-__codelineno-7-35"></a>
<a id="__codelineno-7-36" name="__codelineno-7-36" href="#terraform-basis-__codelineno-7-36"></a>  # aci_lacp_policy.LACP_ACTIVE will be created
<a id="__codelineno-7-37" name="__codelineno-7-37" href="#terraform-basis-__codelineno-7-37"></a>  + resource &quot;aci_lacp_policy&quot; &quot;LACP_ACTIVE&quot; {
<a id="__codelineno-7-38" name="__codelineno-7-38" href="#terraform-basis-__codelineno-7-38"></a>      + annotation  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-7-39" name="__codelineno-7-39" href="#terraform-basis-__codelineno-7-39"></a>      + ctrl        = [
<a id="__codelineno-7-40" name="__codelineno-7-40" href="#terraform-basis-__codelineno-7-40"></a>          + &quot;susp-individual&quot;,
<a id="__codelineno-7-41" name="__codelineno-7-41" href="#terraform-basis-__codelineno-7-41"></a>          + &quot;fast-sel-hot-stdby&quot;,
<a id="__codelineno-7-42" name="__codelineno-7-42" href="#terraform-basis-__codelineno-7-42"></a>          + &quot;graceful-conv&quot;,
<a id="__codelineno-7-43" name="__codelineno-7-43" href="#terraform-basis-__codelineno-7-43"></a>        ]
<a id="__codelineno-7-44" name="__codelineno-7-44" href="#terraform-basis-__codelineno-7-44"></a>      + description = &quot;done by terraform&quot;
<a id="__codelineno-7-45" name="__codelineno-7-45" href="#terraform-basis-__codelineno-7-45"></a>      + id          = (known after apply)
<a id="__codelineno-7-46" name="__codelineno-7-46" href="#terraform-basis-__codelineno-7-46"></a>      + max_links   = (known after apply)
<a id="__codelineno-7-47" name="__codelineno-7-47" href="#terraform-basis-__codelineno-7-47"></a>      + min_links   = (known after apply)
<a id="__codelineno-7-48" name="__codelineno-7-48" href="#terraform-basis-__codelineno-7-48"></a>      + mode        = &quot;active&quot;
<a id="__codelineno-7-49" name="__codelineno-7-49" href="#terraform-basis-__codelineno-7-49"></a>      + name        = &quot;LACP_ACTIVE&quot;
<a id="__codelineno-7-50" name="__codelineno-7-50" href="#terraform-basis-__codelineno-7-50"></a>      + name_alias  = (known after apply)
<a id="__codelineno-7-51" name="__codelineno-7-51" href="#terraform-basis-__codelineno-7-51"></a>    }
<a id="__codelineno-7-52" name="__codelineno-7-52" href="#terraform-basis-__codelineno-7-52"></a>
<a id="__codelineno-7-53" name="__codelineno-7-53" href="#terraform-basis-__codelineno-7-53"></a>Plan: 3 to add, 0 to change, 0 to destroy.
<a id="__codelineno-7-54" name="__codelineno-7-54" href="#terraform-basis-__codelineno-7-54"></a>
<a id="__codelineno-7-55" name="__codelineno-7-55" href="#terraform-basis-__codelineno-7-55"></a>─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
<a id="__codelineno-7-56" name="__codelineno-7-56" href="#terraform-basis-__codelineno-7-56"></a>
<a id="__codelineno-7-57" name="__codelineno-7-57" href="#terraform-basis-__codelineno-7-57"></a>Note: You didn&#39;t use the -out option to save this plan, so Terraform can&#39;t guarantee to take exactly these actions if you run &quot;terraform apply&quot; now.
</code></pre></div>
<p>In the plan you can see all the <em>plus</em> signs beside the elements that are going to be added to the fabric. Terraform read the fabric state and compared with required configuration, and then decided which elements need to be added. At this point no configuration has been added yet to the fabric, Terraform only lists the changes it is planning to do.
As the Note says at the bottom, this plan was not saved to a file, but only displayed in the console. If you change command to <code>terraform plan -out interface-policies.plan</code>  you will see that a file was generated with the contents of the plan.</p>
<p>Now you can perform the <code>terraform apply</code> command. This command will run plan again, ask for approval and then it will go into the fabric and perform these actions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#terraform-basis-__codelineno-8-1"></a>&lt;plan omitted&gt;
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#terraform-basis-__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#terraform-basis-__codelineno-8-3"></a>Do you want to perform these actions?
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#terraform-basis-__codelineno-8-4"></a>  Terraform will perform the actions described above.
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#terraform-basis-__codelineno-8-5"></a>  Only &#39;yes&#39; will be accepted to approve.
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#terraform-basis-__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#terraform-basis-__codelineno-8-7"></a>  Enter a value: yes
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#terraform-basis-__codelineno-8-8"></a>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#terraform-basis-__codelineno-8-9"></a>aci_lldp_interface_policy.LLDP_ON: Creating...
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#terraform-basis-__codelineno-8-10"></a>aci_fabric_if_pol.auto-10G: Creating...
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#terraform-basis-__codelineno-8-11"></a>aci_lacp_policy.LACP_ACTIVE: Creating...
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#terraform-basis-__codelineno-8-12"></a>aci_lldp_interface_policy.LLDP_ON: Creation complete after 0s [id=uni/infra/lldpIfP-LLDP_ON]
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#terraform-basis-__codelineno-8-13"></a>aci_fabric_if_pol.auto-10G: Creation complete after 0s [id=uni/infra/hintfpol-LINK-10G]
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#terraform-basis-__codelineno-8-14"></a>aci_lacp_policy.LACP_ACTIVE: Creation complete after 0s [id=uni/infra/lacplagp-LACP_ACTIVE]
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#terraform-basis-__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#terraform-basis-__codelineno-8-16"></a>Apply complete! Resources: 3 added, 0 changed, 0 destroyed.
</code></pre></div>
<p>If you run plan command again now, you would see the output is different because now it will only show the changes it plans to do over the previous push. Since there are no changes in the config yet, the plan will not show anything new to be added:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#terraform-basis-__codelineno-9-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform plan
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#terraform-basis-__codelineno-9-2"></a>aci_fabric_node_member.Spine-103: Refreshing state... [id=uni/controller/nodeidentpol/nodep-TEP-1-103]
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#terraform-basis-__codelineno-9-3"></a>aci_fabric_node_member.Leaf-102: Refreshing state... [id=uni/controller/nodeidentpol/nodep-TEP-1-102]
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#terraform-basis-__codelineno-9-4"></a>aci_lacp_policy.LACP_ACTIVE: Refreshing state... [id=uni/infra/lacplagp-LACP_ACTIVE]
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#terraform-basis-__codelineno-9-5"></a>aci_fabric_if_pol.auto-10G: Refreshing state... [id=uni/infra/hintfpol-LINK-10G]
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#terraform-basis-__codelineno-9-6"></a>aci_fabric_node_member.Spine-104: Refreshing state... [id=uni/controller/nodeidentpol/nodep-TEP-1-104]
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#terraform-basis-__codelineno-9-7"></a>aci_lldp_interface_policy.LLDP_ON: Refreshing state... [id=uni/infra/lldpIfP-LLDP_ON]
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#terraform-basis-__codelineno-9-8"></a>aci_fabric_node_member.Leaf-101: Refreshing state... [id=uni/controller/nodeidentpol/nodep-TEP-1-101]
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#terraform-basis-__codelineno-9-9"></a>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#terraform-basis-__codelineno-9-10"></a>No changes. Your infrastructure matches the configuration.
</code></pre></div>
<h3 id="terraform-basis-43-vlans-domains-and-aaeps">4.3 VLANs, Domains and AAEPs</h3>
<p>Create VLAN pool with vlan-range, associate it with Physical Domain and AAEP. Let's put these policies in a separate, new file called <code>access-policies.tf</code>
We will create two VLAN pools, one for L2 Physical Domain, and second one for L3 Routed Domain. In the same way we will create two AEP, one for L2 connections and second one for L3 connections. Each AEP will map one domain:</p>
<ul>
<li>VLAN_POOL_L2 &lt;-- PHYSDOM_1 &lt;-- AEP_L2</li>
<li>VLAN_POOL_L3 &lt;-- EXTRTDOM_1 &lt;-- AEP_L3</li>
</ul>
<p>For VLAN pool there are two resources that need to be created: VLAN Pool and VLAN Range. In this case VLAN Range object is a child of VLAN Pool object, which means that the Range resource needs to have a reference to the VLAN Pool resource. This reference can be done in terraform by using the resource name followed by the attribute, in this case <code>id</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#terraform-basis-__codelineno-10-1"></a>resource &quot;aci_vlan_pool&quot; &quot;VLAN_POOL_L2&quot; {
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#terraform-basis-__codelineno-10-2"></a>  name  = &quot;VLAN_POOL_L2&quot;
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#terraform-basis-__codelineno-10-3"></a>  alloc_mode  = &quot;static&quot;
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#terraform-basis-__codelineno-10-4"></a>}
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#terraform-basis-__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#terraform-basis-__codelineno-10-6"></a>resource &quot;aci_ranges&quot; &quot;RANGE_100-200&quot; {
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#terraform-basis-__codelineno-10-7"></a>  vlan_pool_dn  = aci_vlan_pool.VLAN_POOL_L2.id
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#terraform-basis-__codelineno-10-8"></a>  from          = &quot;vlan-100&quot;
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#terraform-basis-__codelineno-10-9"></a>  to            = &quot;vlan-200&quot;
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#terraform-basis-__codelineno-10-10"></a>  alloc_mode    = &quot;inherit&quot;
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#terraform-basis-__codelineno-10-11"></a>}
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#terraform-basis-__codelineno-10-12"></a>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#terraform-basis-__codelineno-10-13"></a>resource &quot;aci_vlan_pool&quot; &quot;VLAN_POOL_L3&quot; {
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#terraform-basis-__codelineno-10-14"></a>  name  = &quot;VLAN_POOL_L3&quot;
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#terraform-basis-__codelineno-10-15"></a>  alloc_mode  = &quot;static&quot;
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#terraform-basis-__codelineno-10-16"></a>}
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#terraform-basis-__codelineno-10-17"></a>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#terraform-basis-__codelineno-10-18"></a>resource &quot;aci_ranges&quot; &quot;RANGE_201-300&quot; {
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#terraform-basis-__codelineno-10-19"></a>  vlan_pool_dn  = aci_vlan_pool.VLAN_POOL_L3.id
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#terraform-basis-__codelineno-10-20"></a>  from          = &quot;vlan-201&quot;
<a id="__codelineno-10-21" name="__codelineno-10-21" href="#terraform-basis-__codelineno-10-21"></a>  to            = &quot;vlan-300&quot;
<a id="__codelineno-10-22" name="__codelineno-10-22" href="#terraform-basis-__codelineno-10-22"></a>  alloc_mode    = &quot;inherit&quot;
<a id="__codelineno-10-23" name="__codelineno-10-23" href="#terraform-basis-__codelineno-10-23"></a>}
</code></pre></div>
<p>Two domains, physical and routed, will be created as two resources, and each of them needs to have a reference to a VLAN Pool. This reference will be done by special attribute <code>relation_infra_rs_vlan_ns</code>, by referencing the resource name and id attribute:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#terraform-basis-__codelineno-11-1"></a>resource &quot;aci_physical_domain&quot; &quot;PHYSDOM_1&quot; {
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#terraform-basis-__codelineno-11-2"></a>  name        = &quot;PHYSDOM_1&quot;
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#terraform-basis-__codelineno-11-3"></a>  relation_infra_rs_vlan_ns = aci_vlan_pool.VLAN_POOL_L2.id
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#terraform-basis-__codelineno-11-4"></a>}
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#terraform-basis-__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#terraform-basis-__codelineno-11-6"></a>resource &quot;aci_l3_domain_profile&quot; &quot;EXTRTDOM_1&quot; {
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#terraform-basis-__codelineno-11-7"></a>  name  = &quot;EXTRTDOM_1&quot;
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#terraform-basis-__codelineno-11-8"></a>  relation_infra_rs_vlan_ns = aci_vlan_pool.VLAN_POOL_L3.id
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#terraform-basis-__codelineno-11-9"></a>}
</code></pre></div>
<p>Two AAEP will be created, one for L2 connections and another one for L3 connections.
Between AAEP and Domains there is also relationship. AEP needs to be related to a domain. This relation can be done in two ways:</p>
<ul>
<li>separate resource <code>aci_aaep_to_domain</code> which is shown in the example below for AEP_L2 and PHYSDOM_1 relation. This resource needs to reference <code>id</code> values of both AEP and Physical Domain</li>
<li>argument within <code>aci_attachable_access_entity_profile</code> called <code>relation_infra_rs_dom_p</code> which is shown in the example below for AEP_L3 and EXTRTDOM_1 relation. This argument needs to reference <code>id</code> values of both AEP and Routed Domain, but needs to be embedded in [] as the documentation says it's <em>Type -[Set of String]</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#terraform-basis-__codelineno-12-1"></a>resource &quot;aci_attachable_access_entity_profile&quot; &quot;AEP_L2&quot; {
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#terraform-basis-__codelineno-12-2"></a>  description = &quot;AAEP for L2 connections&quot;
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#terraform-basis-__codelineno-12-3"></a>  name        = &quot;AEP_L2&quot;
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#terraform-basis-__codelineno-12-4"></a>}
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#terraform-basis-__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#terraform-basis-__codelineno-12-6"></a>resource &quot;aci_aaep_to_domain&quot; &quot;AEP_L2_to_PHYSDOM_1&quot; {
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#terraform-basis-__codelineno-12-7"></a>  attachable_access_entity_profile_dn = aci_attachable_access_entity_profile.AEP_L2.id
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#terraform-basis-__codelineno-12-8"></a>  domain_dn                           = aci_physical_domain.PHYSDOM_1.id
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#terraform-basis-__codelineno-12-9"></a>}
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#terraform-basis-__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#terraform-basis-__codelineno-12-11"></a>resource &quot;aci_attachable_access_entity_profile&quot; &quot;AEP_L3&quot; {
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#terraform-basis-__codelineno-12-12"></a>  description = &quot;AAEP for L3 connections&quot;
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#terraform-basis-__codelineno-12-13"></a>  name        = &quot;AEP_L3&quot;
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#terraform-basis-__codelineno-12-14"></a>  relation_infra_rs_dom_p = [aci_l3_domain_profile.EXTRTDOM_1.id]
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#terraform-basis-__codelineno-12-15"></a>}
</code></pre></div>
<p>You can plan and apply to see the result on ACI.</p>
<p>Documentation of resources:</p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/vlan_pool" target="_blank">aci_vlan_pool resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/ranges" target="_blank">aci_ranges resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/physical_domain" target="_blank">aci_physical_domain resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/l3_domain_profile" target="_blank">aci_l3_domain_profile resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/attachable_access_entity_profile" target="_blank">aci_attachable_access_entity_profile resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/aaep_to_domain" target="_blank">aci_aaep_to_domain resource</a></p>
<h3 id="terraform-basis-44-interface-policy-group">4.4 Interface Policy group</h3>
<p>Let's now create two Interface Policy Groups, one for server (L2) and another one for router (L3) and use all created policies:</p>
<ul>
<li>IntPolGrp_VPC_server1 VPC policy with AEP_L2</li>
<li>IntPolGrp_Router1 access port policy with AEP_L3</li>
</ul>
<p>Those interface policy groups will have relation to all the access policies we created before by referencing the <code>id</code> of those policies:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#terraform-basis-__codelineno-13-1"></a>resource &quot;aci_leaf_access_bundle_policy_group&quot; &quot;IntPolGrp_VPC_server1&quot; {
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#terraform-basis-__codelineno-13-2"></a>  name        = &quot;IntPolGrp_VPC_server1&quot;
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#terraform-basis-__codelineno-13-3"></a>  lag_t       = &quot;node&quot;
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#terraform-basis-__codelineno-13-4"></a>  relation_infra_rs_lldp_if_pol = aci_lldp_interface_policy.LLDP_ON.id
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#terraform-basis-__codelineno-13-5"></a>  relation_infra_rs_lacp_pol = aci_lacp_policy.LACP_ACTIVE.id
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#terraform-basis-__codelineno-13-6"></a>  relation_infra_rs_h_if_pol    = aci_fabric_if_pol.LINK-10G.id
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#terraform-basis-__codelineno-13-7"></a>  relation_infra_rs_att_ent_p   = aci_attachable_access_entity_profile.AEP_L2.id
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#terraform-basis-__codelineno-13-8"></a>}
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#terraform-basis-__codelineno-13-9"></a>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#terraform-basis-__codelineno-13-10"></a>resource &quot;aci_leaf_access_bundle_policy_group&quot; &quot;IntPolGrp_Router1&quot; {
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#terraform-basis-__codelineno-13-11"></a>    name        = &quot;IntPolGrp_Router1&quot;
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#terraform-basis-__codelineno-13-12"></a>    lag_t       = &quot;node&quot;
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#terraform-basis-__codelineno-13-13"></a>    relation_infra_rs_lldp_if_pol = aci_lldp_interface_policy.LLDP_ON.id
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#terraform-basis-__codelineno-13-14"></a>    relation_infra_rs_lacp_pol = aci_lacp_policy.LACP_ACTIVE.id
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#terraform-basis-__codelineno-13-15"></a>    relation_infra_rs_h_if_pol    = aci_fabric_if_pol.LINK-10G.id
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#terraform-basis-__codelineno-13-16"></a>    relation_infra_rs_att_ent_p   = aci_attachable_access_entity_profile.AEP_L3.id
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#terraform-basis-__codelineno-13-17"></a>}
</code></pre></div>
<p>You can plan and apply to see the result on ACI.</p>
<p>Documentation of resources:</p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/leaf_access_bundle_policy_group" target="_blank">aci_leaf_access_bundle_policy_group resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/leaf_access_port_policy_group" target="_blank">aci_leaf_access_port_policy_group resource</a></p>
<h3 id="terraform-basis-45-switch-interface-profiles">4.5 Switch &amp; Interface Profiles</h3>
<p>Let's assign our created interface policy groups to the newly created switch and interface profiles. We will create:</p>
<ul>
<li>switch profile</li>
<li>
<p>interface profile <em>IntProf-101-102</em> with two interface selectors</p>
<ul>
<li>eth1/1 connecting server</li>
<li>eth1/2 connecting router</li>
</ul>
</li>
</ul>
<p>First we create interface profile within this profile two interface selectors. Interface selectors need to have reference to the Interface Profile (<em>IntProf-101-102</em>) and relation to the interface policy groups created for our end devices:</p>
<ul>
<li><em>IntPolGrp_VPC_server1</em></li>
<li><em>IntPolGrp_Router1</em></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#terraform-basis-__codelineno-14-1"></a>resource &quot;aci_leaf_interface_profile&quot; &quot;IntProf-101-102&quot; {
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#terraform-basis-__codelineno-14-2"></a>    name        = &quot;IntProf-101-102&quot;
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#terraform-basis-__codelineno-14-3"></a>}
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#terraform-basis-__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#terraform-basis-__codelineno-14-5"></a>resource &quot;aci_access_port_selector&quot; &quot;leaf-101-102-eth-1&quot; {
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#terraform-basis-__codelineno-14-6"></a>    leaf_interface_profile_dn      = aci_leaf_interface_profile.IntProf-101-102.id
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#terraform-basis-__codelineno-14-7"></a>    name                           = &quot;leaf-101-102-eth-1&quot;
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#terraform-basis-__codelineno-14-8"></a>    access_port_selector_type      = &quot;range&quot;
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#terraform-basis-__codelineno-14-9"></a>    relation_infra_rs_acc_base_grp = aci_leaf_access_bundle_policy_group.IntPolGrp_VPC_server1.id
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#terraform-basis-__codelineno-14-10"></a>}
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#terraform-basis-__codelineno-14-11"></a>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#terraform-basis-__codelineno-14-12"></a>resource &quot;aci_access_port_block&quot; &quot;leaf-101-102-eth-1-block&quot; {
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#terraform-basis-__codelineno-14-13"></a>    access_port_selector_dn = aci_access_port_selector.leaf-101-102-eth-1.id
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#terraform-basis-__codelineno-14-14"></a>    name                    = &quot;leaf-101-102-eth-1-block&quot;
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#terraform-basis-__codelineno-14-15"></a>    from_card               = &quot;1&quot;
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#terraform-basis-__codelineno-14-16"></a>    from_port               = &quot;1&quot;
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#terraform-basis-__codelineno-14-17"></a>    to_card                 = &quot;1&quot;
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#terraform-basis-__codelineno-14-18"></a>    to_port                 = &quot;1&quot;
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#terraform-basis-__codelineno-14-19"></a>}
<a id="__codelineno-14-20" name="__codelineno-14-20" href="#terraform-basis-__codelineno-14-20"></a>
<a id="__codelineno-14-21" name="__codelineno-14-21" href="#terraform-basis-__codelineno-14-21"></a>resource &quot;aci_access_port_selector&quot; &quot;leaf-101-102-eth-2&quot; {
<a id="__codelineno-14-22" name="__codelineno-14-22" href="#terraform-basis-__codelineno-14-22"></a>    leaf_interface_profile_dn      = aci_leaf_interface_profile.IntProf-101-102.id
<a id="__codelineno-14-23" name="__codelineno-14-23" href="#terraform-basis-__codelineno-14-23"></a>    name                           = &quot;leaf-101-102-eth-2&quot;
<a id="__codelineno-14-24" name="__codelineno-14-24" href="#terraform-basis-__codelineno-14-24"></a>    access_port_selector_type      = &quot;range&quot;
<a id="__codelineno-14-25" name="__codelineno-14-25" href="#terraform-basis-__codelineno-14-25"></a>    relation_infra_rs_acc_base_grp = aci_leaf_access_bundle_policy_group.IntPolGrp_Router1.id
<a id="__codelineno-14-26" name="__codelineno-14-26" href="#terraform-basis-__codelineno-14-26"></a>}
<a id="__codelineno-14-27" name="__codelineno-14-27" href="#terraform-basis-__codelineno-14-27"></a>
<a id="__codelineno-14-28" name="__codelineno-14-28" href="#terraform-basis-__codelineno-14-28"></a>resource &quot;aci_access_port_block&quot; &quot;leaf-101-102-eth-2-block&quot; {
<a id="__codelineno-14-29" name="__codelineno-14-29" href="#terraform-basis-__codelineno-14-29"></a>    access_port_selector_dn = aci_access_port_selector.leaf-101-102-eth-2.id
<a id="__codelineno-14-30" name="__codelineno-14-30" href="#terraform-basis-__codelineno-14-30"></a>    name                    = &quot;leaf-101-102-eth-2-block&quot;
<a id="__codelineno-14-31" name="__codelineno-14-31" href="#terraform-basis-__codelineno-14-31"></a>    from_card               = &quot;1&quot;
<a id="__codelineno-14-32" name="__codelineno-14-32" href="#terraform-basis-__codelineno-14-32"></a>    from_port               = &quot;2&quot;
<a id="__codelineno-14-33" name="__codelineno-14-33" href="#terraform-basis-__codelineno-14-33"></a>    to_card                 = &quot;1&quot;
<a id="__codelineno-14-34" name="__codelineno-14-34" href="#terraform-basis-__codelineno-14-34"></a>    to_port                 = &quot;2&quot;
<a id="__codelineno-14-35" name="__codelineno-14-35" href="#terraform-basis-__codelineno-14-35"></a>}
</code></pre></div>
<p>Next we have our switch profile configuration which needs to have a reference to the leaf interface profile (<em>IntProf-101-102</em>) as well as mark the nodes which will be used in this switch profile (nodes 101 &amp; 102)
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#terraform-basis-__codelineno-15-1"></a>resource &quot;aci_leaf_profile&quot; &quot;SwProf-101-102&quot; {
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#terraform-basis-__codelineno-15-2"></a>    name                         = &quot;SwProf-101-102&quot;
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#terraform-basis-__codelineno-15-3"></a>    relation_infra_rs_acc_port_p = [aci_leaf_interface_profile.IntProf-101-102.id]
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#terraform-basis-__codelineno-15-4"></a>}
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#terraform-basis-__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#terraform-basis-__codelineno-15-6"></a>resource &quot;aci_leaf_selector&quot; &quot;Sel-101-102&quot; {
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#terraform-basis-__codelineno-15-7"></a>    leaf_profile_dn         = aci_leaf_profile.SwProf-101-102.id
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#terraform-basis-__codelineno-15-8"></a>    name                    = &quot;Sel-101-102&quot;
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#terraform-basis-__codelineno-15-9"></a>    switch_association_type = &quot;range&quot;
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#terraform-basis-__codelineno-15-10"></a>}
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#terraform-basis-__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#terraform-basis-__codelineno-15-12"></a>resource &quot;aci_node_block&quot; &quot;Sel-101-102-Block&quot; {
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#terraform-basis-__codelineno-15-13"></a>    switch_association_dn = aci_leaf_selector.Sel-101-102.id
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#terraform-basis-__codelineno-15-14"></a>    name                  = &quot;Sel-101-102-Block&quot;
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#terraform-basis-__codelineno-15-15"></a>    from_                 = &quot;101&quot;
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#terraform-basis-__codelineno-15-16"></a>    to_                   = &quot;102&quot;
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#terraform-basis-__codelineno-15-17"></a>}
</code></pre></div></p>
<p>You can plan and apply to see the result on ACI.</p>
<h3 id="terraform-basis-46-vpc-protection-groups">4.6 VPC Protection Groups</h3>
<p>For a pair of switches that are expected to work as VPC it is required to configure a VPC protection group.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#terraform-basis-__codelineno-16-1"></a>resource &quot;aci_vpc_explicit_protection_group&quot; &quot;vpc-101-102&quot; {
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#terraform-basis-__codelineno-16-2"></a>  name                              = &quot;vpc-101-102&quot;
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#terraform-basis-__codelineno-16-3"></a>  switch1                           = &quot;101&quot;
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#terraform-basis-__codelineno-16-4"></a>  switch2                           = &quot;102&quot;
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#terraform-basis-__codelineno-16-5"></a>  vpc_explicit_protection_group_id  = &quot;101&quot;
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#terraform-basis-__codelineno-16-6"></a>}
</code></pre></div>
<h2 id="terraform-basis-5-aci-tenant">5 ACI Tenant</h2>
<p>Upon now you created ACI AccessPolicies for your Tenant.
Now is time to create your tenant using Terraform. It will be simple Tenant definition with one VRF, one bridge domains associated with one EPG and one L3out. EPG will be associated with L2 domain and statically binded to VPC created, with VLAN from L2 VLAN pool done by you perviously. The L3out will be associated to L3 domain and router interface, with VLAN from L3 VLAN pool.</p>
<p>Figure below shows our Logical Tenant.</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/terraform-tenant-dcloud-1.png" width = 800></p>
<p>You need to define Tenant, VRF, Bridge-Domain, Application-Profile, EPG with Domain association, static binding under EPG and L3out. Quite many of resources to do in Terraform. We will define all of them in a single, new config file called dcloud-tenant-1.tf
Please, download a terraform file from <mark><strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/dcloud-tenant-1.tf" target="_blank">Terraform Tenant Ready</a>.</strong></mark></p>
<h3 id="terraform-basis-51-tenant-components">5.1 Tenant components</h3>
<p>This section contains Terraform codes necessary to create Tenant objects</p>
<h3 id="terraform-basis-511-tenant-and-vrf">5.1.1 Tenant and VRF</h3>
<p>Following code can be used to create new Tenant and VRFs. The VRF resource needs to reference its parent object - tenant id.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#terraform-basis-__codelineno-17-1"></a>resource &quot;aci_tenant&quot; &quot;dcloud-tenant-1&quot; {
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#terraform-basis-__codelineno-17-2"></a>  name             = &quot;dcloud-tenant-1&quot;
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#terraform-basis-__codelineno-17-3"></a>}
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#terraform-basis-__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#terraform-basis-__codelineno-17-5"></a>resource &quot;aci_vrf&quot; &quot;vrf1&quot; {
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#terraform-basis-__codelineno-17-6"></a>  tenant_dn         = aci_tenant.dcloud-tenant-1.id
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#terraform-basis-__codelineno-17-7"></a>  name              = &quot;vrf1&quot;
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#terraform-basis-__codelineno-17-8"></a>}
</code></pre></div>
<h3 id="terraform-basis-512-bd-in-existing-tenant">5.1.2 BD in existing tenant</h3>
<p>Following code can be used to create new Bridge Domain in existing Tenant. Bridge Domain needs to have a reference to parent objects: tenant ID and VRF ID. There is also a child object of bridge domain which is a Subnet with reference to bridge domain ID.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#terraform-basis-__codelineno-18-1"></a>resource &quot;aci_bridge_domain&quot; &quot;bd-network-1&quot; {
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#terraform-basis-__codelineno-18-2"></a>    tenant_dn             = aci_tenant.dcloud-tenant-1.id
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#terraform-basis-__codelineno-18-3"></a>    relation_fv_rs_ctx    = aci_vrf.vrf1.id
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#terraform-basis-__codelineno-18-4"></a>    name                  = &quot;bd-network-1&quot;
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#terraform-basis-__codelineno-18-5"></a>}
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#terraform-basis-__codelineno-18-6"></a>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#terraform-basis-__codelineno-18-7"></a>resource &quot;aci_subnet&quot; &quot;subnet-1&quot; {
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#terraform-basis-__codelineno-18-8"></a>    parent_dn            = aci_bridge_domain.bd-network-1.id
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#terraform-basis-__codelineno-18-9"></a>    ip                   = &quot;10.0.0.1/24&quot;
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#terraform-basis-__codelineno-18-10"></a>    scope                = [&quot;public&quot;]
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#terraform-basis-__codelineno-18-11"></a>}
</code></pre></div>
<p>You can plan and apply to see the result on ACI.</p>
<h3 id="terraform-basis-513-application-profile-with-epg-and-static-bindings">5.1.3 Application Profile with EPG and static bindings</h3>
<p>Following code can be used to create new Application Profile with EPG. Application Profile needs a reference to parent object tenant ID, while EPG needs reference to AP ID ad Bridge Domain ID. The next two resources reflect the physical domain PHYSDOM_1 attached to that EPG, and one static binding towards our server1 with encapsulation of vlan 100.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#terraform-basis-__codelineno-19-1"></a>resource &quot;aci_application_profile&quot; &quot;ap1&quot; {
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#terraform-basis-__codelineno-19-2"></a>  tenant_dn  = aci_tenant.dcloud-tenant-1.id
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#terraform-basis-__codelineno-19-3"></a>  name       = &quot;ap1&quot;
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#terraform-basis-__codelineno-19-4"></a>}
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#terraform-basis-__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#terraform-basis-__codelineno-19-6"></a>resource &quot;aci_application_epg&quot; &quot;epg1&quot; {
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#terraform-basis-__codelineno-19-7"></a>    application_profile_dn  = aci_application_profile.ap1.id
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#terraform-basis-__codelineno-19-8"></a>    name                    = &quot;epg1&quot;
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#terraform-basis-__codelineno-19-9"></a>    relation_fv_rs_bd       = aci_bridge_domain.bd-network-1.id
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#terraform-basis-__codelineno-19-10"></a>}
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#terraform-basis-__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#terraform-basis-__codelineno-19-12"></a>resource &quot;aci_epg_to_domain&quot; &quot;epg1-to-physdom_1&quot; {
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#terraform-basis-__codelineno-19-13"></a>    application_epg_dn = aci_application_epg.epg1.id
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#terraform-basis-__codelineno-19-14"></a>    tdn = aci_physical_domain.PHYSDOM_1.id
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#terraform-basis-__codelineno-19-15"></a>    }
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#terraform-basis-__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#terraform-basis-__codelineno-19-17"></a>resource &quot;aci_epg_to_static_path&quot; &quot;static-binding-1&quot; {
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#terraform-basis-__codelineno-19-18"></a>  application_epg_dn  = aci_application_epg.epg1.id
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#terraform-basis-__codelineno-19-19"></a>  tdn  = &quot;topology/pod-1/protpaths-101-102/pathep-[IntPolGrp_VPC_server1]&quot;
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#terraform-basis-__codelineno-19-20"></a>  encap  = &quot;vlan-100&quot;
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#terraform-basis-__codelineno-19-21"></a>  mode  = &quot;regular&quot;
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#terraform-basis-__codelineno-19-22"></a>}
</code></pre></div>
<p>You can plan and apply to see the result on ACI.</p>
<h3 id="terraform-basis-514-l3out">5.1.4 L3Out</h3>
<p>Following code can be used to create new L3out. As you can see there are plenty of resources which reflect node profile and node mapping, interface profile and path used for it, external EPG with subnet.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#terraform-basis-__codelineno-20-1"></a>resource &quot;aci_l3_outside&quot; &quot;l3out-1&quot; {
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#terraform-basis-__codelineno-20-2"></a>        tenant_dn      = aci_tenant.dcloud-tenant-1.id
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#terraform-basis-__codelineno-20-3"></a>        name           = &quot;l3out-1&quot;
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#terraform-basis-__codelineno-20-4"></a>        relation_l3ext_rs_l3_dom_att = aci_l3_domain_profile.EXTRTDOM_1.id
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#terraform-basis-__codelineno-20-5"></a>        relation_l3ext_rs_ectx = aci_vrf.vrf1.id
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#terraform-basis-__codelineno-20-6"></a>    }
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#terraform-basis-__codelineno-20-7"></a>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#terraform-basis-__codelineno-20-8"></a>resource &quot;aci_logical_node_profile&quot; &quot;np-101-102&quot; {
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#terraform-basis-__codelineno-20-9"></a>        l3_outside_dn = aci_l3_outside.l3out-1.id
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#terraform-basis-__codelineno-20-10"></a>        name          = &quot;np-101-102&quot;
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#terraform-basis-__codelineno-20-11"></a>      }
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#terraform-basis-__codelineno-20-12"></a>
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#terraform-basis-__codelineno-20-13"></a>resource &quot;aci_logical_node_to_fabric_node&quot; &quot;np-101-102-to-node-101&quot; {
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#terraform-basis-__codelineno-20-14"></a>  logical_node_profile_dn  = aci_logical_node_profile.np-101-102.id
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#terraform-basis-__codelineno-20-15"></a>  tdn               = &quot;topology/pod-1/node-101&quot;
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#terraform-basis-__codelineno-20-16"></a>  rtr_id            = &quot;1.1.1.1&quot;
<a id="__codelineno-20-17" name="__codelineno-20-17" href="#terraform-basis-__codelineno-20-17"></a>}
<a id="__codelineno-20-18" name="__codelineno-20-18" href="#terraform-basis-__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19" href="#terraform-basis-__codelineno-20-19"></a>resource &quot;aci_logical_node_to_fabric_node&quot; &quot;np-101-102-to-node-102&quot; {
<a id="__codelineno-20-20" name="__codelineno-20-20" href="#terraform-basis-__codelineno-20-20"></a>  logical_node_profile_dn  = aci_logical_node_profile.np-101-102.id
<a id="__codelineno-20-21" name="__codelineno-20-21" href="#terraform-basis-__codelineno-20-21"></a>  tdn               = &quot;topology/pod-1/node-102&quot;
<a id="__codelineno-20-22" name="__codelineno-20-22" href="#terraform-basis-__codelineno-20-22"></a>  rtr_id            = &quot;1.1.1.2&quot;
<a id="__codelineno-20-23" name="__codelineno-20-23" href="#terraform-basis-__codelineno-20-23"></a>}
<a id="__codelineno-20-24" name="__codelineno-20-24" href="#terraform-basis-__codelineno-20-24"></a>
<a id="__codelineno-20-25" name="__codelineno-20-25" href="#terraform-basis-__codelineno-20-25"></a>resource &quot;aci_logical_interface_profile&quot; &quot;ip-101-102&quot; {
<a id="__codelineno-20-26" name="__codelineno-20-26" href="#terraform-basis-__codelineno-20-26"></a>        logical_node_profile_dn = aci_logical_node_profile.np-101-102.id
<a id="__codelineno-20-27" name="__codelineno-20-27" href="#terraform-basis-__codelineno-20-27"></a>        name                    = &quot;ip-101-102&quot;
<a id="__codelineno-20-28" name="__codelineno-20-28" href="#terraform-basis-__codelineno-20-28"></a>  }
<a id="__codelineno-20-29" name="__codelineno-20-29" href="#terraform-basis-__codelineno-20-29"></a>
<a id="__codelineno-20-30" name="__codelineno-20-30" href="#terraform-basis-__codelineno-20-30"></a>resource &quot;aci_l3out_path_attachment&quot; &quot;l3ip-path&quot; {
<a id="__codelineno-20-31" name="__codelineno-20-31" href="#terraform-basis-__codelineno-20-31"></a>  logical_interface_profile_dn  = aci_logical_interface_profile.ip-101-102.id
<a id="__codelineno-20-32" name="__codelineno-20-32" href="#terraform-basis-__codelineno-20-32"></a>  target_dn  = &quot;topology/pod-1/protpaths-101-102/pathep-[IntPolGrp_Router1]&quot;
<a id="__codelineno-20-33" name="__codelineno-20-33" href="#terraform-basis-__codelineno-20-33"></a>  if_inst_t = &quot;ext-svi&quot;
<a id="__codelineno-20-34" name="__codelineno-20-34" href="#terraform-basis-__codelineno-20-34"></a>  addr  = &quot;10.1.1.1/24&quot;
<a id="__codelineno-20-35" name="__codelineno-20-35" href="#terraform-basis-__codelineno-20-35"></a>  encap  = &quot;vlan-201&quot;
<a id="__codelineno-20-36" name="__codelineno-20-36" href="#terraform-basis-__codelineno-20-36"></a>  encap_scope = &quot;ctx&quot;
<a id="__codelineno-20-37" name="__codelineno-20-37" href="#terraform-basis-__codelineno-20-37"></a>  mode = &quot;regular&quot;
<a id="__codelineno-20-38" name="__codelineno-20-38" href="#terraform-basis-__codelineno-20-38"></a>  mtu = &quot;inherit&quot;
<a id="__codelineno-20-39" name="__codelineno-20-39" href="#terraform-basis-__codelineno-20-39"></a>}
<a id="__codelineno-20-40" name="__codelineno-20-40" href="#terraform-basis-__codelineno-20-40"></a>
<a id="__codelineno-20-41" name="__codelineno-20-41" href="#terraform-basis-__codelineno-20-41"></a>resource &quot;aci_external_network_instance_profile&quot; &quot;extepg&quot; {
<a id="__codelineno-20-42" name="__codelineno-20-42" href="#terraform-basis-__codelineno-20-42"></a>  l3_outside_dn  = aci_l3_outside.l3out-1.id
<a id="__codelineno-20-43" name="__codelineno-20-43" href="#terraform-basis-__codelineno-20-43"></a>  name           = &quot;extepg&quot;
<a id="__codelineno-20-44" name="__codelineno-20-44" href="#terraform-basis-__codelineno-20-44"></a>}
<a id="__codelineno-20-45" name="__codelineno-20-45" href="#terraform-basis-__codelineno-20-45"></a>
<a id="__codelineno-20-46" name="__codelineno-20-46" href="#terraform-basis-__codelineno-20-46"></a>resource &quot;aci_l3_ext_subnet&quot; &quot;extepg-subnet&quot; {
<a id="__codelineno-20-47" name="__codelineno-20-47" href="#terraform-basis-__codelineno-20-47"></a>  external_network_instance_profile_dn  = aci_external_network_instance_profile.extepg.id
<a id="__codelineno-20-48" name="__codelineno-20-48" href="#terraform-basis-__codelineno-20-48"></a>  ip                                    = &quot;0.0.0.0/0&quot;
<a id="__codelineno-20-49" name="__codelineno-20-49" href="#terraform-basis-__codelineno-20-49"></a>  scope                                 = [&quot;import-security&quot;,&quot;export-rtctrl&quot;]
<a id="__codelineno-20-50" name="__codelineno-20-50" href="#terraform-basis-__codelineno-20-50"></a>}
</code></pre></div>
<p>You can plan and apply to see the result on ACI.</p>
<p>Documentation of resources:</p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/tenant" target="_blank">aci_tenant resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/bridge_domain" target="_blank">aci_bridge_domain</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/subnet" target="_blank">aci_subnet resource</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/application_profile" target="_blank">aci_application_profile</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/application_epg" target="_blank">aci_application_epg</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/epg_to_domain" target="_blank">aci_epg_to_domain</a></p>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/resources/l3_outside" target="_blank">aci_l3_outside</a></p></section><section class="print-page" id="terraform-vars"><h1 id="terraform-vars-terraform-language">Terraform Language</h1>
<p>As you can see in the previous lab, manually specifying each resource and its values is very time consuming. In this lab you will learn how to use variables and functions to simplify the work</p>
<h2 id="terraform-vars-1-variable-file">1. Variable file</h2>
<p>Variable declarations can appear anywhere in your configuration files. However, it is recommended putting them into a separate file called variables.tf to make it easier for users to understand how the configuration is meant to be customized.</p>
<p>To parameterize an argument with an input variable, you will first define the variable in <code>variables.tf</code>, then replace the hardcoded value with a reference to that variable in your configuration.</p>
<p>Variable blocks have three optional arguments.</p>
<ul>
<li><strong>Description</strong>: A short description to document the purpose of the variable.</li>
<li><strong>Type</strong>: The type of data contained in the variable.</li>
<li><strong>Default</strong>: The default value.</li>
</ul>
<p>If you do not set a default value for a variable, you must assign a value before Terraform can apply the configuration. Terraform does not support unassigned variables.</p>
<p>When variables are declared in the root folder of your configuration, they can be set in a number of ways:</p>
<ul>
<li>In a Terraform Cloud workspace.</li>
<li>Individually, with the -var command line option.</li>
<li>In variable definitions (.tfvars) files, either specified on the command line or automatically loaded.</li>
<li>As environment variables.</li>
</ul>
<h3 id="terraform-vars-11-variables-definition">1.1 Variables definition</h3>
<p>Let's create in our folder new file called <code>variables.tf</code>. In this file let's define several variables that we will use to deploy new tenant.</p>
<p>Following variables will be used as a name for new tenant, VRF and bridge domain. Those variables have only a default value defined which will be used if no other value is specified for execution.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#terraform-vars-__codelineno-0-1"></a>variable &quot;tenant_name&quot; {
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#terraform-vars-__codelineno-0-2"></a>  default = &quot;dcloud-tenant-2&quot;
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#terraform-vars-__codelineno-0-3"></a>}
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#terraform-vars-__codelineno-0-4"></a>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#terraform-vars-__codelineno-0-5"></a>variable &quot;vrf_name&quot; {
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#terraform-vars-__codelineno-0-6"></a>  default = &quot;vrf2-1&quot;
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#terraform-vars-__codelineno-0-7"></a>}
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#terraform-vars-__codelineno-0-8"></a>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#terraform-vars-__codelineno-0-9"></a>variable &quot;bd_name&quot; {
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#terraform-vars-__codelineno-0-10"></a>  default = &quot;bd2-1&quot;
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#terraform-vars-__codelineno-0-11"></a>}
</code></pre></div>
<p>The next variable is used for specifying the ARP flooding behaviour of a bridge domain. Here you can see that we are using all possible options:</p>
<ul>
<li>description of variable</li>
<li>default value to be used if no other is specfied</li>
<li>
<p>validation mechanism with:</p>
<ul>
<li>condition - variable can be set to either "yes" or "no" value</li>
<li>error message to be displayed if specified value doesn't pass the validation test</li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#terraform-vars-__codelineno-1-1"></a>variable &quot;bd_arp_flood&quot; {
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#terraform-vars-__codelineno-1-2"></a>  description = &quot;Specify whether ARP flooding is enabled. If flooding is disabled, unicast routing will be performed on the target IP address.&quot;
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#terraform-vars-__codelineno-1-3"></a>  default = &quot;yes&quot;
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#terraform-vars-__codelineno-1-4"></a>  validation {
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#terraform-vars-__codelineno-1-5"></a>    condition = (var.bd_arp_flood == &quot;yes&quot;) || (var.bd_arp_flood == &quot;no&quot;)
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#terraform-vars-__codelineno-1-6"></a>    error_message = &quot;Allowed values are \&quot;yes\&quot; and \&quot;no\&quot;.&quot;
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#terraform-vars-__codelineno-1-7"></a>  }
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#terraform-vars-__codelineno-1-8"></a>}
</code></pre></div>
<p>The last two variables will be specifying bridge domain behaviour for unicast routing and unknown unicast flooding:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#terraform-vars-__codelineno-2-1"></a>variable &quot;bd_unicast_routing&quot; {
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#terraform-vars-__codelineno-2-2"></a>  default = &quot;yes&quot;
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#terraform-vars-__codelineno-2-3"></a>}
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#terraform-vars-__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#terraform-vars-__codelineno-2-5"></a>variable &quot;bd_unk_ucast&quot; {
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#terraform-vars-__codelineno-2-6"></a>  default = &quot;proxy&quot;
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#terraform-vars-__codelineno-2-7"></a>}
</code></pre></div>
<h3 id="terraform-vars-12-variable-usage-in-config">1.2 Variable usage in config</h3>
<p>Now let's use the variables we defined to create new tenant. For this task please create new config file called <code>dcloud-tenant-2.tf</code>. We will use it to deploy new tenant called <em>dcloud-tenant-2</em> with one VRF and bridge domain.</p>
<p>The way we make references to our variables is by using <em>var.<variable name></em> inside our config file. the <em>var.</em> part of this syntax indicates that we are using variables.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#terraform-vars-__codelineno-3-1"></a>resource &quot;aci_tenant&quot; &quot;dcloud-tenant-2&quot; {
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#terraform-vars-__codelineno-3-2"></a>  name        = var.tenant_name
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#terraform-vars-__codelineno-3-3"></a>  description = &quot;This is a new tenant created from Terraform&quot;
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#terraform-vars-__codelineno-3-4"></a>}
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#terraform-vars-__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#terraform-vars-__codelineno-3-6"></a>resource &quot;aci_vrf&quot; &quot;vrf2-1&quot; {
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#terraform-vars-__codelineno-3-7"></a>  tenant_dn              = aci_tenant.dcloud-tenant-2.id
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#terraform-vars-__codelineno-3-8"></a>  name                   = var.vrf_name
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#terraform-vars-__codelineno-3-9"></a>}
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#terraform-vars-__codelineno-3-10"></a>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#terraform-vars-__codelineno-3-11"></a>resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_1_0&quot; {
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#terraform-vars-__codelineno-3-12"></a>  tenant_dn                   = aci_tenant.dcloud-tenant-2.id
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#terraform-vars-__codelineno-3-13"></a>  name                        = var.bd_name
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#terraform-vars-__codelineno-3-14"></a>  arp_flood                   = var.bd_arp_flood
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#terraform-vars-__codelineno-3-15"></a>  unicast_route               = var.bd_unicast_routing
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#terraform-vars-__codelineno-3-16"></a>  unk_mac_ucast_act           = var.bd_unk_ucast
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#terraform-vars-__codelineno-3-17"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#terraform-vars-__codelineno-3-18"></a>  relation_fv_rs_ctx          = aci_vrf.vrf2-1.id
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#terraform-vars-__codelineno-3-19"></a>}
</code></pre></div>
<p>In our <code>variables.tf</code> all our variables have default value assigned, which means we should be able to apply this configuration and deploy new tenant.
Let's run <code>terraform apply</code> and verify on APIC that all the objects have been deployed according to the specified variables.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#terraform-vars-__codelineno-4-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform apply
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#terraform-vars-__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#terraform-vars-__codelineno-4-3"></a>&lt;omitted&gt;
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#terraform-vars-__codelineno-4-4"></a>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#terraform-vars-__codelineno-4-5"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#terraform-vars-__codelineno-4-6"></a>  + create
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#terraform-vars-__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#terraform-vars-__codelineno-4-8"></a>Terraform will perform the following actions:
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#terraform-vars-__codelineno-4-9"></a>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#terraform-vars-__codelineno-4-10"></a>  # aci_bridge_domain.bd_192_168_1_0 will be created
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#terraform-vars-__codelineno-4-11"></a>  + resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_1_0&quot; {
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#terraform-vars-__codelineno-4-12"></a>      + annotation                  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#terraform-vars-__codelineno-4-13"></a>      + arp_flood                   = &quot;yes&quot;
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#terraform-vars-__codelineno-4-14"></a>      + bridge_domain_type          = (known after apply)
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#terraform-vars-__codelineno-4-15"></a>      + description                 = (known after apply)
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#terraform-vars-__codelineno-4-16"></a>      + ep_clear                    = (known after apply)
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#terraform-vars-__codelineno-4-17"></a>      + ep_move_detect_mode         = (known after apply)
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#terraform-vars-__codelineno-4-18"></a>      + host_based_routing          = (known after apply)
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#terraform-vars-__codelineno-4-19"></a>      + id                          = (known after apply)
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#terraform-vars-__codelineno-4-20"></a>      + intersite_bum_traffic_allow = (known after apply)
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#terraform-vars-__codelineno-4-21"></a>      + intersite_l2_stretch        = (known after apply)
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#terraform-vars-__codelineno-4-22"></a>      + ip_learning                 = (known after apply)
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#terraform-vars-__codelineno-4-23"></a>      + ipv6_mcast_allow            = (known after apply)
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#terraform-vars-__codelineno-4-24"></a>      + limit_ip_learn_to_subnets   = (known after apply)
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#terraform-vars-__codelineno-4-25"></a>      + ll_addr                     = (known after apply)
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#terraform-vars-__codelineno-4-26"></a>      + mac                         = (known after apply)
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#terraform-vars-__codelineno-4-27"></a>      + mcast_allow                 = (known after apply)
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#terraform-vars-__codelineno-4-28"></a>      + multi_dst_pkt_act           = (known after apply)
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#terraform-vars-__codelineno-4-29"></a>      + name                        = &quot;bd2-1&quot;
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#terraform-vars-__codelineno-4-30"></a>      + name_alias                  = (known after apply)
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#terraform-vars-__codelineno-4-31"></a>      + optimize_wan_bandwidth      = (known after apply)
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#terraform-vars-__codelineno-4-32"></a>      + relation_fv_rs_bd_to_ep_ret = (known after apply)
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#terraform-vars-__codelineno-4-33"></a>      + relation_fv_rs_bd_to_nd_p   = (known after apply)
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#terraform-vars-__codelineno-4-34"></a>      + relation_fv_rs_ctx          = (known after apply)
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#terraform-vars-__codelineno-4-35"></a>      + relation_fv_rs_igmpsn       = (known after apply)
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#terraform-vars-__codelineno-4-36"></a>      + relation_fv_rs_mldsn        = (known after apply)
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#terraform-vars-__codelineno-4-37"></a>      + tenant_dn                   = (known after apply)
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#terraform-vars-__codelineno-4-38"></a>      + unicast_route               = &quot;yes&quot;
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#terraform-vars-__codelineno-4-39"></a>      + unk_mac_ucast_act           = &quot;proxy&quot;
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#terraform-vars-__codelineno-4-40"></a>      + unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#terraform-vars-__codelineno-4-41"></a>      + v6unk_mcast_act             = (known after apply)
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#terraform-vars-__codelineno-4-42"></a>      + vmac                        = (known after apply)
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#terraform-vars-__codelineno-4-43"></a>    }
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#terraform-vars-__codelineno-4-44"></a>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#terraform-vars-__codelineno-4-45"></a>  # aci_tenant.dcloud-tenant-2 will be created
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#terraform-vars-__codelineno-4-46"></a>  + resource &quot;aci_tenant&quot; &quot;dcloud-tenant-2&quot; {
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#terraform-vars-__codelineno-4-47"></a>      + annotation                    = &quot;orchestrator:terraform&quot;
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#terraform-vars-__codelineno-4-48"></a>      + description                   = &quot;This is a new tenant created from Terraform&quot;
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#terraform-vars-__codelineno-4-49"></a>      + id                            = (known after apply)
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#terraform-vars-__codelineno-4-50"></a>      + name                          = &quot;dcloud-tenant-2&quot;
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#terraform-vars-__codelineno-4-51"></a>      + name_alias                    = (known after apply)
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#terraform-vars-__codelineno-4-52"></a>      + relation_fv_rs_tenant_mon_pol = (known after apply)
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#terraform-vars-__codelineno-4-53"></a>    }
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#terraform-vars-__codelineno-4-54"></a>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#terraform-vars-__codelineno-4-55"></a>  # aci_vrf.vrf2-1 will be created
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#terraform-vars-__codelineno-4-56"></a>  + resource &quot;aci_vrf&quot; &quot;vrf2-1&quot; {
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#terraform-vars-__codelineno-4-57"></a>      + annotation                              = &quot;orchestrator:terraform&quot;
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#terraform-vars-__codelineno-4-58"></a>      + bd_enforced_enable                      = (known after apply)
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#terraform-vars-__codelineno-4-59"></a>      + description                             = (known after apply)
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#terraform-vars-__codelineno-4-60"></a>      + id                                      = (known after apply)
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#terraform-vars-__codelineno-4-61"></a>      + ip_data_plane_learning                  = (known after apply)
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#terraform-vars-__codelineno-4-62"></a>      + knw_mcast_act                           = (known after apply)
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#terraform-vars-__codelineno-4-63"></a>      + name                                    = &quot;vrf2-1&quot;
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#terraform-vars-__codelineno-4-64"></a>      + name_alias                              = (known after apply)
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#terraform-vars-__codelineno-4-65"></a>      + pc_enf_dir                              = (known after apply)
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#terraform-vars-__codelineno-4-66"></a>      + pc_enf_pref                             = (known after apply)
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#terraform-vars-__codelineno-4-67"></a>      + relation_fv_rs_bgp_ctx_pol              = (known after apply)
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#terraform-vars-__codelineno-4-68"></a>      + relation_fv_rs_ctx_to_ep_ret            = (known after apply)
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#terraform-vars-__codelineno-4-69"></a>      + relation_fv_rs_ctx_to_ext_route_tag_pol = (known after apply)
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#terraform-vars-__codelineno-4-70"></a>      + relation_fv_rs_ospf_ctx_pol             = (known after apply)
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#terraform-vars-__codelineno-4-71"></a>      + relation_fv_rs_vrf_validation_pol       = (known after apply)
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#terraform-vars-__codelineno-4-72"></a>      + tenant_dn                               = (known after apply)
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#terraform-vars-__codelineno-4-73"></a>    }
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#terraform-vars-__codelineno-4-74"></a>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#terraform-vars-__codelineno-4-75"></a>Plan: 3 to add, 0 to change, 0 to destroy.
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#terraform-vars-__codelineno-4-76"></a>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#terraform-vars-__codelineno-4-77"></a>Do you want to perform these actions?
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#terraform-vars-__codelineno-4-78"></a>  Terraform will perform the actions described above.
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#terraform-vars-__codelineno-4-79"></a>  Only &#39;yes&#39; will be accepted to approve.
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#terraform-vars-__codelineno-4-80"></a>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#terraform-vars-__codelineno-4-81"></a>  Enter a value: yes
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#terraform-vars-__codelineno-4-82"></a>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#terraform-vars-__codelineno-4-83"></a>aci_tenant.dcloud-tenant-2: Creating...
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#terraform-vars-__codelineno-4-84"></a>aci_tenant.dcloud-tenant-2: Creation complete after 1s [id=uni/tn-dcloud-tenant-2]
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#terraform-vars-__codelineno-4-85"></a>aci_vrf.vrf2-1: Creating...
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#terraform-vars-__codelineno-4-86"></a>aci_vrf.vrf2-1: Creation complete after 1s [id=uni/tn-dcloud-tenant-2/ctx-vrf2-1]
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#terraform-vars-__codelineno-4-87"></a>aci_bridge_domain.bd_192_168_1_0: Creating...
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#terraform-vars-__codelineno-4-88"></a>aci_bridge_domain.bd_192_168_1_0: Creation complete after 2s [id=uni/tn-dcloud-tenant-2/BD-bd2-1]
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#terraform-vars-__codelineno-4-89"></a>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#terraform-vars-__codelineno-4-90"></a>Apply complete! Resources: 3 added, 0 changed, 0 destroyed.
</code></pre></div>
<h3 id="terraform-vars-13-provide-variable-value">1.3 Provide variable value</h3>
<h4 id="terraform-vars-131-manual-variable-values">1.3.1 Manual variable values</h4>
<p>Now let's see how else we can provide variable values. In this case first let's modify our <code>variables.tf</code> file and add new variable called <code>bd_name_2</code> which will have no default value and new variable <code>bd_arp_flood_2</code> which will also have no default value.
This way with no default value, Terraform will be forced to ask user to specify it manually during execution:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are not removing default value from existing <code>bd_name</code> or <code>bd_arp_flood</code> variables, as it would force terraform to change it on the existing bridge domain. We are adding new variables to show the difference between them</p>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#terraform-vars-__codelineno-5-1"></a>variable &quot;bd_arp_flood_2&quot; {
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#terraform-vars-__codelineno-5-2"></a>  description = &quot;Specify whether ARP flooding is enabled. If flooding is disabled, unicast routing will be performed on the target IP address.&quot;
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#terraform-vars-__codelineno-5-3"></a>  validation {
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#terraform-vars-__codelineno-5-4"></a>    condition = (var.bd_arp_flood_2 == &quot;yes&quot;) || (var.bd_arp_flood_2 == &quot;no&quot;)
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#terraform-vars-__codelineno-5-5"></a>    error_message = &quot;Allowed values are \&quot;yes\&quot; and \&quot;no\&quot;.&quot;
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#terraform-vars-__codelineno-5-6"></a>  }
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#terraform-vars-__codelineno-5-7"></a>}
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#terraform-vars-__codelineno-5-8"></a>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#terraform-vars-__codelineno-5-9"></a>variable &quot;bd_name_2&quot; {
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#terraform-vars-__codelineno-5-10"></a>}
</code></pre></div>
<p>Let's also add another bridge domain resource where we will verify our manual values. Add following block to the <em>dcloud-tenant-2.tf</em> file. Here we are only giving new name to the resource so that Terraform is aware that this is a new resource to be deployed.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#terraform-vars-__codelineno-6-1"></a>resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_2_0&quot; {
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#terraform-vars-__codelineno-6-2"></a>  tenant_dn                   = aci_tenant.dcloud-tenant-2.id
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#terraform-vars-__codelineno-6-3"></a>  name                        = var.bd_name_2
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#terraform-vars-__codelineno-6-4"></a>  arp_flood                   = var.bd_arp_flood_2
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#terraform-vars-__codelineno-6-5"></a>  unicast_route               = var.bd_unicast_routing
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#terraform-vars-__codelineno-6-6"></a>  unk_mac_ucast_act           = var.bd_unk_ucast
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#terraform-vars-__codelineno-6-7"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#terraform-vars-__codelineno-6-8"></a>  relation_fv_rs_ctx          = aci_vrf.vrf2-1.id
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#terraform-vars-__codelineno-6-9"></a>}
</code></pre></div>
<p>Now if we run <code>terraform plan</code> we will be asked to specify both values that don't have a default value in the variables file. Let's specify them, but at the same time test if our validation rule works. Please specify <em>bd2</em> as <code>bd_name_2</code> and <em>enable</em> as <code>bd_arp_flood_2</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#terraform-vars-__codelineno-7-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform plan
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#terraform-vars-__codelineno-7-2"></a>var.bd_arp_flood_2
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#terraform-vars-__codelineno-7-3"></a>  Specify whether ARP flooding is enabled. If flooding is disabled, unicast routing will be performed on the target IP address.
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#terraform-vars-__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#terraform-vars-__codelineno-7-5"></a>  Enter a value: enable
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#terraform-vars-__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#terraform-vars-__codelineno-7-7"></a>var.bd_name_2
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#terraform-vars-__codelineno-7-8"></a>  Enter a value: bd2
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#terraform-vars-__codelineno-7-9"></a>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#terraform-vars-__codelineno-7-10"></a>&lt;omitted&gt;
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#terraform-vars-__codelineno-7-11"></a>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#terraform-vars-__codelineno-7-12"></a>
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#terraform-vars-__codelineno-7-13"></a>│ Error: Invalid value for variable
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#terraform-vars-__codelineno-7-14"></a>│
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#terraform-vars-__codelineno-7-15"></a>│   on variables.tf line 31:
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#terraform-vars-__codelineno-7-16"></a>│   31: variable &quot;bd_arp_flood_2&quot; {
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#terraform-vars-__codelineno-7-17"></a>│     ├────────────────
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#terraform-vars-__codelineno-7-18"></a>│     │ var.bd_arp_flood_2 is &quot;enable&quot;
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#terraform-vars-__codelineno-7-19"></a>│
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#terraform-vars-__codelineno-7-20"></a>│ Allowed values are &quot;yes&quot; and &quot;no&quot;.
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#terraform-vars-__codelineno-7-21"></a>│
<a id="__codelineno-7-22" name="__codelineno-7-22" href="#terraform-vars-__codelineno-7-22"></a>│ This was checked by the validation rule at variables.tf:33,3-13.
<a id="__codelineno-7-23" name="__codelineno-7-23" href="#terraform-vars-__codelineno-7-23"></a>╵
</code></pre></div>
<p>In this case Terraform will stop the plan and report incorrect value provided for <em>bd_arp_flood_2</em></p>
<p>If we then specify <code>yes</code> to <em>bd_arp_flood</em> and <code>bd2</code> for <em>bd_name</em> we will see that the plan generated output showing us what would be deployed in the APIC:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#terraform-vars-__codelineno-8-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform plan
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#terraform-vars-__codelineno-8-2"></a>var.bd_arp_flood_2
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#terraform-vars-__codelineno-8-3"></a>  Specify whether ARP flooding is enabled. If flooding is disabled, unicast routing will be performed on the target IP address.
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#terraform-vars-__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#terraform-vars-__codelineno-8-5"></a>  Enter a value: yes
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#terraform-vars-__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#terraform-vars-__codelineno-8-7"></a>var.bd_name_2
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#terraform-vars-__codelineno-8-8"></a>  Enter a value: bd2
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#terraform-vars-__codelineno-9-1"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#terraform-vars-__codelineno-9-2"></a>  + create
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#terraform-vars-__codelineno-9-3"></a>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#terraform-vars-__codelineno-9-4"></a>Terraform will perform the following actions:
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#terraform-vars-__codelineno-9-5"></a>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#terraform-vars-__codelineno-9-6"></a>  # aci_bridge_domain.bd_192_168_2_0 will be created
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#terraform-vars-__codelineno-9-7"></a>  + resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_2_0&quot; {
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#terraform-vars-__codelineno-9-8"></a>      + annotation                  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#terraform-vars-__codelineno-9-9"></a>      + arp_flood                   = &quot;yes&quot;
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#terraform-vars-__codelineno-9-10"></a>      + bridge_domain_type          = (known after apply)
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#terraform-vars-__codelineno-9-11"></a>      + description                 = (known after apply)
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#terraform-vars-__codelineno-9-12"></a>      + ep_clear                    = (known after apply)
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#terraform-vars-__codelineno-9-13"></a>      + ep_move_detect_mode         = (known after apply)
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#terraform-vars-__codelineno-9-14"></a>      + host_based_routing          = (known after apply)
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#terraform-vars-__codelineno-9-15"></a>      + id                          = (known after apply)
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#terraform-vars-__codelineno-9-16"></a>      + intersite_bum_traffic_allow = (known after apply)
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#terraform-vars-__codelineno-9-17"></a>      + intersite_l2_stretch        = (known after apply)
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#terraform-vars-__codelineno-9-18"></a>      + ip_learning                 = (known after apply)
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#terraform-vars-__codelineno-9-19"></a>      + ipv6_mcast_allow            = (known after apply)
<a id="__codelineno-9-20" name="__codelineno-9-20" href="#terraform-vars-__codelineno-9-20"></a>      + limit_ip_learn_to_subnets   = (known after apply)
<a id="__codelineno-9-21" name="__codelineno-9-21" href="#terraform-vars-__codelineno-9-21"></a>      + ll_addr                     = (known after apply)
<a id="__codelineno-9-22" name="__codelineno-9-22" href="#terraform-vars-__codelineno-9-22"></a>      + mac                         = (known after apply)
<a id="__codelineno-9-23" name="__codelineno-9-23" href="#terraform-vars-__codelineno-9-23"></a>      + mcast_allow                 = (known after apply)
<a id="__codelineno-9-24" name="__codelineno-9-24" href="#terraform-vars-__codelineno-9-24"></a>      + multi_dst_pkt_act           = (known after apply)
<a id="__codelineno-9-25" name="__codelineno-9-25" href="#terraform-vars-__codelineno-9-25"></a>      + name                        = &quot;bd2&quot;
<a id="__codelineno-9-26" name="__codelineno-9-26" href="#terraform-vars-__codelineno-9-26"></a>      + name_alias                  = (known after apply)
<a id="__codelineno-9-27" name="__codelineno-9-27" href="#terraform-vars-__codelineno-9-27"></a>      + optimize_wan_bandwidth      = (known after apply)
<a id="__codelineno-9-28" name="__codelineno-9-28" href="#terraform-vars-__codelineno-9-28"></a>      + relation_fv_rs_bd_to_ep_ret = (known after apply)
<a id="__codelineno-9-29" name="__codelineno-9-29" href="#terraform-vars-__codelineno-9-29"></a>      + relation_fv_rs_bd_to_nd_p   = (known after apply)
<a id="__codelineno-9-30" name="__codelineno-9-30" href="#terraform-vars-__codelineno-9-30"></a>      + relation_fv_rs_ctx          = &quot;uni/tn-dcloud-tenant-2/ctx-vrf2-1&quot;
<a id="__codelineno-9-31" name="__codelineno-9-31" href="#terraform-vars-__codelineno-9-31"></a>      + relation_fv_rs_igmpsn       = (known after apply)
<a id="__codelineno-9-32" name="__codelineno-9-32" href="#terraform-vars-__codelineno-9-32"></a>      + relation_fv_rs_mldsn        = (known after apply)
<a id="__codelineno-9-33" name="__codelineno-9-33" href="#terraform-vars-__codelineno-9-33"></a>      + tenant_dn                   = &quot;uni/tn-dcloud-tenant-2&quot;
<a id="__codelineno-9-34" name="__codelineno-9-34" href="#terraform-vars-__codelineno-9-34"></a>      + unicast_route               = &quot;yes&quot;
<a id="__codelineno-9-35" name="__codelineno-9-35" href="#terraform-vars-__codelineno-9-35"></a>      + unk_mac_ucast_act           = &quot;proxy&quot;
<a id="__codelineno-9-36" name="__codelineno-9-36" href="#terraform-vars-__codelineno-9-36"></a>      + unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-9-37" name="__codelineno-9-37" href="#terraform-vars-__codelineno-9-37"></a>      + v6unk_mcast_act             = (known after apply)
<a id="__codelineno-9-38" name="__codelineno-9-38" href="#terraform-vars-__codelineno-9-38"></a>      + vmac                        = (known after apply)
<a id="__codelineno-9-39" name="__codelineno-9-39" href="#terraform-vars-__codelineno-9-39"></a>    }
<a id="__codelineno-9-40" name="__codelineno-9-40" href="#terraform-vars-__codelineno-9-40"></a>
<a id="__codelineno-9-41" name="__codelineno-9-41" href="#terraform-vars-__codelineno-9-41"></a>Plan: 1 to add, 0 to change, 0 to destroy.
</code></pre></div>
<p>Let's run <code>terraform apply</code> to see that this bridge domain would be deployed.</p>
<h4 id="terraform-vars-132-the-tfvars-file">1.3.2. The .tfvars file</h4>
<p>Manual method of providing values for our variables can be quite absorbing and prone to humar errors. Another, preferred way would be to include all our variable values into separate file called *.tfvars. Please create new file calle <code>terraform.tfvars</code>. Variable values in such file can be defined in a simple way:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#terraform-vars-__codelineno-10-1"></a>tenant_name = &quot;dcloud-tenant-2&quot;
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#terraform-vars-__codelineno-10-2"></a>vrf_name = &quot;vrf2-1&quot;
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#terraform-vars-__codelineno-10-3"></a>bd_name_2 = &quot;bd2&quot;
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#terraform-vars-__codelineno-10-4"></a>bd_arp_flood_2 = &quot;no&quot;
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#terraform-vars-__codelineno-10-5"></a>bd_unicast_routing = &quot;no&quot;
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#terraform-vars-__codelineno-10-6"></a>bd_unk_ucast = &quot;proxy&quot;
</code></pre></div>
<p>To each variable name we assign our preferred value. If you take a look closely you will see that for <code>bd_arp_flood_2</code> and <code>bd_unicast_routing</code> we specify different values that we did for our <code>bd2</code> bridge domain. If we run our <code>terraform apply</code> command now, we will see that terraform wants to do changes on our resource:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#terraform-vars-__codelineno-11-1"></a>&lt;omitted&gt;
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#terraform-vars-__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#terraform-vars-__codelineno-11-3"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#terraform-vars-__codelineno-11-4"></a>  ~ update in-place
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#terraform-vars-__codelineno-11-5"></a>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#terraform-vars-__codelineno-11-6"></a>Terraform will perform the following actions:
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#terraform-vars-__codelineno-11-7"></a>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#terraform-vars-__codelineno-11-8"></a>  # aci_bridge_domain.bd_192_168_1_0 will be updated in-place
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#terraform-vars-__codelineno-11-9"></a>  ~ resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_1_0&quot; {
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#terraform-vars-__codelineno-11-10"></a>        id                          = &quot;uni/tn-dcloud-tenant-2/BD-bd2-1&quot;
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#terraform-vars-__codelineno-11-11"></a>        name                        = &quot;bd2-1&quot;
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#terraform-vars-__codelineno-11-12"></a>      ~ unicast_route               = &quot;yes&quot; -&gt; &quot;no&quot;
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#terraform-vars-__codelineno-11-13"></a>        # (22 unchanged attributes hidden)
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#terraform-vars-__codelineno-11-14"></a>    }
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#terraform-vars-__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#terraform-vars-__codelineno-11-16"></a>  # aci_bridge_domain.bd_192_168_2_0 will be updated in-place
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#terraform-vars-__codelineno-11-17"></a>  ~ resource &quot;aci_bridge_domain&quot; &quot;bd_192_168_2_0&quot; {
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#terraform-vars-__codelineno-11-18"></a>      ~ arp_flood                   = &quot;yes&quot; -&gt; &quot;no&quot;
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#terraform-vars-__codelineno-11-19"></a>        id                          = &quot;uni/tn-dcloud-tenant-2/BD-bd2&quot;
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#terraform-vars-__codelineno-11-20"></a>        name                        = &quot;bd2&quot;
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#terraform-vars-__codelineno-11-21"></a>      ~ unicast_route               = &quot;yes&quot; -&gt; &quot;no&quot;
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#terraform-vars-__codelineno-11-22"></a>        # (21 unchanged attributes hidden)
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#terraform-vars-__codelineno-11-23"></a>    }
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#terraform-vars-__codelineno-11-24"></a>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#terraform-vars-__codelineno-11-25"></a>Plan: 0 to add, 2 to change, 0 to destroy.
</code></pre></div>
<p>If we execute our command, Terraform will change the configuration on the APIC. Please verify in the GUI that these changes really reflect the configuration.</p>
<h2 id="terraform-vars-2-for_each-loop">2. For_each loop</h2>
<p>This way of specifying variables and creating configuration is good if we want to deploy single object, however in case we have multiple bridge domains to deploy it may not be the most efficient way.
By default a resource block configures one real infrastructure object. However, sometimes you want to manage several similar obejcts (like several bridge domains) without writing separate block for each one. Terraform has two ways to do this:</p>
<ul>
<li>count</li>
<li>for_each</li>
</ul>
<p>The <code>count</code> argument takes a value of a whole number and Terraform will simply create that many instances of an object. This will not help us much with ACI, as every of these objects would have the same configuration. We want to have option to create multiple bridge domains, which may have different config options.</p>
<p>The <code>for_each</code> argument can be included in a resource block, and its value is a map or set of strings. Terraform will create one instance for each member of that map or set. For this exercise we will work with maps that will include our bridge domains configuration.</p>
<p>The map has an index value for each object instance. This index is used by terraform to reference resources and to get values we need from it to create objects.</p>
<p>In our example let's create new folder for our workspace and call it <code>ACI-2</code>. Inside this folder create three files that we will use:</p>
<ul>
<li>main.tf - which will hold our provider configuration and resource that will be deployed (tenant, vrf, bridge domains and subents)</li>
<li>variables.tf - which will have definition of variables we will use, including their types and default values</li>
<li>terraform.tfvars - which we will use to specify our desired values and confiuration of bridge domains</li>
</ul>
<p>Inside <code>variables.tf</code> file paste the following content:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#terraform-vars-__codelineno-12-1"></a>variable &quot;tenant_name&quot; {
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#terraform-vars-__codelineno-12-2"></a>  default = &quot;demo_tn&quot;
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#terraform-vars-__codelineno-12-3"></a>}
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#terraform-vars-__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#terraform-vars-__codelineno-12-5"></a>variable &quot;vrf_name&quot; {
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#terraform-vars-__codelineno-12-6"></a>  default = &quot;vrf1&quot;
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#terraform-vars-__codelineno-12-7"></a>}
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#terraform-vars-__codelineno-12-8"></a>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#terraform-vars-__codelineno-12-9"></a>variable &quot;bridge_domains&quot; {
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#terraform-vars-__codelineno-12-10"></a>  type = map(object({
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#terraform-vars-__codelineno-12-11"></a>    name = string
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#terraform-vars-__codelineno-12-12"></a>    arp_flood = string
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#terraform-vars-__codelineno-12-13"></a>    unicast_routing = string
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#terraform-vars-__codelineno-12-14"></a>    unk_ucast = string
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#terraform-vars-__codelineno-12-15"></a>    subnet = string
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#terraform-vars-__codelineno-12-16"></a>    subnet_scope = list(string)
<a id="__codelineno-12-17" name="__codelineno-12-17" href="#terraform-vars-__codelineno-12-17"></a>  }))
<a id="__codelineno-12-18" name="__codelineno-12-18" href="#terraform-vars-__codelineno-12-18"></a>  default = {
<a id="__codelineno-12-19" name="__codelineno-12-19" href="#terraform-vars-__codelineno-12-19"></a>    default_bd = {
<a id="__codelineno-12-20" name="__codelineno-12-20" href="#terraform-vars-__codelineno-12-20"></a>      name = &quot;default&quot;
<a id="__codelineno-12-21" name="__codelineno-12-21" href="#terraform-vars-__codelineno-12-21"></a>      arp_flood = &quot;yes&quot;
<a id="__codelineno-12-22" name="__codelineno-12-22" href="#terraform-vars-__codelineno-12-22"></a>      unicast_routing = &quot;yes&quot;
<a id="__codelineno-12-23" name="__codelineno-12-23" href="#terraform-vars-__codelineno-12-23"></a>      unk_ucast = &quot;proxy&quot;
<a id="__codelineno-12-24" name="__codelineno-12-24" href="#terraform-vars-__codelineno-12-24"></a>      subnet = &quot;10.10.10.1/24&quot;
<a id="__codelineno-12-25" name="__codelineno-12-25" href="#terraform-vars-__codelineno-12-25"></a>      subnet_scope = [&quot;private&quot;]
<a id="__codelineno-12-26" name="__codelineno-12-26" href="#terraform-vars-__codelineno-12-26"></a>    }
<a id="__codelineno-12-27" name="__codelineno-12-27" href="#terraform-vars-__codelineno-12-27"></a>  }
<a id="__codelineno-12-28" name="__codelineno-12-28" href="#terraform-vars-__codelineno-12-28"></a>}
</code></pre></div>
<p>In this file we can see that we are defining three variables: tenant_name, vrf_name and bridge_domains. The bridge_domains variable is the interesting one, and it has type map of objects. One object will represent single bridge domain and its configuration. As part of this object we have our standard values to configure a BD like name, ARP flooding, unicast routing and unknown unicast flooding behaviour, but also subnet and subnet scope. Inside this variable first we define for those arguments what type they should take (string value for most of them and list of strings for subnet_scope). Then we specify default value that our map would take, in case we don't provide any values ourselves (inside <code>terraform.tfvars</code> file).</p>
<p>Now we want to provide the values we want to use in the <code>terraform.tffvars</code> file, please paste following content:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#terraform-vars-__codelineno-13-1"></a>tenant_name = &quot;dcloud-tenant-3&quot;
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#terraform-vars-__codelineno-13-2"></a>vrf_name = &quot;vrf1&quot;
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#terraform-vars-__codelineno-13-3"></a>bridge_domains = {
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#terraform-vars-__codelineno-13-4"></a>    bd01 = {
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#terraform-vars-__codelineno-13-5"></a>        name = &quot;192.168.1.0_24_bd&quot;
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#terraform-vars-__codelineno-13-6"></a>        arp_flood = &quot;no&quot;
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#terraform-vars-__codelineno-13-7"></a>        unicast_routing = &quot;yes&quot;
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#terraform-vars-__codelineno-13-8"></a>        unk_ucast = &quot;proxy&quot;
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#terraform-vars-__codelineno-13-9"></a>        subnet = &quot;192.168.1.1/24&quot;
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#terraform-vars-__codelineno-13-10"></a>        subnet_scope = [&quot;private&quot;]
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#terraform-vars-__codelineno-13-11"></a>    },
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#terraform-vars-__codelineno-13-12"></a>    bd02 = {
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#terraform-vars-__codelineno-13-13"></a>        name = &quot;192.168.2.0_24_bd&quot;
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#terraform-vars-__codelineno-13-14"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#terraform-vars-__codelineno-13-15"></a>        unicast_routing = &quot;yes&quot;
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#terraform-vars-__codelineno-13-16"></a>        unk_ucast = &quot;proxy&quot;
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#terraform-vars-__codelineno-13-17"></a>        subnet = &quot;192.168.2.1/24&quot;
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#terraform-vars-__codelineno-13-18"></a>        subnet_scope = [&quot;private&quot;,&quot;shared&quot;]
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#terraform-vars-__codelineno-13-19"></a>    }
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#terraform-vars-__codelineno-13-20"></a>}
</code></pre></div>
<p>Inside this file we specify our tenant and vrf name we want to use, and then we specify bridge domains map, which includes two bridge domains:</p>
<ul>
<li>bd01 of name 192.168.1.0_24_bd</li>
<li>bd02 of name 192.168.2.0_24_bd</li>
</ul>
<p>That means our map has two objects. Each object is a key and value pair, where:</p>
<ul>
<li>first object key is <code>bd01</code> and value is all the arguments we specify for it, including name, arp_flood, subnet etc</li>
<li>second object key is <code>bd02</code> and value is all the arguments we specify for it, including name, arp_flood, subnet etc</li>
</ul>
<p>You can see that our bridge domains differ in configuration of parameters. We have different names, arp flooding and subnet with scope.</p>
<p>Now, since we are doing this demo in separate folder <code>ACI-2</code>, we will have to initialize Terraform again and treat it as a separate deployment. For this reason inside the <code>main.tf</code> file we have to paste first our ACI provider configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#terraform-vars-__codelineno-14-1"></a>terraform {
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#terraform-vars-__codelineno-14-2"></a>  required_providers {
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#terraform-vars-__codelineno-14-3"></a>    aci = {
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#terraform-vars-__codelineno-14-4"></a>      source = &quot;CiscoDevNet/aci&quot;
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#terraform-vars-__codelineno-14-5"></a>      version = &quot;2.5.2&quot;
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#terraform-vars-__codelineno-14-6"></a>    }
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#terraform-vars-__codelineno-14-7"></a>  }
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#terraform-vars-__codelineno-14-8"></a>}
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#terraform-vars-__codelineno-14-9"></a>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#terraform-vars-__codelineno-14-10"></a>provider &quot;aci&quot; {
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#terraform-vars-__codelineno-14-11"></a>  # Cisco ACI user name
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#terraform-vars-__codelineno-14-12"></a>  username    = &quot;admin&quot;
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#terraform-vars-__codelineno-14-13"></a>  password    = &quot;C1sco12345&quot;
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#terraform-vars-__codelineno-14-14"></a>  url         = &quot;https://198.18.133.200&quot;
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#terraform-vars-__codelineno-14-15"></a>  insecure    = true
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#terraform-vars-__codelineno-14-16"></a>}
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please remmeber in the terminal to change path to the right folder with <code>cd</code> command.</p>
</div>
<p>Below that we will start describing our resources. We want to create four resources: tenant, vrf, bridge domain and subnet.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#terraform-vars-__codelineno-15-1"></a>resource &quot;aci_tenant&quot; &quot;dcloud-tenant-3&quot; {
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#terraform-vars-__codelineno-15-2"></a>  name        = &quot;${var.tenant_name}&quot;
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#terraform-vars-__codelineno-15-3"></a>  description = &quot;This is a demo tenant created from Terraform&quot;
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#terraform-vars-__codelineno-15-4"></a>}
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#terraform-vars-__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#terraform-vars-__codelineno-15-6"></a>resource &quot;aci_vrf&quot; &quot;main&quot; {
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#terraform-vars-__codelineno-15-7"></a>  tenant_dn              = aci_tenant.dcloud-tenant-3.id
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#terraform-vars-__codelineno-15-8"></a>  name                   = var.vrf_name
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#terraform-vars-__codelineno-15-9"></a>}
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#terraform-vars-__codelineno-15-10"></a>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#terraform-vars-__codelineno-15-11"></a>resource &quot;aci_bridge_domain&quot; &quot;bd&quot; {
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#terraform-vars-__codelineno-15-12"></a>  for_each = var.bridge_domains
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#terraform-vars-__codelineno-15-13"></a>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#terraform-vars-__codelineno-15-14"></a>  tenant_dn                   = aci_tenant.dcloud-tenant-3.id
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#terraform-vars-__codelineno-15-15"></a>  name                        = each.value.name
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#terraform-vars-__codelineno-15-16"></a>  arp_flood                   = each.value.arp_flood
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#terraform-vars-__codelineno-15-17"></a>  unicast_route               = each.value.unicast_routing
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#terraform-vars-__codelineno-15-18"></a>  unk_mac_ucast_act           = each.value.unk_ucast
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#terraform-vars-__codelineno-15-19"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#terraform-vars-__codelineno-15-20"></a>  relation_fv_rs_ctx          = aci_vrf.main.id
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#terraform-vars-__codelineno-15-21"></a>}
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#terraform-vars-__codelineno-15-22"></a>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#terraform-vars-__codelineno-15-23"></a>resource &quot;aci_subnet&quot; &quot;subnets&quot; {
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#terraform-vars-__codelineno-15-24"></a>    for_each             = var.bridge_domains
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#terraform-vars-__codelineno-15-25"></a>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#terraform-vars-__codelineno-15-26"></a>    parent_dn            = aci_bridge_domain.bd[each.key].id
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#terraform-vars-__codelineno-15-27"></a>    ip                   = each.value.subnet
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#terraform-vars-__codelineno-15-28"></a>    scope                = each.value.subnet_scope
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#terraform-vars-__codelineno-15-29"></a>}
</code></pre></div>
<p>The tenant and VRF resources are configured in a similar way as in previous demo, so they don't need description. They use standard references to variables we provided in the file.
The interesting part is with the bridge_domain and subnet. In here we can see that each of these resources start with a special line</p>
<div class="highlight"><pre><span></span><code>for_each = var.bridge_domains
</code></pre></div>
<p>This indicates that we want to create this resource once for every object in our variable called <code>bridge_domains</code>. In our <code>terraform.tfvars</code> we declared this variable to include two different bridge_domains, so we expect that this resource will be created twice. Each resource will be unique by the map key.
In resource blocks where <code>for_each</code> is set, an additional <code>each</code> object is available in expressions, so you can modify the configuration of each instance. This object has two attributes:</p>
<ul>
<li><code>each.key</code> - the map key corresponding to this instance</li>
<li><code>each.value</code> - the map value corresponding to this instance.</li>
</ul>
<p>In our resource block for bridge domain and subnet we can see that we are referring to arguments with <code>each.value.&lt;argumnet&gt;</code> or <code>each.key</code>, as an example:</p>
<div class="highlight"><pre><span></span><code>name = each.value.name
</code></pre></div>
<p>We can also see that for the relation that needs to happen between bd and subnet we specify parent_dn with following expression using <code>each.key</code>:</p>
<div class="highlight"><pre><span></span><code>parent_dn = aci_bridge_domain.bd[each.key].id
</code></pre></div>
<p>If we now run <code>terraform plan</code> and <code>apply</code> we will see that two bridge domains have been created according to our settings.</p>
<p>Let's expand our tenant configuration by adding several EPGs, which we will create in the same way using <code>for_each</code> expression.
First we need to define new variable corresponding to an EPG, it will take values of <em>name</em> and <em>bridge domain</em>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#terraform-vars-__codelineno-16-1"></a>variable &quot;end_point_groups&quot; {
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#terraform-vars-__codelineno-16-2"></a>  type = map(object({
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#terraform-vars-__codelineno-16-3"></a>    name = string
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#terraform-vars-__codelineno-16-4"></a>    bd = string
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#terraform-vars-__codelineno-16-5"></a>  }))
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#terraform-vars-__codelineno-16-6"></a>}
</code></pre></div>
<p>Next we specify desired configuration of our EPGs in <code>terraform.tfvars</code> file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#terraform-vars-__codelineno-17-1"></a>end_point_groups = {
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#terraform-vars-__codelineno-17-2"></a>    epg1 = {
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#terraform-vars-__codelineno-17-3"></a>        name = &quot;epg1&quot;,
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#terraform-vars-__codelineno-17-4"></a>        bd   = &quot;bd01&quot;
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#terraform-vars-__codelineno-17-5"></a>    },
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#terraform-vars-__codelineno-17-6"></a>    epg2 = {
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#terraform-vars-__codelineno-17-7"></a>        name = &quot;epg2&quot;,
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#terraform-vars-__codelineno-17-8"></a>        bd   = &quot;bd02&quot;
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#terraform-vars-__codelineno-17-9"></a>    }
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#terraform-vars-__codelineno-17-10"></a>}
</code></pre></div>
<p>Finally we add resource configuration in <code>main.tf</code> file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#terraform-vars-__codelineno-18-1"></a>resource &quot;aci_application_profile&quot; &quot;ap1&quot; {
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#terraform-vars-__codelineno-18-2"></a>  tenant_dn  = aci_tenant.dcloud-tenant-3.id
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#terraform-vars-__codelineno-18-3"></a>  name       = &quot;ap1&quot;
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#terraform-vars-__codelineno-18-4"></a>}
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#terraform-vars-__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#terraform-vars-__codelineno-18-6"></a>resource &quot;aci_application_epg&quot; &quot;epg&quot; {
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#terraform-vars-__codelineno-18-7"></a>    for_each                = var.end_point_groups
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#terraform-vars-__codelineno-18-8"></a>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#terraform-vars-__codelineno-18-9"></a>    application_profile_dn  = aci_application_profile.ap1.id
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#terraform-vars-__codelineno-18-10"></a>    name                    = each.value.name
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#terraform-vars-__codelineno-18-11"></a>    relation_fv_rs_bd       = aci_bridge_domain.bd[each.value.bd].id
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#terraform-vars-__codelineno-18-12"></a>}
</code></pre></div>
<p>You can see that endpoint groups also use the <code>for_each</code> function and create relation to a bridge domain that we specified.
If you run <code>apply</code> now you will see additional AP and 2xEPG created. You can try adding new EPGs to the <code>terraform.tfvars</code> map of endpoint groups, to see that now it is easier to add new EPGs.</p>
<h2 id="terraform-vars-3-conditionals-and-for-expression">3. Conditionals and for expression</h2>
<p>A conditional expression uses the value of a boolean expression to select one of two values.
The condition can be any expression that resolves to a boolean value. This will usually be an expression that uses the equality, comparison, or logical operators.</p>
<p>In our case we will use it to configure several parameters only <em>under condition</em> that other parameters are configured to a sprecific value. As an example let's take bridge domain configuration. On a high level there are two types of bridge domains we configure in ACI: L2 and L3. For L3 bridge domain we need to set unicast routing option to true, flooding arguments need to be adjusted, and subnet IP should be configured. For L2 bridge domains those parameters are not needed and BD should work in a flooding mode with no IP address.
To specify that kind of configuration we can use conditionals in Terraform resource block.</p>
<p>Please create new folder <code>ACI-3</code> that we will use for this test, and under this folder three files:</p>
<ul>
<li><code>main.tf</code> and paste the ACI provider configuration</li>
<li><code>variables.tf</code> which we will use to define variables type</li>
<li><code>terraform.tfvars</code> which we will use to specify our desired configuration</li>
</ul>
<p>Our <code>variables.tf</code> file will include following variabels:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#terraform-vars-__codelineno-19-1"></a>variable &quot;tenant_name&quot; {
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#terraform-vars-__codelineno-19-2"></a>  default = &quot;dcloud-tenant-4&quot;
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#terraform-vars-__codelineno-19-3"></a>}
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#terraform-vars-__codelineno-19-4"></a>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#terraform-vars-__codelineno-19-5"></a>variable &quot;vrf_name&quot; {
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#terraform-vars-__codelineno-19-6"></a>  default = &quot;vrf1&quot;
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#terraform-vars-__codelineno-19-7"></a>}
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#terraform-vars-__codelineno-19-8"></a>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#terraform-vars-__codelineno-19-9"></a>variable &quot;bridge_domains&quot; {
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#terraform-vars-__codelineno-19-10"></a>  type = map(object({
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#terraform-vars-__codelineno-19-11"></a>    name = string
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#terraform-vars-__codelineno-19-12"></a>    arp_flood = string
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#terraform-vars-__codelineno-19-13"></a>    type = string
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#terraform-vars-__codelineno-19-14"></a>    gateway = string
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#terraform-vars-__codelineno-19-15"></a>    scope = list(string)
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#terraform-vars-__codelineno-19-16"></a>  }))
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#terraform-vars-__codelineno-19-17"></a>  default = {
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#terraform-vars-__codelineno-19-18"></a>    default_bd = {
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#terraform-vars-__codelineno-19-19"></a>      name = &quot;default&quot;
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#terraform-vars-__codelineno-19-20"></a>      arp_flood = &quot;yes&quot;
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#terraform-vars-__codelineno-19-21"></a>      type = &quot;L3&quot;
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#terraform-vars-__codelineno-19-22"></a>      gateway = &quot;192.168.1.1/24&quot;
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#terraform-vars-__codelineno-19-23"></a>      scope = [&quot;private&quot;]
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#terraform-vars-__codelineno-19-24"></a>    }
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#terraform-vars-__codelineno-19-25"></a>  }
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#terraform-vars-__codelineno-19-26"></a>}
</code></pre></div>
<p>In this example our bridge domains are configured with type (L2 or L3), name, ARP flooding mechanism, gateway (IP address) and its scope. We no longer define unicast routing and unknown unicast flooding mechanism. We want to set them based on the type of bridge domain we specify.</p>
<p>Our <code>terraform.tfvar</code> file will have our desired config of bridge domains:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#terraform-vars-__codelineno-20-1"></a>bridge_domains = {
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#terraform-vars-__codelineno-20-2"></a>    bd01 = {
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#terraform-vars-__codelineno-20-3"></a>        name = &quot;192.168.1.0_24_bd&quot;
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#terraform-vars-__codelineno-20-4"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#terraform-vars-__codelineno-20-5"></a>        type = &quot;L3&quot;
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#terraform-vars-__codelineno-20-6"></a>        gateway = &quot;192.168.1.1/24&quot;
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#terraform-vars-__codelineno-20-7"></a>        scope = [&quot;private&quot;]
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#terraform-vars-__codelineno-20-8"></a>    },
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#terraform-vars-__codelineno-20-9"></a>    bd02 = {
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#terraform-vars-__codelineno-20-10"></a>        name = &quot;192.168.2.0_24_bd&quot;
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#terraform-vars-__codelineno-20-11"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#terraform-vars-__codelineno-20-12"></a>        type = &quot;L2&quot;
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#terraform-vars-__codelineno-20-13"></a>        gateway = null
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#terraform-vars-__codelineno-20-14"></a>        scope = null
<a id="__codelineno-20-15" name="__codelineno-20-15" href="#terraform-vars-__codelineno-20-15"></a>    }
<a id="__codelineno-20-16" name="__codelineno-20-16" href="#terraform-vars-__codelineno-20-16"></a>}
</code></pre></div>
<p>One of the bridge domains is L3 and has IP address, while the second one is L2 and has no IP address.
Inside <code>main.tf</code> we specify our resources configuration:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#terraform-vars-__codelineno-21-1"></a>resource &quot;aci_tenant&quot; &quot;tenant&quot; {
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#terraform-vars-__codelineno-21-2"></a>  name        = &quot;${var.tenant_name}&quot;
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#terraform-vars-__codelineno-21-3"></a>}
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#terraform-vars-__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#terraform-vars-__codelineno-21-5"></a>resource &quot;aci_vrf&quot; &quot;vrf&quot; {
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#terraform-vars-__codelineno-21-6"></a>  tenant_dn              = aci_tenant.tenant.id
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#terraform-vars-__codelineno-21-7"></a>  name                   = var.vrf_name
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#terraform-vars-__codelineno-21-8"></a>}
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#terraform-vars-__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#terraform-vars-__codelineno-21-10"></a>resource &quot;aci_bridge_domain&quot; &quot;bd&quot; {
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#terraform-vars-__codelineno-21-11"></a>  for_each = var.bridge_domains
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#terraform-vars-__codelineno-21-12"></a>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#terraform-vars-__codelineno-21-13"></a>  tenant_dn                   = aci_tenant.tenant.id
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#terraform-vars-__codelineno-21-14"></a>  name                        = each.value.name
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#terraform-vars-__codelineno-21-15"></a>  arp_flood                   = each.value.arp_flood
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#terraform-vars-__codelineno-21-16"></a>  unicast_route               = each.value.type == &quot;L3&quot; ? &quot;yes&quot; : &quot;no&quot;
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#terraform-vars-__codelineno-21-17"></a>  unk_mac_ucast_act           = each.value.type == &quot;L3&quot; ? &quot;proxy&quot; : &quot;flood&quot;
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#terraform-vars-__codelineno-21-18"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#terraform-vars-__codelineno-21-19"></a>  relation_fv_rs_ctx          = aci_vrf.vrf.id
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#terraform-vars-__codelineno-21-20"></a>}
</code></pre></div>
<p>We are again using <code>for_each</code> loop to create multiple resources for our bridge domains and we assign values like tenant_dn, name, VRF and ARP_flooding in the same way as before, by refering the <code>each.value.&lt;argument name&gt;</code>.
The difference is with assigning values for unicast routing and unknown unicast flooding mechanism. For these values we use conditional expression:</p>
<div class="highlight"><pre><span></span><code>unicast_route               = each.value.type == &quot;L3&quot; ? &quot;yes&quot; : &quot;no&quot;
</code></pre></div>
<p>This expression takes <code>each.value.type</code> of our object and verifies if the content of this type is <code>"L3"</code>. "?" symbol specified that we are checking this condition:</p>
<ul>
<li>if condition is <code>true</code> the result is that <code>unicast_route</code> argument will be assigned <code>"yes"</code> value</li>
<li>if condition is <code>false</code> the result is that <code>unicast_route</code> argument will be assigned <code>"no"</code> value</li>
</ul>
<p>In the same way we can read the second line for unknown unicast flooding verifying condition that <code>each.value.type</code> is <code>"L3"</code>:</p>
<ul>
<li>if condition is <code>true</code> the result is that <code>unk_mac_ucast_act</code> argument will be assigned <code>"proxy"</code> value</li>
<li>if condition is <code>false</code> the result is that <code>unk_mac_ucast_act</code> argument will be assigned <code>"flood"</code> value</li>
</ul>
<p>If we run our <code>terraform init</code>, <code>plan</code> and <code>apply</code> commands now, you will get two bridge domains configured with different settings based on the conditional expression. You can verify configuration in the APIC GUI.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember to change to the correct folder in the Terminal</p>
</div>
<p>Second thing we want to do is to create subnet resource, that will reflect our bridge domain IP address, but we want to do it only for L3 bridge domains. L2 BD doesn't require subnet to be configured and shouldn't have it at all. There would be no reason to deploy subnet resource for L2 bridge domain.
If we simply use the <code>for_each</code> expression, we would deploy subnet for all bridge domains we specify in our map, but we want to verify a condition expression here too. This can be done with a <code>for</code> expression.</p>
<p>A <code>for</code> expression creates a complex type value by transforming another complex type value. Each element in the input value can correspond to either one or zero values in the result, and an arbitrary expression can be used to transform each input element into an output element.
We want to use the <code>for</code> expression to modify our <code>for_each</code> block:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#terraform-vars-__codelineno-22-1"></a>resource &quot;aci_subnet&quot; &quot;net&quot; {
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#terraform-vars-__codelineno-22-2"></a>  for_each = { for k, v in var.bridge_domains: k =&gt; v if v.type == &quot;L3&quot; }
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#terraform-vars-__codelineno-22-3"></a>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#terraform-vars-__codelineno-22-4"></a>  parent_dn        = aci_bridge_domain.bd[each.key].id
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#terraform-vars-__codelineno-22-5"></a>  ip               = each.value.gateway
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#terraform-vars-__codelineno-22-6"></a>  scope            = each.value.scope
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#terraform-vars-__codelineno-22-7"></a>}
</code></pre></div>
<p>In this example we added the expression to the <code>for_each</code> block. This <code>for</code> loop is supposed to go iterate over every <code>k</code> (key) and <code>v</code> (value) pair in our map called <code>var.bridge_domains</code> and return those key and value pair only if the condition that "type" is set to "L3" is true. In reality <code>for</code> expression is returning (creating) new map variable that will consist only of key and value pairs of elements that pass our condition.
If we wanted to take a look at those values, we would have our bridge_domains map that we declared:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#terraform-vars-__codelineno-23-1"></a>bridge_domains = {
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#terraform-vars-__codelineno-23-2"></a>    bd01 = {
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#terraform-vars-__codelineno-23-3"></a>        name = &quot;192.168.1.0_24_bd&quot;
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#terraform-vars-__codelineno-23-4"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#terraform-vars-__codelineno-23-5"></a>        type = &quot;L3&quot;
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#terraform-vars-__codelineno-23-6"></a>        gateway = &quot;192.168.1.1/24&quot;
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#terraform-vars-__codelineno-23-7"></a>        scope = [&quot;private&quot;]
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#terraform-vars-__codelineno-23-8"></a>    },
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#terraform-vars-__codelineno-23-9"></a>    bd02 = {
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#terraform-vars-__codelineno-23-10"></a>        name = &quot;192.168.2.0_24_bd&quot;
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#terraform-vars-__codelineno-23-11"></a>        arp_flood = &quot;yes&quot;
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#terraform-vars-__codelineno-23-12"></a>        type = &quot;L2&quot;
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#terraform-vars-__codelineno-23-13"></a>        gateway = null
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#terraform-vars-__codelineno-23-14"></a>        scope = null
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#terraform-vars-__codelineno-23-15"></a>    }
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#terraform-vars-__codelineno-23-16"></a>}
</code></pre></div>
<p>The new map variable created by <code>for</code> expression inside resource block would look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#terraform-vars-__codelineno-24-1"></a>{
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#terraform-vars-__codelineno-24-2"></a>  bd01 = {
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#terraform-vars-__codelineno-24-3"></a>      name = &quot;192.168.1.0_24_bd&quot;
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#terraform-vars-__codelineno-24-4"></a>      arp_flood = &quot;yes&quot;
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#terraform-vars-__codelineno-24-5"></a>      type = &quot;L3&quot;
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#terraform-vars-__codelineno-24-6"></a>      gateway = &quot;192.168.1.1/24&quot;
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#terraform-vars-__codelineno-24-7"></a>      scope = [&quot;private&quot;]
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#terraform-vars-__codelineno-24-8"></a>  }
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#terraform-vars-__codelineno-24-9"></a>}
</code></pre></div>
<p>The second bd02 is not included in this temporary variable as it does not meet the condition.</p>
<p>The <code>for_each</code> loop can now loop over this map, which only contains one object (one key, value pair) and inside the resource we refer to this object in the same way as we would normally use, with <code>eack.key</code> and <code>each.value</code> arguments:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#terraform-vars-__codelineno-25-1"></a>parent_dn        = aci_bridge_domain.bd[each.key].id
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#terraform-vars-__codelineno-25-2"></a>ip               = each.value.gateway
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#terraform-vars-__codelineno-25-3"></a>scope            = each.value.scope
</code></pre></div>
<p>If you run <code>terraform plan</code> and <code>apply</code> now, you will see that only one <code>aci_subnet</code> resource is being created for "bd01".</p>
<h2 id="terraform-vars-4-data-sources">4. Data sources</h2>
<p>Terraform data sources let you dynamically fetch data from APIs or other Terraform state backends. This allows to fetch data from APIC that was already created, and this data source is always read-only. We can use it to read objects in ACI that were already created before either manually or by default like a common tenant in ACI. Those data sources can then be used to create relations with different resources that we want to deploy.
Data sources have separate documentation in the Terraform Registry
As an example we will try to deploy new bridge domain with VRF that will be placed in the common tenant. In ACI from day-0 there is <em>common</em> tenant deployed with <em>default</em> VRF. We will reference it for our new bridge domain. First we have to create two data sources that will reflect our tenant and VRF:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#terraform-vars-__codelineno-26-1"></a>data &quot;aci_tenant&quot; &quot;common-tenant&quot; {
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#terraform-vars-__codelineno-26-2"></a>    name = &quot;common&quot;
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#terraform-vars-__codelineno-26-3"></a>}
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#terraform-vars-__codelineno-26-4"></a>data &quot;aci_vrf&quot; &quot;common-vrf&quot; {
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#terraform-vars-__codelineno-26-5"></a>    tenant_dn   = data.aci_tenant.common-tenant.id
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#terraform-vars-__codelineno-26-6"></a>    name        = &quot;default&quot;
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#terraform-vars-__codelineno-26-7"></a>}
</code></pre></div>
<p>Then we can start using references inside our new bridge domain:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#terraform-vars-__codelineno-27-1"></a>resource &quot;aci_bridge_domain&quot; &quot;bd-common&quot; {
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#terraform-vars-__codelineno-27-2"></a>  tenant_dn                   = aci_tenant.tenant.id
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#terraform-vars-__codelineno-27-3"></a>  name                        = &quot;bd-common&quot;
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#terraform-vars-__codelineno-27-4"></a>  arp_flood                   = &quot;yes&quot;
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#terraform-vars-__codelineno-27-5"></a>  unicast_route               = &quot;no&quot;
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#terraform-vars-__codelineno-27-6"></a>  unk_mac_ucast_act           = &quot;flood&quot;
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#terraform-vars-__codelineno-27-7"></a>  unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#terraform-vars-__codelineno-27-8"></a>  relation_fv_rs_ctx          = data.aci_vrf.common-vrf.id
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#terraform-vars-__codelineno-27-9"></a>}
</code></pre></div>
<p>The difference in a way we make references to data sources, instead of normal resource, is by adding <code>data.</code> before the data source name.
If we run <code>terraform plan</code> and <code>apply</code> now, we will see that Terraform tries to create new bridge domain:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#terraform-vars-__codelineno-28-1"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#terraform-vars-__codelineno-28-2"></a>  + create
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#terraform-vars-__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#terraform-vars-__codelineno-28-4"></a>Terraform will perform the following actions:
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#terraform-vars-__codelineno-28-5"></a>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#terraform-vars-__codelineno-28-6"></a>  # aci_bridge_domain.bd-common will be created
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#terraform-vars-__codelineno-28-7"></a>  + resource &quot;aci_bridge_domain&quot; &quot;bd-common&quot; {
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#terraform-vars-__codelineno-28-8"></a>      + annotation                  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#terraform-vars-__codelineno-28-9"></a>      + arp_flood                   = &quot;yes&quot;
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#terraform-vars-__codelineno-28-10"></a>      + bridge_domain_type          = (known after apply)
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#terraform-vars-__codelineno-28-11"></a>      + description                 = (known after apply)
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#terraform-vars-__codelineno-28-12"></a>      + ep_clear                    = (known after apply)
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#terraform-vars-__codelineno-28-13"></a>      + ep_move_detect_mode         = (known after apply)
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#terraform-vars-__codelineno-28-14"></a>      + host_based_routing          = (known after apply)
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#terraform-vars-__codelineno-28-15"></a>      + id                          = (known after apply)
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#terraform-vars-__codelineno-28-16"></a>      + intersite_bum_traffic_allow = (known after apply)
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#terraform-vars-__codelineno-28-17"></a>      + intersite_l2_stretch        = (known after apply)
<a id="__codelineno-28-18" name="__codelineno-28-18" href="#terraform-vars-__codelineno-28-18"></a>      + ip_learning                 = (known after apply)
<a id="__codelineno-28-19" name="__codelineno-28-19" href="#terraform-vars-__codelineno-28-19"></a>      + ipv6_mcast_allow            = (known after apply)
<a id="__codelineno-28-20" name="__codelineno-28-20" href="#terraform-vars-__codelineno-28-20"></a>      + limit_ip_learn_to_subnets   = (known after apply)
<a id="__codelineno-28-21" name="__codelineno-28-21" href="#terraform-vars-__codelineno-28-21"></a>      + ll_addr                     = (known after apply)
<a id="__codelineno-28-22" name="__codelineno-28-22" href="#terraform-vars-__codelineno-28-22"></a>      + mac                         = (known after apply)
<a id="__codelineno-28-23" name="__codelineno-28-23" href="#terraform-vars-__codelineno-28-23"></a>      + mcast_allow                 = (known after apply)
<a id="__codelineno-28-24" name="__codelineno-28-24" href="#terraform-vars-__codelineno-28-24"></a>      + multi_dst_pkt_act           = (known after apply)
<a id="__codelineno-28-25" name="__codelineno-28-25" href="#terraform-vars-__codelineno-28-25"></a>      + name                        = &quot;bd-common&quot;
<a id="__codelineno-28-26" name="__codelineno-28-26" href="#terraform-vars-__codelineno-28-26"></a>      + name_alias                  = (known after apply)
<a id="__codelineno-28-27" name="__codelineno-28-27" href="#terraform-vars-__codelineno-28-27"></a>      + optimize_wan_bandwidth      = (known after apply)
<a id="__codelineno-28-28" name="__codelineno-28-28" href="#terraform-vars-__codelineno-28-28"></a>      + relation_fv_rs_bd_to_ep_ret = (known after apply)
<a id="__codelineno-28-29" name="__codelineno-28-29" href="#terraform-vars-__codelineno-28-29"></a>      + relation_fv_rs_bd_to_nd_p   = (known after apply)
<a id="__codelineno-28-30" name="__codelineno-28-30" href="#terraform-vars-__codelineno-28-30"></a>      + relation_fv_rs_ctx          = &quot;uni/tn-common/ctx-default&quot;
<a id="__codelineno-28-31" name="__codelineno-28-31" href="#terraform-vars-__codelineno-28-31"></a>      + relation_fv_rs_igmpsn       = (known after apply)
<a id="__codelineno-28-32" name="__codelineno-28-32" href="#terraform-vars-__codelineno-28-32"></a>      + relation_fv_rs_mldsn        = (known after apply)
<a id="__codelineno-28-33" name="__codelineno-28-33" href="#terraform-vars-__codelineno-28-33"></a>      + tenant_dn                   = &quot;uni/tn-dcloud-tenant-4&quot;
<a id="__codelineno-28-34" name="__codelineno-28-34" href="#terraform-vars-__codelineno-28-34"></a>      + unicast_route               = &quot;no&quot;
<a id="__codelineno-28-35" name="__codelineno-28-35" href="#terraform-vars-__codelineno-28-35"></a>      + unk_mac_ucast_act           = &quot;flood&quot;
<a id="__codelineno-28-36" name="__codelineno-28-36" href="#terraform-vars-__codelineno-28-36"></a>      + unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-28-37" name="__codelineno-28-37" href="#terraform-vars-__codelineno-28-37"></a>      + v6unk_mcast_act             = (known after apply)
<a id="__codelineno-28-38" name="__codelineno-28-38" href="#terraform-vars-__codelineno-28-38"></a>      + vmac                        = (known after apply)
<a id="__codelineno-28-39" name="__codelineno-28-39" href="#terraform-vars-__codelineno-28-39"></a>    }
<a id="__codelineno-28-40" name="__codelineno-28-40" href="#terraform-vars-__codelineno-28-40"></a>
<a id="__codelineno-28-41" name="__codelineno-28-41" href="#terraform-vars-__codelineno-28-41"></a>Plan: 1 to add, 0 to change, 0 to destroy.
</code></pre></div>
<p><a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/data-sources/tenant" target="_blank">aci_tenant data source</a>
<a href="https://registry.terraform.io/providers/CiscoDevNet/aci/latest/docs/data-sources/vrf" target="_blank">aci_vrf data source</a></p></section><section class="print-page" id="terraform-state"><h1 id="terraform-state-terraform-state">Terraform State</h1>
<h3 id="terraform-state-1-view-terraform-state">1. View Terraform State</h3>
<p>Let's focus now on the state of our deployments. By now you should have three folders with different Terraform configuration.
Please change to <code>ACI</code> folder in terraform terminal and run <code>terraform state list</code> command. The output should list all the objects that were deployed by Terraform modules and will look similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#terraform-state-__codelineno-0-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI % terraform state list
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#terraform-state-__codelineno-0-2"></a>aci_aaep_to_domain.AEP_L2_to_PHYSDOM_1
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#terraform-state-__codelineno-0-3"></a>aci_access_port_block.leaf-101-102-eth-1-block
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#terraform-state-__codelineno-0-4"></a>aci_access_port_block.leaf-101-102-eth-2-block
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#terraform-state-__codelineno-0-5"></a>aci_access_port_selector.leaf-101-102-eth-1
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#terraform-state-__codelineno-0-6"></a>aci_access_port_selector.leaf-101-102-eth-2
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#terraform-state-__codelineno-0-7"></a>aci_application_epg.epg1
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#terraform-state-__codelineno-0-8"></a>aci_application_profile.ap1
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#terraform-state-__codelineno-0-9"></a>aci_attachable_access_entity_profile.AEP_L2
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#terraform-state-__codelineno-0-10"></a>aci_attachable_access_entity_profile.AEP_L3
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#terraform-state-__codelineno-0-11"></a>aci_bridge_domain.bd-network-1
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#terraform-state-__codelineno-0-12"></a>aci_bridge_domain.bd_192_168_1_0
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#terraform-state-__codelineno-0-13"></a>aci_bridge_domain.bd_192_168_2_0
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#terraform-state-__codelineno-0-14"></a>aci_epg_to_domain.epg1-to-physdom_1
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#terraform-state-__codelineno-0-15"></a>aci_epg_to_static_path.static-binding-1
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#terraform-state-__codelineno-0-16"></a>aci_external_network_instance_profile.extepg
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#terraform-state-__codelineno-0-17"></a>aci_fabric_if_pol.LINK_10G
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#terraform-state-__codelineno-0-18"></a>aci_fabric_node_member.Leaf-101
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#terraform-state-__codelineno-0-19"></a>aci_fabric_node_member.Leaf-102
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#terraform-state-__codelineno-0-20"></a>aci_fabric_node_member.Spine-103
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#terraform-state-__codelineno-0-21"></a>aci_fabric_node_member.Spine-104
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#terraform-state-__codelineno-0-22"></a>aci_l3_domain_profile.EXTRTDOM_1
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#terraform-state-__codelineno-0-23"></a>aci_l3_ext_subnet.extepg-subnet
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#terraform-state-__codelineno-0-24"></a>aci_l3_outside.l3out-1
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#terraform-state-__codelineno-0-25"></a>aci_l3out_path_attachment.l3ip-path
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#terraform-state-__codelineno-0-26"></a>aci_lacp_policy.LACP_ACTIVE
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#terraform-state-__codelineno-0-27"></a>aci_leaf_access_bundle_policy_group.IntPolGrp_Router1
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#terraform-state-__codelineno-0-28"></a>aci_leaf_access_bundle_policy_group.IntPolGrp_VPC_server1
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#terraform-state-__codelineno-0-29"></a>aci_leaf_interface_profile.IntProf-101-102
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#terraform-state-__codelineno-0-30"></a>aci_leaf_profile.SwProf-101-102
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#terraform-state-__codelineno-0-31"></a>aci_leaf_selector.Sel-101-102
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#terraform-state-__codelineno-0-32"></a>aci_lldp_interface_policy.LLDP_ON
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#terraform-state-__codelineno-0-33"></a>aci_logical_interface_profile.ip-101-102
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#terraform-state-__codelineno-0-34"></a>aci_logical_node_profile.np-101-102
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#terraform-state-__codelineno-0-35"></a>aci_logical_node_to_fabric_node.np-101-102-to-node-101
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#terraform-state-__codelineno-0-36"></a>aci_logical_node_to_fabric_node.np-101-102-to-node-102
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#terraform-state-__codelineno-0-37"></a>aci_node_block.Sel-101-102-Block
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#terraform-state-__codelineno-0-38"></a>aci_physical_domain.PHYSDOM_1
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#terraform-state-__codelineno-0-39"></a>aci_ranges.RANGE_100-200
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#terraform-state-__codelineno-0-40"></a>aci_ranges.RANGE_201-300
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#terraform-state-__codelineno-0-41"></a>aci_subnet.subnet-1
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#terraform-state-__codelineno-0-42"></a>aci_tenant.dcloud-tenant-1
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#terraform-state-__codelineno-0-43"></a>aci_tenant.dcloud-tenant-2
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#terraform-state-__codelineno-0-44"></a>aci_vlan_pool.VLAN_POOL_L2
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#terraform-state-__codelineno-0-45"></a>aci_vlan_pool.VLAN_POOL_L3
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#terraform-state-__codelineno-0-46"></a>aci_vrf.vrf1
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#terraform-state-__codelineno-0-47"></a>aci_vrf.vrf2-1
</code></pre></div>
<p>You can see every object/resource we deployed in the previous labs. To see detailed configuration of each object run <code>terraform state show &lt;object name&gt;</code>, for example</p>
<div class="highlight"><pre><span></span><code>`terraform state show aci_bridge_domain.bd-network-1`
</code></pre></div>
<p>You will get output similar to this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#terraform-state-__codelineno-1-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform state show aci_bridge_domain.bd-network-1
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#terraform-state-__codelineno-1-2"></a># aci_bridge_domain.bd-network-1:
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#terraform-state-__codelineno-1-3"></a>resource &quot;aci_bridge_domain&quot; &quot;bd-network-1&quot; {
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#terraform-state-__codelineno-1-4"></a>    annotation                  = &quot;orchestrator:terraform&quot;
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#terraform-state-__codelineno-1-5"></a>    arp_flood                   = &quot;no&quot;
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#terraform-state-__codelineno-1-6"></a>    bridge_domain_type          = &quot;regular&quot;
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#terraform-state-__codelineno-1-7"></a>    ep_clear                    = &quot;no&quot;
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#terraform-state-__codelineno-1-8"></a>    ep_move_detect_mode         = &quot;disable&quot;
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#terraform-state-__codelineno-1-9"></a>    host_based_routing          = &quot;no&quot;
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#terraform-state-__codelineno-1-10"></a>    id                          = &quot;uni/tn-dcloud-tenant-1/BD-bd-network-1&quot;
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#terraform-state-__codelineno-1-11"></a>    intersite_bum_traffic_allow = &quot;no&quot;
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#terraform-state-__codelineno-1-12"></a>    intersite_l2_stretch        = &quot;no&quot;
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#terraform-state-__codelineno-1-13"></a>    ip_learning                 = &quot;yes&quot;
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#terraform-state-__codelineno-1-14"></a>    ipv6_mcast_allow            = &quot;no&quot;
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#terraform-state-__codelineno-1-15"></a>    limit_ip_learn_to_subnets   = &quot;yes&quot;
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#terraform-state-__codelineno-1-16"></a>    ll_addr                     = &quot;::&quot;
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#terraform-state-__codelineno-1-17"></a>    mac                         = &quot;00:22:BD:F8:19:FF&quot;
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#terraform-state-__codelineno-1-18"></a>    mcast_allow                 = &quot;no&quot;
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#terraform-state-__codelineno-1-19"></a>    multi_dst_pkt_act           = &quot;bd-flood&quot;
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#terraform-state-__codelineno-1-20"></a>    name                        = &quot;bd-network-1&quot;
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#terraform-state-__codelineno-1-21"></a>    optimize_wan_bandwidth      = &quot;no&quot;
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#terraform-state-__codelineno-1-22"></a>    relation_fv_rs_ctx          = &quot;uni/tn-dcloud-tenant-1/ctx-vrf1&quot;
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#terraform-state-__codelineno-1-23"></a>    tenant_dn                   = &quot;uni/tn-dcloud-tenant-1&quot;
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#terraform-state-__codelineno-1-24"></a>    unicast_route               = &quot;yes&quot;
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#terraform-state-__codelineno-1-25"></a>    unk_mac_ucast_act           = &quot;proxy&quot;
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#terraform-state-__codelineno-1-26"></a>    unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#terraform-state-__codelineno-1-27"></a>    v6unk_mcast_act             = &quot;flood&quot;
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#terraform-state-__codelineno-1-28"></a>    vmac                        = &quot;not-applicable&quot;
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#terraform-state-__codelineno-1-29"></a>}
</code></pre></div>
<p>You can see the current state of this bridge domain and configuration of many parameters, even the ones we did not specify in the configuration. The reason we have these parameters here, is that they took the default value for bridge domain. The <code>id</code> element is the path of the bridge domain that was returned to us from ACI after we created this bridge domain.
You can in the same way check the state of other objects that we deployed.</p>
<p>Terraform stores information about our infrastructure in a state file. This state file keeps track of resources created by our configuration and maps them to real-world resources. The state file by default is located in the main directory of our workspace and is called <code>terraform.tfstate</code>. If you list all the contents of our workspace folder you will see that this file exists, and is created after we apply our config:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#terraform-state-__codelineno-2-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % ls | grep tfstate
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#terraform-state-__codelineno-2-2"></a>terraform.tfstate
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#terraform-state-__codelineno-2-3"></a>terraform.tfstate.backup
</code></pre></div>
<p>There is also a backup file created of our state.
Those files should not be changed manually to avoid drift between our Terraform configuration, state and infrastructure.
Open <code>terraform.tfstate</code> file in a file editor. You will see that this file is in the JSON format. The first stanza contains information about our Terraform application</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#terraform-state-__codelineno-3-1"></a>{
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#terraform-state-__codelineno-3-2"></a>  &quot;version&quot;: 4,
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#terraform-state-__codelineno-3-3"></a>  &quot;terraform_version&quot;: &quot;1.3.2&quot;,
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#terraform-state-__codelineno-3-4"></a>  &quot;serial&quot;: 577,
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#terraform-state-__codelineno-3-5"></a>  &quot;lineage&quot;: &quot;8c71daed-6a43-a3c1-3981-9ce1f9789eb6&quot;,
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#terraform-state-__codelineno-3-6"></a>  &quot;outputs&quot;: {},
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#terraform-state-__codelineno-3-7"></a>  &quot;resources&quot;: [
</code></pre></div>
<p>Below that is the <code>resources</code> section of the state file, and it contains the schema for any resource that was created in Terraform. Example resource from the state file:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#terraform-state-__codelineno-4-1"></a>{
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#terraform-state-__codelineno-4-2"></a>  &quot;mode&quot;: &quot;managed&quot;,
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#terraform-state-__codelineno-4-3"></a>  &quot;type&quot;: &quot;aci_aaep_to_domain&quot;,
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#terraform-state-__codelineno-4-4"></a>  &quot;name&quot;: &quot;AEP_L2_to_PHYSDOM_1&quot;,
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#terraform-state-__codelineno-4-5"></a>  &quot;provider&quot;: &quot;provider[\&quot;registry.terraform.io/ciscodevnet/aci\&quot;]&quot;,
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#terraform-state-__codelineno-4-6"></a>  &quot;instances&quot;: [
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#terraform-state-__codelineno-4-7"></a>    {
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#terraform-state-__codelineno-4-8"></a>      &quot;schema_version&quot;: 1,
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#terraform-state-__codelineno-4-9"></a>      &quot;attributes&quot;: {
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#terraform-state-__codelineno-4-10"></a>        &quot;annotation&quot;: &quot;orchestrator:terraform&quot;,
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#terraform-state-__codelineno-4-11"></a>        &quot;attachable_access_entity_profile_dn&quot;: &quot;uni/infra/attentp-AEP_L2&quot;,
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#terraform-state-__codelineno-4-12"></a>        &quot;description&quot;: null,
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#terraform-state-__codelineno-4-13"></a>        &quot;domain_dn&quot;: &quot;uni/phys-PHYSDOM_1&quot;,
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#terraform-state-__codelineno-4-14"></a>        &quot;id&quot;: &quot;uni/infra/attentp-AEP_L2/rsdomP-[uni/phys-PHYSDOM_1]&quot;
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#terraform-state-__codelineno-4-15"></a>      },
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#terraform-state-__codelineno-4-16"></a>      &quot;sensitive_attributes&quot;: [],
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#terraform-state-__codelineno-4-17"></a>      &quot;private&quot;: &quot;eyJzY2hlbWFfdmVyc2lvbiI6IjEifQ==&quot;,
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#terraform-state-__codelineno-4-18"></a>      &quot;dependencies&quot;: [
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#terraform-state-__codelineno-4-19"></a>        &quot;aci_attachable_access_entity_profile.AEP_L2&quot;,
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#terraform-state-__codelineno-4-20"></a>        &quot;aci_physical_domain.PHYSDOM_1&quot;,
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#terraform-state-__codelineno-4-21"></a>        &quot;aci_vlan_pool.VLAN_POOL_L2&quot;
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#terraform-state-__codelineno-4-22"></a>      ]
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#terraform-state-__codelineno-4-23"></a>    }
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#terraform-state-__codelineno-4-24"></a>  ]
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#terraform-state-__codelineno-4-25"></a>},
</code></pre></div>
<p>The first key is <code>mode</code>. Mode refers to the type of resource Terraform creates - either a resource (<code>managed</code>) or a data source (<code>data</code>). Tye <code>type</code> key refers to the resource type, in this case <code>aci_aaep_to_domain</code> is a resource available in the <code>aci</code> provider. The name of our resrouce is also stated here.
Below in the <code>instances</code> section, we have <code>attributes</code> of our resource: annotaion, attachable_access_entity_profile_dn, description, domain_dn and id. All those parameters apart from id can be set in our resource configuration, the ID parameter is returned from APIC after resource creation.
If you now run <code>terraform state show aci_aaep_to_domain.AEP_L2_to_PHYSDOM_1</code> you would see the same parameters displayed in the CLI version.</p>
<p>Terraform also marks dependencies between resources in state with the built-in dependency logic. In case of our aci_aaep_to_domain resoucre we have three dependencies to AEP, physical domain and vlan pool. Those dependencies are created based on <code>depends_on</code> attribute or by Terraform automatically.</p>
<h2 id="terraform-state-2-config-drift">2. Config drift</h2>
<p>Terraform usually only updates infrastructure if it does not match the coniguration.</p>
<p>Let's see what happens when there is a manual change done on an existing object that was created by Terraform. We will work on the <code>bd-network-1</code> resource that was created in the <code>dcloud-tenant-1</code>. This resource was declared following:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#terraform-state-__codelineno-5-1"></a>resource &quot;aci_bridge_domain&quot; &quot;bd-network-1&quot; {
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#terraform-state-__codelineno-5-2"></a>    tenant_dn             = aci_tenant.dcloud-tenant-1.id
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#terraform-state-__codelineno-5-3"></a>    relation_fv_rs_ctx    = aci_vrf.vrf1.id
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#terraform-state-__codelineno-5-4"></a>    name                  = &quot;bd-network-1&quot;
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#terraform-state-__codelineno-5-5"></a>}
</code></pre></div>
<p>Please login to APIC and go to Tenants -&gt; dcloud-tenant-1 -&gt; Networking -&gt; Bridge Domains -&gt; bd-network-1 and open the Policy tab.
Change the L2 Unkown Unicast setting from Hardware Proxy to Flood and Submit changes:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/terraform-config-drift-1.png" width = 800></p>
<p>If you run <code>terraform plan</code> now you will see that no changes to the infrastructure are required. If display state of this object, you will see that it still has "proxy" value assigned:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#terraform-state-__codelineno-6-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI % terraform state show aci_bridge_domain.bd-network-1
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#terraform-state-__codelineno-6-2"></a># aci_bridge_domain.bd-network-1:
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#terraform-state-__codelineno-6-3"></a>resource &quot;aci_bridge_domain&quot; &quot;bd-network-1&quot; {
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#terraform-state-__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#terraform-state-__codelineno-6-5"></a>&lt;omitted&gt;
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#terraform-state-__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#terraform-state-__codelineno-6-7"></a>    unk_mac_ucast_act           = &quot;proxy&quot;
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#terraform-state-__codelineno-6-8"></a>    unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#terraform-state-__codelineno-6-9"></a>    v6unk_mcast_act             = &quot;flood&quot;
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#terraform-state-__codelineno-6-10"></a>    vmac                        = &quot;not-applicable&quot;
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#terraform-state-__codelineno-6-11"></a>}
</code></pre></div>
 The reason for that is that the attribute that was changed - <code>unk_mac_ucast_act</code> - was not set in Terraform configuration. Terraform will detect the config drift but it will not revert it. If we now run <code>apply</code> we will see that the parameter has been updated in the Terraform state:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#terraform-state-__codelineno-7-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI % terraform apply
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#terraform-state-__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#terraform-state-__codelineno-7-3"></a>&lt;omitted&gt;
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#terraform-state-__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#terraform-state-__codelineno-7-5"></a>No changes. Your infrastructure matches the configuration.
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#terraform-state-__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#terraform-state-__codelineno-7-7"></a>Terraform has compared your real infrastructure against your configuration and found no differences, so no changes are needed.
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#terraform-state-__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#terraform-state-__codelineno-7-9"></a>Apply complete! Resources: 0 added, 0 changed, 0 destroyed.
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#terraform-state-__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#terraform-state-__codelineno-7-11"></a>juchowan@JUCHOWAN-M-D2P2 ACI-simulator % terraform state show aci_bridge_domain.bd-network-1
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#terraform-state-__codelineno-7-12"></a># aci_bridge_domain.bd-network-1:
<a id="__codelineno-7-13" name="__codelineno-7-13" href="#terraform-state-__codelineno-7-13"></a>resource &quot;aci_bridge_domain&quot; &quot;bd-network-1&quot; {
<a id="__codelineno-7-14" name="__codelineno-7-14" href="#terraform-state-__codelineno-7-14"></a>
<a id="__codelineno-7-15" name="__codelineno-7-15" href="#terraform-state-__codelineno-7-15"></a>&lt;omitted&gt;
<a id="__codelineno-7-16" name="__codelineno-7-16" href="#terraform-state-__codelineno-7-16"></a>
<a id="__codelineno-7-17" name="__codelineno-7-17" href="#terraform-state-__codelineno-7-17"></a>    unk_mac_ucast_act           = &quot;flood&quot;
<a id="__codelineno-7-18" name="__codelineno-7-18" href="#terraform-state-__codelineno-7-18"></a>    unk_mcast_act               = &quot;flood&quot;
<a id="__codelineno-7-19" name="__codelineno-7-19" href="#terraform-state-__codelineno-7-19"></a>    v6unk_mcast_act             = &quot;flood&quot;
<a id="__codelineno-7-20" name="__codelineno-7-20" href="#terraform-state-__codelineno-7-20"></a>    vmac                        = &quot;not-applicable&quot;
<a id="__codelineno-7-21" name="__codelineno-7-21" href="#terraform-state-__codelineno-7-21"></a>}
</code></pre></div>
<p>If we would like to see those config drifts in the output of our <code>plan</code> and <code>apply</code> command, we would need to use the <code>-refresh-only</code> flag.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#terraform-state-__codelineno-8-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI % terraform plan -refresh-only
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#terraform-state-__codelineno-8-2"></a>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#terraform-state-__codelineno-8-3"></a>Note: Objects have changed outside of Terraform
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#terraform-state-__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#terraform-state-__codelineno-8-5"></a>Terraform detected the following changes made outside of Terraform since the last &quot;terraform apply&quot; which may have affected this plan:
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#terraform-state-__codelineno-8-6"></a>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#terraform-state-__codelineno-8-7"></a>  # aci_bridge_domain.bd-network-1 has changed
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#terraform-state-__codelineno-8-8"></a>  ~ resource &quot;aci_bridge_domain&quot; &quot;bd-network-1&quot; {
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#terraform-state-__codelineno-8-9"></a>        id                          = &quot;uni/tn-dcloud-tenant-1/BD-bd-network-1&quot;
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#terraform-state-__codelineno-8-10"></a>        name                        = &quot;bd-network-1&quot;
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#terraform-state-__codelineno-8-11"></a>      ~ unk_mac_ucast_act           = &quot;proxy&quot; -&gt; &quot;flood&quot;
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#terraform-state-__codelineno-8-12"></a>        # (22 unchanged attributes hidden)
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#terraform-state-__codelineno-8-13"></a>    }
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#terraform-state-__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#terraform-state-__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#terraform-state-__codelineno-8-16"></a>This is a refresh-only plan, so Terraform will not take any actions to undo these. If you were expecting these changes then you can apply this plan to record the updated
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#terraform-state-__codelineno-8-17"></a>values in the Terraform state without changing any remote objects.
</code></pre></div>
<p>Let's now see what will happen if we explicitly set this parameter in the Terraform configuration.
The current state is that our bridge domain has manually set "flood" option, and our state is in line with this. Let's add a new line to our bridge domain configuration. This config was done in the <code>dcloud-tenant-1.tf</code> file. Please add the line:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#terraform-state-__codelineno-9-1"></a><span class="err">resource</span><span class="w"> </span><span class="s2">&quot;aci_bridge_domain&quot;</span><span class="w"> </span><span class="s2">&quot;bd-network-1&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#terraform-state-__codelineno-9-2"></a><span class="w">    </span><span class="kc">tenant</span><span class="err">_d</span><span class="kc">n</span><span class="w">             </span><span class="err">=</span><span class="w"> </span><span class="err">aci_</span><span class="kc">tenant</span><span class="err">.dcloud</span><span class="mi">-</span><span class="kc">tenant</span><span class="mf">-1.</span><span class="err">id</span><span class="w"></span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#terraform-state-__codelineno-9-3"></a><span class="w">    </span><span class="err">rela</span><span class="kc">t</span><span class="err">io</span><span class="kc">n</span><span class="err">_</span><span class="kc">f</span><span class="err">v_rs_c</span><span class="kc">t</span><span class="err">x</span><span class="w">    </span><span class="err">=</span><span class="w"> </span><span class="err">aci_vr</span><span class="kc">f</span><span class="err">.vr</span><span class="kc">f</span><span class="mf">1.</span><span class="err">id</span><span class="w"></span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#terraform-state-__codelineno-9-4"></a><span class="w">    </span><span class="kc">na</span><span class="err">me</span><span class="w">                  </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;bd-network-1&quot;</span><span class="w"></span>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#terraform-state-__codelineno-9-5"></a><span class="hll"><span class="w">    </span><span class="err">u</span><span class="kc">n</span><span class="err">k_mac_ucas</span><span class="kc">t</span><span class="err">_ac</span><span class="kc">t</span><span class="w">     </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;proxy&quot;</span><span class="w"></span>
</span><a id="__codelineno-9-6" name="__codelineno-9-6" href="#terraform-state-__codelineno-9-6"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>If you run <code>plan</code> and <code>apply</code> now, you will see the change needs to be done. Please apply that change and verify in APIC that L2 unknown unicast is changed to "proxy".</p>
<p>At this point our state shows "proxy" for this bridge domain settings. Let's change back to flood on the APIC GUI:</p>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/terraform-config-drift-1.png" width = 800></p>
<p>If we were to run <code>plan</code> now we will start seeing the change required:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#terraform-state-__codelineno-10-1"></a>juchowan@JUCHOWAN-M-D2P2 ACI % terraform plan
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#terraform-state-__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#terraform-state-__codelineno-10-3"></a>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#terraform-state-__codelineno-10-4"></a>  ~ update in-place
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#terraform-state-__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#terraform-state-__codelineno-10-6"></a>Terraform will perform the following actions:
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#terraform-state-__codelineno-10-7"></a>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#terraform-state-__codelineno-10-8"></a>  # aci_bridge_domain.bd-network-1 will be updated in-place
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#terraform-state-__codelineno-10-9"></a>  ~ resource &quot;aci_bridge_domain&quot; &quot;bd-network-1&quot; {
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#terraform-state-__codelineno-10-10"></a>        id                          = &quot;uni/tn-dcloud-tenant-1/BD-bd-network-1&quot;
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#terraform-state-__codelineno-10-11"></a>        name                        = &quot;bd-network-1&quot;
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#terraform-state-__codelineno-10-12"></a>      ~ unk_mac_ucast_act           = &quot;flood&quot; -&gt; &quot;proxy&quot;
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#terraform-state-__codelineno-10-13"></a>        # (22 unchanged attributes hidden)
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#terraform-state-__codelineno-10-14"></a>    }
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#terraform-state-__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#terraform-state-__codelineno-10-16"></a>Plan: 0 to add, 1 to change, 0 to destroy.
</code></pre></div>
<p>This is because attribute has been set in Terraform, so Terraform detects this drift and tries to revert it its expected condition.</p>
<p>If we would like now to not revert it, but update Terraform state to reflect this change to "flood", we would require to change Terraform config to "flood" under resource block, and run <code>terraform apply -refresh-only</code>.</p></section><section class="print-page" id="terraform-custom"><h1 id="terraform-custom-create-sample-use-cases-with-terraform">Create sample use-cases with terraform</h1>
<h2 id="terraform-custom-use-case-no1">Use-Case no.1</h2>
<p>Customer place SHARED network component in ACI shared tenant <em>common</em>. Custom tenants contain dedicated VRF, BDs and EPGs, Domain associations and static-bindings for particular department. L3out configuration for routing with external networks.</p>
<p>Use existing PHYSDOM_1 physical domain and existing EXTRTDOM_1 routed domain (TIP: you can use data sources for this)
Use following static-bindings for devices:</p>
<p>WAN router:</p>
<ul>
<li>node 101, interface eth1/5, vlan 250</li>
</ul>
<p>INTERNET router:</p>
<ul>
<li>topology/pod-1/protpaths-101-102/pathep-[IntPolGrp_Router1], vlan 251</li>
</ul>
<p>UCS/vmware server:</p>
<ul>
<li>topology/pod-1/protpaths-101-102/pathep-[IntPolGrp_VPC_server1]</li>
<li>EPG_HA - vlan 152</li>
<li>EPG_UC - vlan 150</li>
<li>EPG_DMZ - vlan 151</li>
</ul>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/terraform-usecase.png" width = 800></p>
<p>Based on experience gained, build yourself a use-case in Terraform. You can specify each resource directly, or you can use variable file.</p></section><section class="print-page" id="terraform-modules"><h1 id="terraform-modules-terraform-modules">Terraform modules</h1>
<p>As you can see deploying objects like L3out require a lot of repeatable configuration. Such configs can be simplified by using Terraform modules. In such module we can write source configuration and re-use it multiple times, with standardized configuration.</p>
<p>In this lab we will use existing module for L3out configuration.
This module consists of three files:</p>
<ul>
<li>main.tf with the resource configuration</li>
<li>variables.tf with th variables definition</li>
<li>outputs.tf with the output ID value that this module would return</li>
</ul>
<p>Each three files should be placed under <em>modules/aci_l3out/</em> folder structure.</p>
<p>Apart from those files, we still require our own configuration, so again we will create <code>main.tf</code>, <code>variables.tf</code> and <code>terraform.tfvars</code> under main folder. The whole structure should look like this:</p>
<ul>
<li>
<p>ACI-4/</p>
<ul>
<li>main.tf</li>
<li>variables.tf</li>
<li>terraform.tfvars</li>
<li>
<p>modules/</p>
<ul>
<li>
<p>aci_l3out/</p>
<ul>
<li>main.tf</li>
<li>variables.tf</li>
<li>outputs.tf</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The complete folder can be downloaded: <strong><a href="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/docs/modules-demo.zip" target="_blank">here</a></strong></p>
<p>We will walk over the config files.</p>
<p><strong>Module files</strong></p>
<p>Inside the module folder we have three files.</p>
<p>In the <em>variables.tf</em> we define every variable that we will be using. In case of this module those variables don't have any default values assigned, they mostly specify the type of parameters to be used in maps.</p>
<p>In the <em>main.tf</em> file we create our complex l3out configuration and relations between multiple objects. This configuration looks similar to your manual L3out configuration, but this time it is reusable and you wouldn't have to write it multiple times for multiple L3outs.
We have set of resources like <code>aci_l3out</code>, <code>aci_logical_node_profile</code>, <code>aci_logical_interface_profile</code> etc. This module adds also BGP peer connectivity which is something we haven't done yet in the previous labs.</p>
<p>The new thing you can spot in this module is the initial part with the <code>locals</code> block. This block defined a local value. Local value is a temporary variable that is constructed with an expression on other variables. If you run expressions on variables, for example loops, you would always get some temporary variable that you can use. However, what a local value does, is that it assigns a name to that expression and you will be able to reuse it multiple times within your module, instead of repeating the expression. You can treat it similarly to a function in programming which returns some value.
In case of local value <code>external_epg_subnets</code> it is performing <code>flatten</code> function. (Flatten function)[https://developer.hashicorp.com/terraform/language/functions/flatten] is useful for us when we want to run loops inside a map of map. The result of this flatten function would be a list of all subnets that need to be configured under external EPG with their parameters.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#terraform-modules-__codelineno-0-1"></a>locals {
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#terraform-modules-__codelineno-0-2"></a>  external_epg_subnets = flatten([
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#terraform-modules-__codelineno-0-3"></a>    for l3epg_key, l3epg in var.external_epgs : [
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#terraform-modules-__codelineno-0-4"></a>      for subnet_key, subnet in l3epg.subnets : {
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#terraform-modules-__codelineno-0-5"></a>        external_epg_key = l3epg_key
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#terraform-modules-__codelineno-0-6"></a>        external_epg_name = l3epg.name
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#terraform-modules-__codelineno-0-7"></a>        subnet_key = subnet_key
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#terraform-modules-__codelineno-0-8"></a>        subnet_ip = subnet.ip
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#terraform-modules-__codelineno-0-9"></a>        subnet_scope = subnet.scope
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#terraform-modules-__codelineno-0-10"></a>      }
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#terraform-modules-__codelineno-0-11"></a>    ]
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#terraform-modules-__codelineno-0-12"></a>  ])
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#terraform-modules-__codelineno-0-13"></a>}
</code></pre></div>
<p>Later in the code we can see that this is used with <code>for</code> function in <code>aci_l3_ext_subnet</code> resource:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#terraform-modules-__codelineno-1-1"></a>resource &quot;aci_l3_ext_subnet&quot; &quot;l3instp_subnet&quot; {
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#terraform-modules-__codelineno-1-2"></a>  for_each       = {
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#terraform-modules-__codelineno-1-3"></a>    for subnet in local.external_epg_subnets : &quot;${subnet.external_epg_key}.${subnet.subnet_key}&quot; =&gt; subnet
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#terraform-modules-__codelineno-1-4"></a>  }
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#terraform-modules-__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#terraform-modules-__codelineno-1-6"></a>  external_network_instance_profile_dn  = aci_external_network_instance_profile.l3instp[each.value.external_epg_key].id
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#terraform-modules-__codelineno-1-7"></a>  ip                                    = each.value.subnet_ip
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#terraform-modules-__codelineno-1-8"></a>  scope                                 = each.value.subnet_scope
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#terraform-modules-__codelineno-1-9"></a>}
</code></pre></div>
<p>In the <em>value.tf</em> file we specify the output value for this module. Output values are similar to return values in programming languages. In this case they will return ID of L3out we created, and that ID in ACI will be the path of this object.
As you may remember, our standard resources from official ACI provider also return ID value of this resource in ACI, and it is always the path to the object.</p>
<p><strong>Main folder files</strong></p>
<p>In the main folder the files use same configuration as in previous labs, so you should be already familiar with the way we configure objects using variables and how we configure  bridge domains with conditionals and for_each loop. The new part is the way we configure L3Out using module.</p>
<p>As first part you can see that we are using data source to import existing configuration of Routed Domain. It would have to be used for configuration of L3out, so we need to have a way to reference it in our files.</p>
<p>Next we have our block for configuring the L3out itself. The highlithed lines show how we can write configuration and reference the module. Instead of a <code>resource</code> block, we are using <code>module</code> block and then in second line we have to reference the source path where this module is located <code>./modules/aci_l3out</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#terraform-modules-__codelineno-2-1"></a><span class="hll"><span class="err">module</span><span class="w"> </span><span class="s2">&quot;l3out_core&quot;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
</span><a id="__codelineno-2-2" name="__codelineno-2-2" href="#terraform-modules-__codelineno-2-2"></a><span class="hll"><span class="w">    </span><span class="err">source</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;./modules/aci_l3out&quot;</span><span class="w"></span>
</span><a id="__codelineno-2-3" name="__codelineno-2-3" href="#terraform-modules-__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#terraform-modules-__codelineno-2-4"></a><span class="w">    </span><span class="kc">tenant</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">aci_</span><span class="kc">tenant</span><span class="err">.</span><span class="kc">tenant</span><span class="err">.id</span><span class="w"></span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#terraform-modules-__codelineno-2-5"></a><span class="w">    </span><span class="kc">na</span><span class="err">me</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;core_l3out&quot;</span><span class="w"></span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#terraform-modules-__codelineno-2-6"></a><span class="w">    </span><span class="err">vr</span><span class="kc">f</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">aci_vr</span><span class="kc">f</span><span class="err">.mai</span><span class="kc">n</span><span class="err">.id</span><span class="w"></span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#terraform-modules-__codelineno-2-7"></a><span class="w">    </span><span class="err">l</span><span class="mi">3</span><span class="err">_ex</span><span class="kc">t</span><span class="err">_domai</span><span class="kc">n</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">da</span><span class="kc">ta</span><span class="err">.aci_l</span><span class="mi">3</span><span class="err">_domai</span><span class="kc">n</span><span class="err">_pro</span><span class="kc">f</span><span class="err">ile.EXTRTDOM_</span><span class="mf">1.</span><span class="err">id</span><span class="w"></span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#terraform-modules-__codelineno-2-8"></a><span class="w">    </span><span class="kc">n</span><span class="err">odes</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#terraform-modules-__codelineno-2-9"></a><span class="w">        </span><span class="mi">101</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#terraform-modules-__codelineno-2-10"></a><span class="w">            </span><span class="err">pod_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"></span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#terraform-modules-__codelineno-2-11"></a><span class="w">            </span><span class="kc">n</span><span class="err">ode_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;101&quot;</span><span class="w"></span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#terraform-modules-__codelineno-2-12"></a><span class="w">            </span><span class="err">r</span><span class="kc">tr</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;51.1.1.1&quot;</span><span class="w"></span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#terraform-modules-__codelineno-2-13"></a><span class="w">            </span><span class="err">r</span><span class="kc">tr</span><span class="err">_id_loopback</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;no&quot;</span><span class="w"></span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#terraform-modules-__codelineno-2-14"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#terraform-modules-__codelineno-2-15"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#terraform-modules-__codelineno-2-16"></a><span class="w">    </span><span class="err">pa</span><span class="kc">t</span><span class="err">hs</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#terraform-modules-__codelineno-2-17"></a><span class="w">        </span><span class="s2">&quot;101.1.10&quot;</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#terraform-modules-__codelineno-2-18"></a><span class="w">            </span><span class="err">pod_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;1&quot;</span><span class="w"></span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#terraform-modules-__codelineno-2-19"></a><span class="w">            </span><span class="kc">n</span><span class="err">ode_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;101&quot;</span><span class="w"></span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#terraform-modules-__codelineno-2-20"></a><span class="w">            </span><span class="err">por</span><span class="kc">t</span><span class="err">_id</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;eth1/10&quot;</span><span class="w"></span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#terraform-modules-__codelineno-2-21"></a><span class="w">            </span><span class="err">ip_addr</span><span class="w">  </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;5.5.1.2/24&quot;</span><span class="w"></span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#terraform-modules-__codelineno-2-22"></a><span class="w">            </span><span class="err">mode</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;regular&quot;</span><span class="w"></span>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#terraform-modules-__codelineno-2-23"></a><span class="w">            </span><span class="err">m</span><span class="kc">tu</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;inherit&quot;</span><span class="w"></span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#terraform-modules-__codelineno-2-24"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#terraform-modules-__codelineno-2-25"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#terraform-modules-__codelineno-2-26"></a><span class="w">    </span><span class="err">bgp_peers</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#terraform-modules-__codelineno-2-27"></a><span class="w">        </span><span class="err">asa</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#terraform-modules-__codelineno-2-28"></a><span class="w">            </span><span class="err">peer_addr</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;5.5.1.1&quot;</span><span class="w"></span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#terraform-modules-__codelineno-2-29"></a><span class="w">            </span><span class="err">peer_as</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;65099&quot;</span><span class="w"></span>
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#terraform-modules-__codelineno-2-30"></a><span class="w">            </span><span class="err">local_as</span><span class="kc">n</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;65001&quot;</span><span class="w"></span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#terraform-modules-__codelineno-2-31"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#terraform-modules-__codelineno-2-32"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#terraform-modules-__codelineno-2-33"></a><span class="w">    </span><span class="err">ex</span><span class="kc">ternal</span><span class="err">_epgs</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#terraform-modules-__codelineno-2-34"></a><span class="w">        </span><span class="err">de</span><span class="kc">fault</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#terraform-modules-__codelineno-2-35"></a><span class="w">            </span><span class="kc">na</span><span class="err">me</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;default_l3epg&quot;</span><span class="w"></span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#terraform-modules-__codelineno-2-36"></a><span class="w">            </span><span class="err">pre</span><span class="kc">f</span><span class="err">Grp</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;exclude&quot;</span><span class="w"></span>
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#terraform-modules-__codelineno-2-37"></a><span class="w">            </span><span class="err">provided_co</span><span class="kc">ntra</span><span class="err">c</span><span class="kc">ts</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#terraform-modules-__codelineno-2-38"></a><span class="w">            </span><span class="err">co</span><span class="kc">nsu</span><span class="err">med_co</span><span class="kc">ntra</span><span class="err">c</span><span class="kc">ts</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[]</span><span class="w"></span>
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#terraform-modules-__codelineno-2-39"></a><span class="w">            </span><span class="err">sub</span><span class="kc">nets</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#terraform-modules-__codelineno-2-40"></a><span class="w">              </span><span class="s2">&quot;0.0.0.0&quot;</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#terraform-modules-__codelineno-2-41"></a><span class="w">                </span><span class="err">ip</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="s2">&quot;0.0.0.0/0&quot;</span><span class="w"></span>
<a id="__codelineno-2-42" name="__codelineno-2-42" href="#terraform-modules-__codelineno-2-42"></a><span class="w">                </span><span class="err">scope</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;import-security&quot;</span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-2-43" name="__codelineno-2-43" href="#terraform-modules-__codelineno-2-43"></a><span class="w">              </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-44" name="__codelineno-2-44" href="#terraform-modules-__codelineno-2-44"></a><span class="w">            </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-45" name="__codelineno-2-45" href="#terraform-modules-__codelineno-2-45"></a><span class="w">        </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-46" name="__codelineno-2-46" href="#terraform-modules-__codelineno-2-46"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-2-47" name="__codelineno-2-47" href="#terraform-modules-__codelineno-2-47"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>The remaining part is the actual config parameters that we want to use for our L3out. Each of the parameters that we are assigning is defined in the module itself. In this file we simply assign values to them, either manually by typing it (i.e. name = "core_l3out") or by referencing other variables and objects (i.e tenant_id = aci_tenant.tenant.id).</p>
<h3 id="terraform-modules-lab">Lab</h3>
<p>Customer creates Custom2 tenant with dedicated VRF, bridge domains, EPGs, domain associations and static-bindings for particular departaments. There are also two L3outs for MPLS and Internet connectivity. Use existing PHYSDOM_1 physcial domain and existing EXTRTDOM_1 routed domain. Use following static bindings:</p>
<p>WAN Router:</p>
<ul>
<li>node 101, interface eth1/10, routed interface</li>
</ul>
<p>INTERNET Router:</p>
<ul>
<li>node 102, interface eth1/11, routed interface</li>
</ul>
<p>UCS/vmware server:</p>
<ul>
<li>topology/pod-1/protpaths-101-102/pathep-[IntPolGrp_VPC_server1]</li>
<li>EPG_UC - vlan 160</li>
<li>EPG_DMZ - vlan 161</li>
</ul>
<p><img src="https://raw.githubusercontent.com/marcinduma/ACI-Automation/main/images/terraform-usecase-module.png" width = 400></p></section><h1 class='nav-section-title-end'>Ended: Second LAB sections</h1>
                        <h1 class='nav-section-title' id='section-appendixes'>
                            Appendixes <a class='headerlink' href='#section-appendixes' title='Permanent link'>↵</a>
                        </h1>
                        <h1 class='nav-section-title-end'>Ended: Appendixes</h1></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "/", "features": [], "search": "../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.3a4b43e5.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
    
  </body>
</html>